
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A blog about Azure, DevOps and other stuff" name="description"/>
<meta content="Rafael FernÃ¡ndez" name="author"/>
<link href="https://rfernandezdo.github.io/blog/" rel="canonical"/>
<link href="tags/" rel="next"/>
<link href="../feed_rss_created.xml" rel="alternate" title="RSS feed" type="application/rss+xml"/>
<link href="../feed_rss_updated.xml" rel="alternate" title="RSS feed of updated content" type="application/rss+xml"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.34" name="generator"/>
<title>Blog - Un Rinconcito donde contar lo que quiera</title>
<link href="../assets/stylesheets/main.35f28582.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="website" property="og:type"/>
<meta content="Blog - Un Rinconcito donde contar lo que quiera" property="og:title"/>
<meta content="A blog about Azure, DevOps and other stuff" property="og:description"/>
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/index.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://rfernandezdo.github.io/blog/" property="og:url"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Blog - Un Rinconcito donde contar lo que quiera" name="twitter:title"/>
<meta content="A blog about Azure, DevOps and other stuff" name="twitter:description"/>
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/index.png" name="twitter:image"/>
 <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#blog">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component="logo" href=".." title="Un Rinconcito donde contar lo que quiera">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Un Rinconcito donde contar lo que quiera
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Blog
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
    
  
  About

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../contributions/">
        
  
    
  
  Contributions

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../Azure/Security/MCSB/Readme/">
          
  
  Azure

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Un Rinconcito donde contar lo que quiera">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Un Rinconcito donde contar lo que quiera
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    Blog
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Blog
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="tags/">
<span class="md-ellipsis">
    Posts by Tags
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
<span class="md-ellipsis">
    Archive
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            Archive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="2025/01/">
<span class="md-ellipsis">
    2025/01
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/12/">
<span class="md-ellipsis">
    2024/12
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/11/">
<span class="md-ellipsis">
    2024/11
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/10/">
<span class="md-ellipsis">
    2024/10
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/09/">
<span class="md-ellipsis">
    2024/09
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/06/">
<span class="md-ellipsis">
    2024/06
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/05/">
<span class="md-ellipsis">
    2024/05
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/04/">
<span class="md-ellipsis">
    2024/04
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/03/">
<span class="md-ellipsis">
    2024/03
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2024/02/">
<span class="md-ellipsis">
    2024/02
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2023/12/">
<span class="md-ellipsis">
    2023/12
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2023/11/">
<span class="md-ellipsis">
    2023/11
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="2023/10/">
<span class="md-ellipsis">
    2023/10
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
<span class="md-ellipsis">
    Categories
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_4">
<span class="md-nav__icon md-icon"></span>
            Categories
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="category/azure/">
<span class="md-ellipsis">
    Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/azure-frameworks/">
<span class="md-ellipsis">
    Azure Frameworks
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/azure-services/">
<span class="md-ellipsis">
    Azure Services
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/azure-updates/">
<span class="md-ellipsis">
    Azure Updates
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/devops/">
<span class="md-ellipsis">
    DevOps
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/development/">
<span class="md-ellipsis">
    Development
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/english/">
<span class="md-ellipsis">
    English
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/finops/">
<span class="md-ellipsis">
    FinOps
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/hashicorp/">
<span class="md-ellipsis">
    HashiCorp
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/hello_world/">
<span class="md-ellipsis">
    Hello_World
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/learning/">
<span class="md-ellipsis">
    Learning
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/m365/">
<span class="md-ellipsis">
    M365
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/microsoft-365/">
<span class="md-ellipsis">
    Microsoft 365
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/microsoft-entra/">
<span class="md-ellipsis">
    Microsoft Entra
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/microsoft-entra-external-id/">
<span class="md-ellipsis">
    Microsoft Entra External ID
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/microsoft-entra-id/">
<span class="md-ellipsis">
    Microsoft Entra ID
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/outlook/">
<span class="md-ellipsis">
    Outlook
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/power-bi/">
<span class="md-ellipsis">
    Power BI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/security/">
<span class="md-ellipsis">
    Security
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/snowflake/">
<span class="md-ellipsis">
    Snowflake
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/tools/">
<span class="md-ellipsis">
    Tools
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/visual-studio-code/">
<span class="md-ellipsis">
    Visual Studio Code
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="category/windows/">
<span class="md-ellipsis">
    Windows
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    About
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributions/">
<span class="md-ellipsis">
    Contributions
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Azure
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Azure
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    Security
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            Security
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
<span class="md-ellipsis">
    MCSB
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
            MCSB
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Readme/">
<span class="md-ellipsis">
    MCSB_v1 - Readme
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Asset%20Management/">
<span class="md-ellipsis">
    MCSB_v1 - Asset Management
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    MCSB_v1 - Backup and Recovery
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Data%20Protection/">
<span class="md-ellipsis">
    MCSB_v1 - Data Protection
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/DevOps%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - DevOps Security
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Endpoint%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - Endpoint Security
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Governance%20and%20Strategy/">
<span class="md-ellipsis">
    MCSB_v1 - Governance and Strategy
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Identity%20Management/">
<span class="md-ellipsis">
    MCSB_v1 - Identity Management
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Incident%20Response/">
<span class="md-ellipsis">
    MCSB_v1 - Incident Response
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    MCSB_v1 - Logging and Threat Detection
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Network%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - Network Security
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/">
<span class="md-ellipsis">
    MCSB_v1 - Posture and Vulnerability Mgmt
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Azure/Security/MCSB/Privileged%20Access/">
<span class="md-ellipsis">
    MCSB_v1 - Privileged Access
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="blog">Blog</h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-24 00:00:00">January 24, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-virtual-network-manager-a-comprehensive-guide"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/">Azure Virtual Network Manager: A Comprehensive Guide</a></h2>
<p>Azure Virtual Network Manager is a powerful management service that allows you to group, configure, deploy, and manage virtual networks across subscriptions on a global scale. It provides the ability to define network groups for logical segmentation of your virtual networks. You can then establish connectivity and security configurations and apply them across all selected virtual networks in network groups simultaneously.</p>
<h3 id="how-does-azure-virtual-network-manager-work"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#how-does-azure-virtual-network-manager-work">How Does Azure Virtual Network Manager Work?</a></h3>
<p>The functionality of Azure Virtual Network Manager revolves around a well-defined process:</p>
<ol>
<li>
<p><strong>Scope Definition:</strong> During the creation process, you determine the scope of what your Azure Virtual Network Manager will manage. The Network Manager only has delegated access to apply configurations within this defined scope boundary. Although you can directly define a scope on a list of subscriptions, it's recommended to use management groups for scope definition as they provide hierarchical organization to your subscriptions.</p>
</li>
<li>
<p><strong>Deployment of Configuration Types:</strong> After defining the scope, you deploy configuration types including Connectivity and SecurityAdmin rules for your Virtual Network Manager.</p>
</li>
<li>
<p><strong>Creation of Network Group:</strong> Post-deployment, you create a network group which acts as a logical container of networking resources for applying configurations at scale. You can manually select individual virtual networks to be added to your network group (static membership) or use Azure Policy to define conditions for dynamic group membership.</p>
</li>
<li>
<p><strong>Connectivity and Security Configurations:</strong> Next, you create connectivity and/or security configurations to be applied to those network groups based on your topology and security requirements. A connectivity configuration enables you to create a mesh or a hub-and-spoke network topology, while a security configuration lets you define a collection of rules that can be applied globally to one or more network groups.</p>
</li>
<li>
<p><strong>Deployment of Configurations:</strong> Once you've created your desired network groups and configurations, you can deploy the configurations to any region of your choosing.</p>
</li>
</ol>
<p>Azure Virtual Network Manager can be deployed and managed through various platforms such as the Azure portal, Azure CLI, Azure PowerShell, or Terraform.</p>
<h3 id="key-benefits-of-azure-virtual-network-manager"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#key-benefits-of-azure-virtual-network-manager">Key Benefits of Azure Virtual Network Manager</a></h3>
<ul>
<li>Centralized management of connectivity and security policies globally across regions and subscriptions.</li>
<li>Direct connectivity between spokes in a hub-and-spoke configuration without the complexity of managing a mesh network.</li>
<li>Highly scalable and highly available service with redundancy and replication across the globe.</li>
<li>Ability to create network security rules that override network security group rules.</li>
<li>Low latency and high bandwidth between resources in different virtual networks using virtual network peering.</li>
<li>Roll out network changes through a specific region sequence and frequency of your choosing.</li>
</ul>
<h3 id="use-cases-for-azure-virtual-network-manager"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#use-cases-for-azure-virtual-network-manager">Use Cases for Azure Virtual Network Manager</a></h3>
<p>Azure Virtual Network Manager is a versatile tool that can be used in a variety of scenarios:</p>
<ol>
<li>
<p><strong>Hub-and-Spoke Network Topology:</strong> Azure Virtual Network Manager is ideal for managing hub-and-spoke network topologies where you have a central hub virtual network that connects to multiple spoke virtual networks. You can easily create and manage these configurations at scale using Azure Virtual Network Manager.</p>
</li>
<li>
<p><strong>Global Connectivity and Security Policies:</strong> If you have a global presence with virtual networks deployed across multiple regions, Azure Virtual Network Manager allows you to define and apply connectivity and security policies globally, ensuring consistent network configurations across all regions.</p>
</li>
<li>
<p><strong>Network Segmentation and Isolation:</strong> Azure Virtual Network Manager enables you to segment and isolate your virtual networks based on your organizational requirements. You can create network groups and apply security configurations to enforce network isolation and access control.</p>
</li>
<li>
<p><strong>Centralized Network Management:</strong> For organizations with multiple subscriptions and virtual networks, Azure Virtual Network Manager provides a centralized management solution to manage network configurations, connectivity, and security policies across all subscriptions.</p>
</li>
<li>
<p><strong>Automated Network Configuration Deployment:</strong> By leveraging Azure Policy and Azure Virtual Network Manager, you can automate the deployment of network configurations based on predefined conditions, ensuring consistent network configurations and compliance across your Azure environment.</p>
</li>
</ol>
<h3 id="example-connectivity-and-security-configurations-forcing-a-network-security-rule"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#example-connectivity-and-security-configurations-forcing-a-network-security-rule">Example connectivity and security configurations forcing a Network Security Rule</a></h3>
<p>In Azure Virtual Network Manager:</p>
<p><img alt="alt text" src="2025/image-3.png"/></p>
<p>In Azure Virtual Network:</p>
<p><img alt="alt text" src="2025/image.png"/></p>
<h4 id="example-connectivity-configuration-forcing-a-hub-and-spoke-network-topology"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#example-connectivity-configuration-forcing-a-hub-and-spoke-network-topology">Example Connectivity Configuration forcing a Hub-and-Spoke Network Topology</a></h4>
<p>In Azure Virtual Network Manager:</p>
<p><img alt="alt text" src="2025/image-2.png"/></p>
<p>In Azure Virtual Network:</p>
<p><img alt="alt text" src="2025/image-1.png"/></p>
<h3 id="preview-features"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#preview-features">Preview Features</a></h3>
<p>At the time of writing, Azure Virtual Network Manager has some features in preview and may not be available in all regions. Some of the preview features include:</p>
<ul>
<li>IP address management: allows you to manage IP addresses by creating and assigning IP address pools to your virtual networks.</li>
<li>
<p>Virtual Network verifier: Enables you to check if your network policies allow or disallow traffic between your Azure network resources.</p>
</li>
<li>
<p>Configurations, creation of a routing is in preview, very interesting to manage the traffic between the different networks.</p>
</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#conclusion">Conclusion</a></h3>
<p>Azure Virtual Network Manager is a powerful service that simplifies the management of virtual networks in Azure. By providing a centralized platform to define and apply connectivity and security configurations at scale, Azure Virtual Network Manager streamlines network management tasks and ensures consistent network configurations across your Azure environment.</p>
<p>For up-to-date information on the regions where Azure Virtual Network Manager is available, refer to <a href="https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/table">Products available by region</a>.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-12-22 00:00:00">December 22, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/outlook/">Outlook</a></li>
<li class="md-meta__item">
            
              5 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="gtd-in-outlook-with-microsoft-to-do"><a class="toclink" href="2024/12/22/gtd-in-outlook-with-microsoft-to-do/">GTD in Outlook with Microsoft To Do</a></h2>
<p>In this post, we will see how to use GTD in Outlook.</p>
<p>Firs of all, let's define what GTD is. GTD stands for Getting Things Done, a productivity method created by David Allen. The GTD method is based on the idea that you should get things out of your head and into a trusted system, so you can focus on what you need to do.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The GTD method is not about doing more things faster. It's about doing the right things at the right time.
This method needs to be aligned with your purpose, objectives, and goals, so you can focus on what really matters to you.</p>
</div>
<h3 id="the-gtd-workflow"><a class="toclink" href="2024/12/22/gtd-in-outlook-with-microsoft-to-do/#the-gtd-workflow">The GTD workflow</a></h3>
<p>The GTD workflow consists of five steps:</p>
<ol>
<li>Capture: Collect everything that has your attention.</li>
<li>Clarify: Process what you've captured.</li>
<li>Organize: Put everything in its place.</li>
<li>Reflect: Review your system regularly.</li>
<li>Engage: Choose what to do and do it.</li>
</ol>
<p>The detailed flowchart of the GTD method is shown below:</p>
<pre class="mermaid"><code>graph TD;
    subgraph Capture    
    subgraph for_each_item_not_in_Inbox
    AA[Collect everything that has your attention in the Inbox];
    end    
    A[Inbox]
    AA--&gt;A
    end
    subgraph Clarify        
    subgraph for_each_item_in_Inbox
    BB[  What is this?
            What should I do?
            Is this really worth doing?
            How does it fit in with all the other things I have to do?
            Is there any action that needs to be done about it or because of it?]
    end
    end
    A --&gt; BB
    subgraph Organize
    BB --&gt; B{Is it actionable?}
    B -- no --&gt; C{Is it reference material?}
    C -- yes --&gt; D[Archive]
    C -- no --&gt; E{Is it trash?}
    E -- yes --&gt; FF[Trash it]
    E -- no --&gt; GG[Incubate it]
    GG --&gt; HH[Review it weekly]
    B -- yes --&gt; F{Can it be done in one step?}
    F -- no --&gt; G[Project]
    G --&gt; HHH[Define a next action at least]
    HHH --&gt; H[Project Actions]    
    end
    subgraph Engage
    H --&gt; I
    F -- yes --&gt; I{Does it take more than 2 minutes?}
    I -- no --&gt; J[DO IT]
    I -- yes --&gt; K{Is it my responsibility?}
    K -- no --&gt; L[Delegate]
    L --&gt; M[Waiting For]    
    K -- yes --&gt; N{Does it have a specific date?}
    N -- yes --&gt; O[Add to Calendar]
    N -- no --&gt; P[Next Actions]
    O --&gt; Q[Schedule. Do it at a specific time]
    P --&gt; R[Do it as soon as possible]
    end
</code></pre>
<pre class="mermaid"><code>graph TD;
subgraph Reflect
    S[**Daily Review**
            - Review your tasks daily
            - Calendar
            - Next  actions
            - Urgent tasks]
    T[**Weekly Review**
            - Review your projects weekly, make sure you're making progress
            - Next actions
            - Waiting for
            - Someday/Maybe
            - Calendar]
    U[**Monthly Review**
            - Focus on your goals
            - Reference archive
            - Someday/Maybe
            - Completed projects]
    V[**Review your purpose annually**
            - Goals and purposes
            - Big projects
            - Historical archive]
    end

</code></pre>
<p>It's important to note that the GTD method is not a one-size-fits-all solution. You can adapt it to your needs and preferences. The key is to find a system that works for you and stick to it.</p>
<p>And now, let's see how to use GTD in Outlook and Microsoft To Do.</p>
<h3 id="how-to-use-gtd-in-outlook-with-microsoft-to-do"><a class="toclink" href="2024/12/22/gtd-in-outlook-with-microsoft-to-do/#how-to-use-gtd-in-outlook-with-microsoft-to-do">How to use GTD in Outlook with Microsoft To Do</a></h3>
<p>When it comes to implementing the GTD method in Outlook, the key is to use the right tools and techniques. Microsoft To Do is a great tool for managing your tasks and projects, and it integrates seamlessly with Outlook.</p>
<p>You can use Outlook to implement the GTD method by following these steps:</p>
<ol>
<li>Capture:<ul>
<li>emails: Use the Inbox to collect everything that has your attention.</li>
<li>Other Things: Use Microsoft To Do Taks default list to capture tasks and projects.</li>
</ul>
</li>
<li>Clarify: Process what you've captured by asking yourself the following questions:<ul>
<li>What is this?</li>
<li>What should I do?</li>
<li>Is this really worth doing?</li>
<li>How does it fit in with all the other things I have to do?</li>
<li>Is there any action that needs to be done about it or because of it?</li>
</ul>
</li>
<li>Organize: Put everything in its place by following these steps:<ul>
<li>Inbox:<ul>
<li>Move emails to the appropriate folder or delete them.</li>
<li>Categories: Use categories to organize your emails by context and folder to organize your emails by project or client.</li>
<li>Use search folders to find emails quickly by category or categories, you can clear categories after processing.</li>
<li>Flags emails to add to To Do.</li>
<li>Create rules to automate repetitive tasks when clarifying one type of email has allways the same action.</li>
</ul>
</li>
<li>Tasks: Organize your tasks and projects in Microsoft To Do.<ul>
<li>Lists: Create lists for different types of tasks, one by context or use #tags for that in one lists. For example:<ul>
<li>In the case of lists: Agendas, Anywhere, Calls, Computed, Errands, Home, Office, Waiting For, Someday/Maybe.</li>
<li>In the case of tags, one list with: #Agendas, #Anywhere, #Calls, #Computed, #Errands, #Home, #Office, #WaitingFor, #SomedayMaybe.</li>
</ul>
</li>
<li>Use tag #nextaction to identify the next task to do.</li>
<li>Use tag #urgent to identify urgent tasks.</li>
</ul>
</li>
<li>Projects<ul>
<li>Group Lists: Group lists by category of projects or client.</li>
<li>One list per project: Create a list for each project and add tasks to it.</li>
<li>Use #nextaction tag to identify the next task in each project.</li>
</ul>
</li>
<li>Reference Material:<ul>
<li>Store reference material in folders, better in OneDrive or SharePoint.</li>
<li>Use a folder structure to organize your reference material</li>
<li>Use search folders to find it quickly.</li>
<li>Use tags to identify the context of the reference material. You can use <a href="https://github.com/Dijji/FileMeta?tab=readme-ov-file">FileMeta</a> to add tags to files in Windows for non-taggeable files.</li>
</ul>
</li>
</ul>
</li>
<li>Reflect: Review your system regularly to make sure it's up to date.<ul>
<li>Daily Review</li>
<li>Weekly Review</li>
<li>Monthly Review</li>
<li>Annual Review</li>
</ul>
</li>
<li>Engage: Choose what to do and do it.<ul>
<li>Use the My Day Bar to see your tasks and events at a glance or in search bar type #nextaction to see all your next actions.</li>
</ul>
</li>
</ol>
<p>These are just some ideas to get you started. You can adapt the GTD method to your needs and preferences. The key is to find a system that works for you and stick to it.</p>
<p>My example of GTD in Outlook with Microsoft To Do:</p>
<p>Outlook:</p>
<p><img alt="alt text" src="2024/12/image-1.png"/></p>
<p>To Do:</p>
<p><img alt="alt text" src="2024/12/image.png"/></p>
<p>I'm using a mix of lists and tags with the same name to organize my tasks and projects. I have lists for different types of tasks, such as Agendas, Anywhere, Calls, Computed, Errands, Home, Office, Waiting For, and Someday/Maybe. I also use tags to identify the next action, urgent tasks and context of the task in projects.</p>
<p>In the case of emails, I use categories to organize them by context and folders to organize them by project or client. I also use search folders to find emails quickly by category or categories and filter by unreads. The reason for this is that I can clear categories after processing and in the mayorie of cases, I only need a quick review of the emails without the need to convert them into tasks.</p>
<p>By following these steps, you can implement the GTD method in Outlook and Microsoft To Do and improve your productivity and focus.</p>
<p>Good luck! ð</p>
<h3 id="references"><a class="toclink" href="2024/12/22/gtd-in-outlook-with-microsoft-to-do/#references">References</a></h3>
<ul>
<li><a href="https://youtu.be/Nob50sN4be0">How to use Microsoft To Do for Getting Things Done (GTD)</a></li>
<li><a href="https://gettingthingsdone.com/">Getting Things Done: The Art of Stress-Free Productivity</a></li>
<li><a href="https://support.microsoft.com/en-us/office/manage-email-messages-by-using-rules-in-outlook-c24f5dea-9465-4df4-ad17-a50704d66c59">Manage email messages by using rules in Outlook</a></li>
<li><a href="https://github.com/Dijji/FileMeta?tab=readme-ov-file">FileMeta</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-12-21 00:00:00">December 21, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/visual-studio-code/">Visual Studio Code</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/">How to sign Git commits in Visual Studio Code in Windows Subsystem for Linux (WSL)</a></h2>
<p>In this post, we will see how to sign Git commits in Visual Studio Code.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Visual Studio Code</li>
<li>Git</li>
<li>gpg</li>
<li>gpg-agent</li>
<li>gpgconf</li>
<li>pinentry-gtk-2</li>
<li>Windows Subsystem for Linux (WSL) with Ubuntu 20.04</li>
</ul>
<h3 id="steps"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#steps">Steps</a></h3>
<h4 id="1-install-gpg"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#1-install-gpg">1. Install GPG</a></h4>
<p>First, you need to install GPG ans agents. You can do this by running the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gpg<span class="w"> </span>gpg-agent<span class="w"> </span>gpgconf<span class="w"> </span>pinentry-gtk2<span class="w"> </span>-y
</span></code></pre></div>
<h4 id="2-generate-a-gpg-key"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#2-generate-a-gpg-key">2. Generate a GPG key</a></h4>
<p>To generate a GPG key, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>gpg<span class="w"> </span>--full-generate-key
</span></code></pre></div>
<p>You will be asked to enter your name, email, and passphrase. After that, the key will be generated.</p>
<h4 id="3-list-your-gpg-keys"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#3-list-your-gpg-keys">3. List your GPG keys</a></h4>
<p>To list your GPG keys, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>gpg<span class="w"> </span>--list-secret-keys<span class="w"> </span>--keyid-format<span class="w"> </span>LONG
</span></code></pre></div>
<p>You will see a list of your GPG keys. Copy the key ID of the key you want to use.</p>
<h4 id="4-configure-git-to-use-your-gpg-key"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#4-configure-git-to-use-your-gpg-key">4. Configure Git to use your GPG key</a></h4>
<p>To configure Git to use your GPG key, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.signingkey<span class="w"> </span>YOUR_KEY_ID
</span></code></pre></div>
<p>Replace <code>YOUR_KEY_ID</code> with the key ID you copied in the previous step.</p>
<h4 id="5-configure-git-to-sign-commits-by-default"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#5-configure-git-to-sign-commits-by-default">5. Configure Git to sign commits by default</a></h4>
<p>To configure Git to sign commits by default, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>commit.gpgsign<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>gpg.program<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>gpg<span class="o">)</span>
</span></code></pre></div>
<h4 id="6-export-the-gpg-key"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#6-export-the-gpg-key">6. EXport the GPG key</a></h4>
<p>To export the GPG key, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>gpg<span class="w"> </span>--armor<span class="w"> </span>--export<span class="w"> </span>YOUR_KEY_ID
</span></code></pre></div>
<p>Replace <code>YOUR_KEY_ID</code> with the key ID you copied in the previous step.</p>
<h4 id="7-import-to-github"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#7-import-to-github">7. Import to github</a></h4>
<p>Go to your <a href="https://github.com/settings/keys">github account</a> and add the exported GPG key in GPG keys section, create a new GPG key and paste the exported key.</p>
<h4 id="configure-visual-studio-code-to-use-gpg"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#configure-visual-studio-code-to-use-gpg">Configure Visual Studio Code to use GPG</a></h4>
<h5 id="1-configure-gpg-agent"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#1-configure-gpg-agent">1. Configure gpg-agent</a></h5>
<p>To configure gpg-agent, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"default-cache-ttl"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.gnupg/gpg-agent.conf
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"pinentry-program /usr/bin/pinentry-gtk-2"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.gnupg/gpg-agent.conf
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"allow-preset-passphrase"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.gnupg/gpg-agent.conf
</span></code></pre></div>
<h4 id="2-restart-the-gpg-agent"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#2-restart-the-gpg-agent">2. Restart the gpg-agent</a></h4>
<p>To restart the gpg-agent, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>gpgconf<span class="w"> </span>--kill<span class="w"> </span>gpg-agent
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>gpgconf<span class="w"> </span>--launch<span class="w"> </span>gpg-agent
</span></code></pre></div>
<h4 id="3-sign-a-commit"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#3-sign-a-commit">3. Sign a commit</a></h4>
<p>To sign a commit, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>git<span class="w"> </span>commit<span class="w"> </span>-S<span class="w"> </span>-m<span class="w"> </span><span class="s2">"Your commit message"</span>
</span></code></pre></div>
<h4 id="4-verify-the-signature"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#4-verify-the-signature">4. Verify the signature</a></h4>
<p>To verify the signature of a commit, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>git<span class="w"> </span>verify-commit<span class="w"> </span>HEAD
</span></code></pre></div>
<h4 id="5-configure-visual-studio-code-to-use-gpg"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#5-configure-visual-studio-code-to-use-gpg">5. Configure Visual Studio Code to use GPG</a></h4>
<p>To configure Visual Studio Code to use GPG, open the settings by pressing <code>Ctrl + ,</code> and search for <code>git.enableCommitSigning</code>. Set the value to <code>true</code>.</p>
<h4 id="6-sign-a-commit"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#6-sign-a-commit">6. Sign a commit</a></h4>
<p>Make a commit in Visual Studio Code, and you will see a prompt asking you introduce your GPG passphrase. Enter your passphrase, and the commit will be signed.</p>
<p>That's it! Now you know how to sign Git commits in Visual Studio Code.</p>
<h3 id="some-tips"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#some-tips">Some tips</a></h3>
<h3 id="for-all-repositories"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#for-all-repositories">For all repositories</a></h3>
<ul>
<li>Establish your email in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span><span class="s2">"petete@something.es"</span>
</span></code></pre></div>
<ul>
<li>Establish your name in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">"Petete"</span>
</span></code></pre></div>
<ul>
<li>Establish your GPG key in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.signingkey<span class="w"> </span>YOUR_KEY_ID
</span></code></pre></div>
<ul>
<li>Establish your GPG program in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>gpg.program<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>gpg<span class="o">)</span>
</span></code></pre></div>
<h3 id="for-a-specific-repository"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#for-a-specific-repository">For a specific repository</a></h3>
<ul>
<li>Establish your email in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>git<span class="w"> </span>config<span class="w"> </span>user.email<span class="w"> </span><span class="s2">"petete@something.es"</span>
</span></code></pre></div>
<ul>
<li>Establish your name in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>git<span class="w"> </span>config<span class="w"> </span>user.name<span class="w"> </span><span class="s2">"Petete"</span>
</span></code></pre></div>
<ul>
<li>Establish your GPG key in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>git<span class="w"> </span>config<span class="w"> </span>user.signingkey<span class="w"> </span>YOUR_KEY_ID
</span></code></pre></div>
<ul>
<li>Establish your GPG program in git configuration:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>git<span class="w"> </span>config<span class="w"> </span>gpg.program<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>gpg<span class="o">)</span>
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="2024/12/21/how-to-sign-git-commits-in-visual-studio-code-in-windows-subsystem-for-linux-wsl/#conclusion">Conclusion</a></h3>
<p>In this post, we saw how to sign Git commits in Visual Studio Code. This is useful if you want to verify the authenticity of your commits. I hope you found this post helpful. If you have any questions or comments, please let me know. Thank you for reading!</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-12-12 00:00:00">December 12, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/hashicorp/">HashiCorp</a></li>
<li class="md-meta__item">
            
              1 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="ejecutar-terraform-con-archivos-de-variables"><a class="toclink" href="2024/12/12/ejecutar-terraform-con-archivos-de-variables/">Ejecutar Terraform con archivos de variables</a></h2>
<p>Script para ejecutar Terraform con archivos de variables:</p>
<div class="language-bash highlight"><span class="filename">terraform_with_var_files.sh</span><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">function</span><span class="w"> </span>terraform_with_var_files<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">dir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">action</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">auto</span><span class="o">=</span><span class="s2">"</span><span class="nv">$3</span><span class="s2">"</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"El directorio especificado no existe."</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$action</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"plan"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"</span><span class="nv">$action</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"apply"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"</span><span class="nv">$action</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"destroy"</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"AcciÃ³n no vÃ¡lida. Usa 'plan', 'apply' o 'destroy'."</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">var_files</span><span class="o">=()</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>/*.tfvars<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">      </span><span class="nv">var_files</span><span class="o">+=(</span><span class="s2">"--var-file </span><span class="nv">$file</span><span class="s2">"</span><span class="o">)</span>
</span><span id="__span-0-20"><a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-0-21"><a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">  </span><span class="k">done</span>
</span><span id="__span-0-22"><a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${#</span><span class="nv">var_files</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-24"><a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"No se encontraron archivos .tfvars en el directorio especificado."</span>
</span><span id="__span-0-25"><a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-26"><a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-0-27"><a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Validando la configuraciÃ³n de Terraform..."</span>
</span><span id="__span-0-29"><a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">  </span><span class="o">(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>terraform<span class="w"> </span>validate<span class="o">)</span>
</span><span id="__span-0-30"><a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-31"><a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"La validaciÃ³n de Terraform fallÃ³."</span>
</span><span id="__span-0-32"><a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-33"><a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-0-34"><a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">command</span><span class="o">=</span><span class="s2">"terraform </span><span class="nv">$action</span><span class="s2"> </span><span class="si">${</span><span class="nv">var_files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-36"><a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$auto</span><span class="s2">"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auto"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="s2">"</span><span class="nv">$action</span><span class="s2">"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"apply"</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">"</span><span class="nv">$action</span><span class="s2">"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"destroy"</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-38"><a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="nv">command</span><span class="o">=</span><span class="s2">"</span><span class="nv">$command</span><span class="s2"> -auto-approve"</span>
</span><span id="__span-0-39"><a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-0-40"><a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Ejecutando: </span><span class="nv">$command</span><span class="s2">"</span>
</span><span id="__span-0-42"><a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">  </span><span class="nb">eval</span><span class="w"> </span><span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span>
</span><span id="__span-0-43"><a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="o">}</span>
</span><span id="__span-0-44"><a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="c1"># Uso de la funciÃ³n</span>
</span><span id="__span-0-46"><a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="c1"># terraform_with_var_files "/ruta/al/directorio" "plan"</span>
</span><span id="__span-0-47"><a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="c1"># terraform_with_var_files "/ruta/al/directorio" "apply" "auto"</span>
</span><span id="__span-0-48"><a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="c1"># terraform_with_var_files "/ruta/al/directorio" "destroy" "auto"</span>
</span></code></pre></div>
<p>Para cargar la funciÃ³n en tu terminal, copia y pega el script en tu archivo <code>.bashrc</code>, <code>.zshrc</code> o el que toque y recarga tu terminal.</p>
<p>Espero que os sea de utilidad. Â¡Saludos!</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-11-20 00:00:00">November 20, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="develop-my-firts-policy-for-kubernetes-with-minikube-and-gatekeeper"><a class="toclink" href="2024/11/20/develop-my-firts-policy-for-kubernetes-with-minikube-and-gatekeeper/">Develop my firts policy for Kubernetes with minikube and gatekeeper</a></h2>
<p>Now that we have our <a href="20241119_howto_develop_test_policies_minikube_01">development environment</a>, we can start developing our first policy for Kubernetes with minikube and gatekeeper.</p>
<p>First at all, we need some visual code editor to write our policy. I recommend using Visual Studio Code, but you can use any other editor. Exists a plugin for Visual Studio Code that helps you to write policies for gatekeeper. You can install it from the marketplace: <a href="https://marketplace.visualstudio.com/items?itemName=tsandall.opa">Open Policy Agent</a>.</p>
<p>Once you have your editor ready, you can start writing your policy. In this example, we will create a policy that denies the creation of pods with the image <code>nginx:latest</code>.</p>
<p>For that we need two files:</p>
<ul>
<li><code>constraint.yaml</code>: This file defines the constraint that we want to apply.</li>
<li><code>constraint_template.yaml</code>: This file defines the template that we will use to create the constraint.</li>
</ul>
<p>Let's start with the <code>constraint_template.yaml</code> file:</p>
<div class="language-yaml highlight"><span class="filename">constraint_template.yaml</span><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">templates.gatekeeper.sh/v1beta1</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConstraintTemplate</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8sdenypodswithnginxlatest</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="nt">crd</span><span class="p">:</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">      </span><span class="nt">names</span><span class="p">:</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K8sDenyPodsWithNginxLatest</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="nt">targets</span><span class="p">:</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admission.k8s.gatekeeper.sh</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">      </span><span class="nt">rego</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">        </span><span class="no">package k8sdenypodswithnginxlatest</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="no">violation[{"msg": msg}] {</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">          </span><span class="no">input.review.object.spec.containers[_].image == "nginx:latest"</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">          </span><span class="no">msg := "Containers cannot use the nginx:latest image"</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">        </span><span class="no">}</span>
</span></code></pre></div>
<p>Now, let's create the <code>constraint.yaml</code> file:</p>
<div class="language-yaml highlight"><span class="filename">constraint.yaml</span><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constraints.gatekeeper.sh/v1beta1</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K8sDenyPodsWithNginxLatest</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny-pods-with-nginx-latest</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nt">kinds</span><span class="p">:</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">""</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">        </span><span class="nt">kinds</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"Pod"</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">"Containers</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">nginx:latest</span><span class="nv"> </span><span class="s">image"</span>
</span></code></pre></div>
<p>Now, we can apply the files to our cluster:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Create the constraint template</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>constraint_template.yaml
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c1"># Create the constraint</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>constraint.yaml
</span></code></pre></div>
<p>Now, we can test the constraint. Let's create a pod with the image <code>nginx:latest</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="s">apiVersion: v1</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="s">kind: Pod</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="s">metadata:</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="s">  name: nginx-pod</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="s">spec:</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="s">  containers:</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="s">  - name: nginx</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="s">    image: nginx:latest</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="s">EOF</span>
</span></code></pre></div>
<p>We must see an error message like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>Error<span class="w"> </span>from<span class="w"> </span>server<span class="w"> </span><span class="o">(</span>Forbidden<span class="o">)</span>:<span class="w"> </span>error<span class="w"> </span>when<span class="w"> </span>creating<span class="w"> </span><span class="s2">"STDIN"</span>:<span class="w"> </span>admission<span class="w"> </span>webhook<span class="w"> </span><span class="s2">"validation.gatekeeper.sh"</span><span class="w"> </span>denied<span class="w"> </span>the<span class="w"> </span>request:<span class="w"> </span><span class="o">[</span>k8sdenypodswithnginxlatest<span class="o">]</span><span class="w"> </span>Containers<span class="w"> </span>cannot<span class="w"> </span>use<span class="w"> </span>the<span class="w"> </span>nginx:latest<span class="w"> </span>image
</span></code></pre></div>
<p>Now, let's create a pod with a different image:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="s">apiVersion: v1</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="s">kind: Pod</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="s">metadata:</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="s">  name: nginx-pod</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="s">spec:</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="s">  containers:</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="s">  - name: nginx</span>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="s">    image: nginx:1.25.5</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="s">EOF</span>
</span></code></pre></div>
<p>We must see a message like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>pod/nginx-pod<span class="w"> </span>created
</span></code></pre></div>
<p>For cleaning up, you can delete pod,the constraint and the constraint template:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Delete the pod</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>nginx-pod
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="c1"># Delete the constraint</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>constraint.yaml
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="c1"># Delete the constraint template</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>constraint_template.yaml
</span></code></pre></div>
<p>And that's it! We have developed our first policy for Kubernetes with minikube and gatekeeper. Now you can start developing more complex policies and test them in your cluster.</p>
<p>Happy coding!</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-11-19 00:00:00">November 19, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/">How to create a local environment to write policies for Kubernetes with minikube and gatekeeper</a></h2>
<h3 id="minikube-in-wsl2"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#minikube-in-wsl2">minikube in wsl2</a></h3>
<h4 id="enable-systemd-in-wsl2"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#enable-systemd-in-wsl2">Enable systemd in WSL2</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/wsl.conf
</span></code></pre></div>
<p>Add the following:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="o">[</span>boot<span class="o">]</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nv">systemd</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<p>Restart WSL2 in command:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>wsl --shutdown
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>wsl
</span></code></pre></div>
<h4 id="install-docker"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#install-docker">Install docker</a></h4>
<p><a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">Install docker using repository</a></p>
<h3 id="minikube"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#minikube">Minikube</a></h3>
<h4 id="install-minikube"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#install-minikube">Install minikube</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Download the latest Minikube</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>minikube<span class="w"> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="c1"># Make it executable</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./minikube
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="c1"># Move it to your user's executable PATH</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./minikube<span class="w"> </span>/usr/local/bin/
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="c1">#Set the driver version to Docker</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>minikube<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>driver<span class="w"> </span>docker
</span></code></pre></div>
<h4 id="test-minikube"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#test-minikube">Test minikube</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Enable completion</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nb">source</span><span class="w"> </span>&lt;<span class="o">(</span>minikube<span class="w"> </span>completion<span class="w"> </span>bash<span class="o">)</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1"># Start minikube</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>minikube<span class="w"> </span>start
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="c1"># Check the status</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>minikube<span class="w"> </span>status
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># set context</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>minikube
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="c1"># get pods</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces
</span></code></pre></div>
<h3 id="install-opa-gatekeeper"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#install-opa-gatekeeper">Install OPA Gatekeeper</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Install OPA Gatekeeper</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="c1"># check version in https://open-policy-agent.github.io/gatekeeper/website/docs/install#deploying-a-release-using-prebuilt-image</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/open-policy-agent/gatekeeper/v3.17.1/deploy/gatekeeper.yaml
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="c1"># wait and check the status</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>sleep<span class="w"> </span><span class="m">60</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>gatekeeper-system
</span></code></pre></div>
<h3 id="test-constraints"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#test-constraints">Test constraints</a></h3>
<p>First, we need to create a constraint template and a constraint.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Create a constraint template</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/open-policy-agent/gatekeeper/v3.17.1/demo/basic/templates/k8srequiredlabels_template.yaml
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="c1"># Create a constraint</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/open-policy-agent/gatekeeper/v3.17.1/demo/basic/constraints/k8srequiredlabels_constraint.yaml
</span></code></pre></div>
<p>Now, we can test the constraint.</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Create a deployment without the required label</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>petete<span class="w"> </span>
</span></code></pre></div>
We must see an error message like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>Error<span class="w"> </span>from<span class="w"> </span>server<span class="w"> </span><span class="o">(</span>Forbidden<span class="o">)</span>:<span class="w"> </span>admission<span class="w"> </span>webhook<span class="w"> </span><span class="s2">"validation.gatekeeper.sh"</span><span class="w"> </span>denied<span class="w"> </span>the<span class="w"> </span>request:<span class="w"> </span><span class="o">[</span>ns-must-have-gk<span class="o">]</span><span class="w"> </span>you<span class="w"> </span>must<span class="w"> </span>provide<span class="w"> </span>labels:<span class="w"> </span><span class="o">{</span><span class="s2">"gatekeeper"</span><span class="o">}</span>
</span></code></pre></div>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Create a deployment with the required label</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="s">apiVersion: v1</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="s">kind: Namespace</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="s">metadata:</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="s">  name: petete</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="s">  labels:</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="s">    gatekeeper: "true"</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="s">EOF</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespaces<span class="w"> </span>petete
</span></code></pre></div>
We must see a message like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>NAME<span class="w">     </span>STATUS<span class="w">   </span>AGE
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>petete<span class="w">   </span>Active<span class="w">   </span>3s
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#conclusion">Conclusion</a></h3>
<p>We have created a local environment to write policies for Kubernetes with minikube and gatekeeper. We have tested the environment with a simple constraint. Now we can write our own policies and test them in our local environment.</p>
<h3 id="references"><a class="toclink" href="2024/11/19/how-to-create-a-local-environment-to-write-policies-for-kubernetes-with-minikube-and-gatekeeper/#references">References</a></h3>
<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/">Minikube</a></li>
<li><a href="https://open-policy-agent.github.io/gatekeeper/website/docs/install">OPA Gatekeeper</a></li>
<li><a href="https://open-policy-agent.github.io/gatekeeper/website/docs/howto/">How to use Gatekeeper</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/wsl/install">WSL2</a></li>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">Docker</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-11-06 00:00:00">November 6, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="trigger-an-on-demand-azure-policy-compliance-evaluation-scan"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/">Trigger an on-demand Azure Policy compliance evaluation scan</a></h2>
<p>Azure Policy is a service in Azure that you can use to create, assign, and manage policies that enforce different rules and effects over your resources. These policies can help you stay compliant with your corporate standards and service-level agreements. In this article, we will discuss how to trigger a scan with Azure Policy.</p>
<h3 id="what-is-a-scan-in-azure-policy"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/#what-is-a-scan-in-azure-policy">What is a scan in Azure Policy</a></h3>
<p>A scan in Azure Policy is a process that evaluates your resources against a set of policies to determine if they are compliant. When you trigger a scan, Azure Policy evaluates your resources and generates a compliance report that shows the results of the evaluation. The compliance report includes information about the policies that were evaluated, the resources that were scanned, and the compliance status of each resource.</p>
<p>You can trigger a scan in Azure Policy using the Azure CLI, PowerShell, or the Azure portal. When you trigger a scan, you can specify the scope of the scan, the policies to evaluate, and other parameters that control the behavior of the scan.</p>
<h3 id="trigger-a-scan-with-the-azure-cli"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/#trigger-a-scan-with-the-azure-cli">Trigger a scan with the Azure CLI</a></h3>
<p>To trigger a scan with the Azure CLI, you can use the <code>az policy state trigger-scan</code> command. This command triggers a policy compliance evaluation for a scope</p>
<p>How to trigger a scan with the Azure CLI for active subscription:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>az policy state trigger-scan 
</span></code></pre></div>
<p>How to trigger a scan with the Azure CLI for a specific resource group:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>az policy state trigger-scan --resource-group myResourceGroup
</span></code></pre></div>
<h3 id="trigger-a-scan-with-powershell"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/#trigger-a-scan-with-powershell">Trigger a scan with PowerShell</a></h3>
<p>To trigger a scan with PowerShell, you can use the <code>Start-AzPolicyComplianceScan</code> cmdlet. This cmdlet triggers a policy compliance evaluation for a scope.</p>
<p>How to trigger a scan with PowerShell for active subscription:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nb">Start-AzPolicyComplianceScan</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nv">$job</span> <span class="p">=</span> <span class="nb">Start-AzPolicyComplianceScan</span> <span class="n">-AsJob</span>
</span></code></pre></div>
<p>How to trigger a scan with PowerShell for a specific resource group:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nb">Start-AzPolicyComplianceScan</span> <span class="n">-ResourceGroupName</span> <span class="s1">'MyRG'</span>
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/#conclusion">Conclusion</a></h3>
<p>In this article, we discussed how to trigger a scan with Azure Policy. We covered how to trigger a scan using the Azure CLI and PowerShell. By triggering a scan, you can evaluate your resources against a set of policies to determine if they are compliant. This can help you ensure that your resources are compliant with your organization's standards and best practices.</p>
<h3 id="references"><a class="toclink" href="2024/11/06/trigger-an-on-demand-azure-policy-compliance-evaluation-scan/#references">References</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/governance/policy/how-to/get-compliance-data#on-demand-evaluation-scan">On-demand evaluation scan</a> </li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-11-05 00:00:00">November 5, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              8 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="custom-azure-policy-for-kubernetes"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/">Custom Azure Policy for Kubernetes</a></h2>
<p>Azure Policy is a service in Azure that you can use to create, assign, and manage policies that enforce different rules and effects over your resources. These policies can help you stay compliant with your corporate standards and service-level agreements. In this article, we will discuss how to create a custom Azure Policy for Kubernetes.</p>
<h3 id="how-azure-policy-works-in-kubernetes"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/#how-azure-policy-works-in-kubernetes">How Azure Policy works in kubernetes</a></h3>
<p>Azure Policy for Kubernetes is an extension of Azure Policy that allows you to enforce policies on your Kubernetes clusters. You can use Azure Policy to define policies that apply to your Kubernetes resources, such as pods, deployments, and services. These policies can help you ensure that your Kubernetes clusters are compliant with your organization's standards and best practices.</p>
<p>Azure Policy for Kubernetes uses Gatekeeper, an open-source policy controller for Kubernetes, to enforce policies on your clusters. Gatekeeper uses the Open Policy Agent (OPA) policy language to define policies and evaluate them against your Kubernetes resources. You can use Gatekeeper to create custom policies that enforce specific rules and effects on your clusters.</p>
<pre class="mermaid"><code>graph TD
    A[Azure Policy] --&gt;|Enforce policies| B["add-on azure-policy(Gatekeeper)"]
    B --&gt;|Evaluate policies| C[Kubernetes resources]
</code></pre>
<p>Azure Policy for Kubernetes supports the following cluster environments:</p>
<ul>
<li>Azure Kubernetes Service (AKS), through Azure Policy's Add-on for AKS</li>
<li>Azure Arc enabled Kubernetes, through Azure Policy's Extension for Arc</li>
</ul>
<h3 id="prepare-your-environment"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/#prepare-your-environment">Prepare your environment</a></h3>
<p>Before you can create custom Azure Policy for Kubernetes, you need to set up your environment. You will need an Azure Kubernetes Service (AKS) cluster with the Azure Policy add-on enabled. You will also need the Azure CLI and the <a href="https://learn.microsoft.com/en-us/azure/governance/policy/how-to/extension-for-vscode">Azure Policy extension</a> for Visual Studio Code.</p>
<p>To set up your environment, follow these steps:</p>
<ol>
<li>
<p>Create a resource group</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>az group create --name myResourceGroup --location spaincentral
</span></code></pre></div>
</li>
<li>
<p>Create an Azure Kubernetes Service (AKS) cluster with default settings and one node:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>az aks create --resource-group myResourceGroup --name myAKSCluster --node-count 1
</span></code></pre></div>
</li>
<li>
<p>Enable Azure Policies for the cluster:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>az aks enable-addons --resource-group myResourceGroup --name myAKSCluster --addons azure-policy
</span></code></pre></div>
</li>
<li>
<p>Check the status of the add-on:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>az aks show --resource-group myResourceGroup --name myAKSCluster --query addonProfiles.azurepolicy.enabled
</span></code></pre></div>
</li>
<li>
<p>Check the status of gatekeeper:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a># Install kubectl and kubelogin
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>az aks install-cli --install-location .local/bin/kubectl --kubelogin-install-location .local/bin/kubelogin
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a># Get the credentials for the AKS cluster
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>az aks get-credentials --resource-group myResourceGroup --name myAKSCluster --overwrite-existing
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a># azure-policy pod is installed in kube-system namespace
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>kubectl get pods -n kube-system
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a># gatekeeper pod is installed in gatekeeper-system namespace
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>kubectl get pods -n gatekeeper-system
</span></code></pre></div>
</li>
<li>
<p>Install vscode and the Azure Policy extension</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>code<span class="w"> </span>--install-extension<span class="w"> </span>ms-azuretools.vscode-azurepolicy
</span></code></pre></div>
</li>
</ol>
<p>Once you have set up your environment, you can create custom Azure Policy for Kubernetes.</p>
<h3 id="how-to-create-a-custom-azure-policy-for-kubernetes"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/#how-to-create-a-custom-azure-policy-for-kubernetes">How to create a custom Azure Policy for Kubernetes</a></h3>
<p>To create a custom Azure Policy for Kubernetes, you need to define a policy in the Open Policy Agent (OPA) policy language and apply it to your Kubernetes cluster. You can define policies that enforce specific rules and effects on your Kubernetes resources, such as pods, deployments, and services.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It`s recommended to review Constraint Templates in <a href="https://open-policy-agent.github.io/gatekeeper/website/docs/howto/">How to use Gatekeeper</a></p>
</div>
<p>To create a custom Azure Policy for Kubernetes, follow these steps:</p>
<ol>
<li>
<p>Define a constraint template for the policy, I will use an existing constraint template from the Gatekeeper library that requires Ingress resources to be HTTPS only:</p>
<div class="language-yaml highlight"><span class="filename">gatekeeper-library/library/general/httpsonly/template.yaml</span><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">templates.gatekeeper.sh/v1</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConstraintTemplate</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8shttpsonly</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="nt">metadata.gatekeeper.sh/title</span><span class="p">:</span><span class="w"> </span><span class="s">"HTTPS</span><span class="nv"> </span><span class="s">Only"</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">        </span><span class="nt">metadata.gatekeeper.sh/version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.2</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">Requires Ingress resources to be HTTPS only.  Ingress resources must</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">include the `kubernetes.io/ingress.allow-http` annotation, set to `false`.</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">By default a valid TLS {} configuration is required, this can be made</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">optional by setting the `tlsOptional` parameter to `true`.</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.io/docs/concepts/services-networking/ingress/#tls</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="nt">crd</span><span class="p">:</span>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="nt">names</span><span class="p">:</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K8sHttpsOnly</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="nt">validation</span><span class="p">:</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">        </span><span class="c1"># Schema for the `parameters` field</span>
</span><span id="__span-6-22"><a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">        </span><span class="nt">openAPIV3Schema</span><span class="p">:</span>
</span><span id="__span-6-23"><a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-6-24"><a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-6-25"><a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">            </span><span class="no">Requires Ingress resources to be HTTPS only.  Ingress resources must</span>
</span><span id="__span-6-26"><a href="#__codelineno-6-26" id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">            </span><span class="no">include the `kubernetes.io/ingress.allow-http` annotation, set to</span>
</span><span id="__span-6-27"><a href="#__codelineno-6-27" id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">            </span><span class="no">`false`. By default a valid TLS {} configuration is required, this</span>
</span><span id="__span-6-28"><a href="#__codelineno-6-28" id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">            </span><span class="no">can be made optional by setting the `tlsOptional` parameter to</span>
</span><span id="__span-6-29"><a href="#__codelineno-6-29" id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">            </span><span class="no">`true`.</span>
</span><span id="__span-6-30"><a href="#__codelineno-6-30" id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">        </span><span class="nt">properties</span><span class="p">:</span>
</span><span id="__span-6-31"><a href="#__codelineno-6-31" id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">            </span><span class="nt">tlsOptional</span><span class="p">:</span>
</span><span id="__span-6-32"><a href="#__codelineno-6-32" id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</span><span id="__span-6-33"><a href="#__codelineno-6-33" id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"When</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">`true`</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">TLS</span><span class="nv"> </span><span class="s">{}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">optional,</span><span class="nv"> </span><span class="s">defaults</span><span class="w"> </span>
</span><span id="__span-6-34"><a href="#__codelineno-6-34" id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">            </span><span class="s">to</span><span class="nv"> </span><span class="s">false."</span>
</span><span id="__span-6-35"><a href="#__codelineno-6-35" id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="nt">targets</span><span class="p">:</span>
</span><span id="__span-6-36"><a href="#__codelineno-6-36" id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admission.k8s.gatekeeper.sh</span>
</span><span id="__span-6-37"><a href="#__codelineno-6-37" id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">    </span><span class="nt">rego</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-6-38"><a href="#__codelineno-6-38" id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">        </span><span class="no">package k8shttpsonly</span>
</span><span id="__span-6-39"><a href="#__codelineno-6-39" id="__codelineno-6-39" name="__codelineno-6-39"></a>
</span><span id="__span-6-40"><a href="#__codelineno-6-40" id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="w">        </span><span class="no">violation[{"msg": msg}] {</span>
</span><span id="__span-6-41"><a href="#__codelineno-6-41" id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">        </span><span class="no">input.review.object.kind == "Ingress"</span>
</span><span id="__span-6-42"><a href="#__codelineno-6-42" id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="w">        </span><span class="no">regex.match("^(extensions|networking.k8s.io)/", input.review.object.apiVersion)</span>
</span><span id="__span-6-43"><a href="#__codelineno-6-43" id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="w">        </span><span class="no">ingress := input.review.object</span>
</span><span id="__span-6-44"><a href="#__codelineno-6-44" id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">        </span><span class="no">not https_complete(ingress)</span>
</span><span id="__span-6-45"><a href="#__codelineno-6-45" id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="w">        </span><span class="no">not tls_is_optional</span>
</span><span id="__span-6-46"><a href="#__codelineno-6-46" id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="w">        </span><span class="no">msg := sprintf("Ingress should be https. tls configuration and allow-http=false annotation are required for %v", [ingress.metadata.name])</span>
</span><span id="__span-6-47"><a href="#__codelineno-6-47" id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">        </span><span class="no">}</span>
</span><span id="__span-6-48"><a href="#__codelineno-6-48" id="__codelineno-6-48" name="__codelineno-6-48"></a>
</span><span id="__span-6-49"><a href="#__codelineno-6-49" id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="w">        </span><span class="no">violation[{"msg": msg}] {</span>
</span><span id="__span-6-50"><a href="#__codelineno-6-50" id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="w">        </span><span class="no">input.review.object.kind == "Ingress"</span>
</span><span id="__span-6-51"><a href="#__codelineno-6-51" id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">        </span><span class="no">regex.match("^(extensions|networking.k8s.io)/", input.review.object.apiVersion)</span>
</span><span id="__span-6-52"><a href="#__codelineno-6-52" id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">        </span><span class="no">ingress := input.review.object</span>
</span><span id="__span-6-53"><a href="#__codelineno-6-53" id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">        </span><span class="no">not annotation_complete(ingress)</span>
</span><span id="__span-6-54"><a href="#__codelineno-6-54" id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="w">        </span><span class="no">tls_is_optional</span>
</span><span id="__span-6-55"><a href="#__codelineno-6-55" id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="w">        </span><span class="no">msg := sprintf("Ingress should be https. The allow-http=false annotation is required for %v", [ingress.metadata.name])</span>
</span><span id="__span-6-56"><a href="#__codelineno-6-56" id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="w">        </span><span class="no">}</span>
</span><span id="__span-6-57"><a href="#__codelineno-6-57" id="__codelineno-6-57" name="__codelineno-6-57"></a>
</span><span id="__span-6-58"><a href="#__codelineno-6-58" id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="w">        </span><span class="no">https_complete(ingress) = true {</span>
</span><span id="__span-6-59"><a href="#__codelineno-6-59" id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="w">        </span><span class="no">ingress.spec["tls"]</span>
</span><span id="__span-6-60"><a href="#__codelineno-6-60" id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="w">        </span><span class="no">count(ingress.spec.tls) &gt; 0</span>
</span><span id="__span-6-61"><a href="#__codelineno-6-61" id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="w">        </span><span class="no">ingress.metadata.annotations["kubernetes.io/ingress.allow-http"] == "false"</span>
</span><span id="__span-6-62"><a href="#__codelineno-6-62" id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="w">        </span><span class="no">}</span>
</span><span id="__span-6-63"><a href="#__codelineno-6-63" id="__codelineno-6-63" name="__codelineno-6-63"></a>
</span><span id="__span-6-64"><a href="#__codelineno-6-64" id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="w">        </span><span class="no">annotation_complete(ingress) = true {</span>
</span><span id="__span-6-65"><a href="#__codelineno-6-65" id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="w">        </span><span class="no">ingress.metadata.annotations["kubernetes.io/ingress.allow-http"] == "false"</span>
</span><span id="__span-6-66"><a href="#__codelineno-6-66" id="__codelineno-6-66" name="__codelineno-6-66"></a><span class="w">        </span><span class="no">}</span>
</span><span id="__span-6-67"><a href="#__codelineno-6-67" id="__codelineno-6-67" name="__codelineno-6-67"></a>
</span><span id="__span-6-68"><a href="#__codelineno-6-68" id="__codelineno-6-68" name="__codelineno-6-68"></a><span class="w">        </span><span class="no">tls_is_optional {</span>
</span><span id="__span-6-69"><a href="#__codelineno-6-69" id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">        </span><span class="no">parameters := object.get(input, "parameters", {})</span>
</span><span id="__span-6-70"><a href="#__codelineno-6-70" id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="w">        </span><span class="no">object.get(parameters, "tlsOptional", false) == true</span>
</span><span id="__span-6-71"><a href="#__codelineno-6-71" id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="w">        </span><span class="no">}</span>
</span></code></pre></div>
</li>
</ol>
<p>This constrains requires Ingress resources to be HTTPS only</p>
<ol>
<li>
<p>Create an Azure Policy for this constraint template</p>
<ol>
<li>Open the restriction template created earlier in Visual Studio Code.</li>
<li>Click on Azure Policy icon in the Activity Bar.</li>
<li>Click on View &gt; Command Palette.</li>
<li>Search for the command "Azure Policy for Kubernetes: Create Policy Definition from Constraint Template or Mutation", select base64, this command will create a policy definition from the constraint template.
<div class="language-json highlight"><span class="filename">Untitled.json</span><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="nt">"policyType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom"</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Kubernetes.Data"</span><span class="p">,</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/* EDIT HERE */"</span><span class="p">,</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/* EDIT HERE */"</span><span class="p">,</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="nt">"policyRule"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="nt">"if"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type"</span><span class="p">,</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">        </span><span class="nt">"in"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">        </span><span class="s2">"Microsoft.ContainerService/managedClusters"</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="nt">"then"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">        </span><span class="nt">"effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('effect')]"</span><span class="p">,</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">        </span><span class="nt">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">        </span><span class="nt">"templateInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">            </span><span class="nt">"sourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Base64Encoded"</span><span class="p">,</span>
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">            </span><span class="nt">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"YXBpVmVyc2lvbjogdGVtcGxhdGVzLmdhdGVrZWVwZXIuc2gvdjEKa2luZDogQ29uc3RyYWludFRlbXBsYXRlCm1ldGFkYXRhOgogIG5hbWU6IGs4c2h0dHBzb25seQogIGFubm90YXRpb25zOgogICAgbWV0YWRhdGEuZ2F0ZWtlZXBlci5zaC90aXRsZTogIkhUVFBTIE9ubHkiCiAgICBtZXRhZGF0YS5nYXRla2VlcGVyLnNoL3ZlcnNpb246IDEuMC4yCiAgICBkZXNjcmlwdGlvbjogPi0KICAgICAgUmVxdWlyZXMgSW5ncmVzcyByZXNvdXJjZXMgdG8gYmUgSFRUUFMgb25seS4gIEluZ3Jlc3MgcmVzb3VyY2VzIG11c3QKICAgICAgaW5jbHVkZSB0aGUgYGt1YmVybmV0ZXMuaW8vaW5ncmVzcy5hbGxvdy1odHRwYCBhbm5vdGF0aW9uLCBzZXQgdG8gYGZhbHNlYC4KICAgICAgQnkgZGVmYXVsdCBhIHZhbGlkIFRMUyB7fSBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkLCB0aGlzIGNhbiBiZSBtYWRlCiAgICAgIG9wdGlvbmFsIGJ5IHNldHRpbmcgdGhlIGB0bHNPcHRpb25hbGAgcGFyYW1ldGVyIHRvIGB0cnVlYC4KCiAgICAgIGh0dHBzOi8va3ViZXJuZXRlcy5pby9kb2NzL2NvbmNlcHRzL3NlcnZpY2VzLW5ldHdvcmtpbmcvaW5ncmVzcy8jdGxzCnNwZWM6CiAgY3JkOgogICAgc3BlYzoKICAgICAgbmFtZXM6CiAgICAgICAga2luZDogSzhzSHR0cHNPbmx5CiAgICAgIHZhbGlkYXRpb246CiAgICAgICAgIyBTY2hlbWEgZm9yIHRoZSBgcGFyYW1ldGVyc2AgZmllbGQKICAgICAgICBvcGVuQVBJVjNTY2hlbWE6CiAgICAgICAgICB0eXBlOiBvYmplY3QKICAgICAgICAgIGRlc2NyaXB0aW9uOiA+LQogICAgICAgICAgICBSZXF1aXJlcyBJbmdyZXNzIHJlc291cmNlcyB0byBiZSBIVFRQUyBvbmx5LiAgSW5ncmVzcyByZXNvdXJjZXMgbXVzdAogICAgICAgICAgICBpbmNsdWRlIHRoZSBga3ViZXJuZXRlcy5pby9pbmdyZXNzLmFsbG93LWh0dHBgIGFubm90YXRpb24sIHNldCB0bwogICAgICAgICAgICBgZmFsc2VgLiBCeSBkZWZhdWx0IGEgdmFsaWQgVExTIHt9IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQsIHRoaXMKICAgICAgICAgICAgY2FuIGJlIG1hZGUgb3B0aW9uYWwgYnkgc2V0dGluZyB0aGUgYHRsc09wdGlvbmFsYCBwYXJhbWV0ZXIgdG8KICAgICAgICAgICAgYHRydWVgLgogICAgICAgICAgcHJvcGVydGllczoKICAgICAgICAgICAgdGxzT3B0aW9uYWw6CiAgICAgICAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiV2hlbiBzZXQgdG8gYHRydWVgIHRoZSBUTFMge30gaXMgb3B0aW9uYWwsIGRlZmF1bHRzCiAgICAgICAgICAgICAgdG8gZmFsc2UuIgogIHRhcmdldHM6CiAgICAtIHRhcmdldDogYWRtaXNzaW9uLms4cy5nYXRla2VlcGVyLnNoCiAgICAgIHJlZ286IHwKICAgICAgICBwYWNrYWdlIGs4c2h0dHBzb25seQoKICAgICAgICB2aW9sYXRpb25beyJtc2ciOiBtc2d9XSB7CiAgICAgICAgICBpbnB1dC5yZXZpZXcub2JqZWN0LmtpbmQgPT0gIkluZ3Jlc3MiCiAgICAgICAgICByZWdleC5tYXRjaCgiXihleHRlbnNpb25zfG5ldHdvcmtpbmcuazhzLmlvKS8iLCBpbnB1dC5yZXZpZXcub2JqZWN0LmFwaVZlcnNpb24pCiAgICAgICAgICBpbmdyZXNzIDo9IGlucHV0LnJldmlldy5vYmplY3QKICAgICAgICAgIG5vdCBodHRwc19jb21wbGV0ZShpbmdyZXNzKQogICAgICAgICAgbm90IHRsc19pc19vcHRpb25hbAogICAgICAgICAgbXNnIDo9IHNwcmludGYoIkluZ3Jlc3Mgc2hvdWxkIGJlIGh0dHBzLiB0bHMgY29uZmlndXJhdGlvbiBhbmQgYWxsb3ctaHR0cD1mYWxzZSBhbm5vdGF0aW9uIGFyZSByZXF1aXJlZCBmb3IgJXYiLCBbaW5ncmVzcy5tZXRhZGF0YS5uYW1lXSkKICAgICAgICB9CgogICAgICAgIHZpb2xhdGlvblt7Im1zZyI6IG1zZ31dIHsKICAgICAgICAgIGlucHV0LnJldmlldy5vYmplY3Qua2luZCA9PSAiSW5ncmVzcyIKICAgICAgICAgIHJlZ2V4Lm1hdGNoKCJeKGV4dGVuc2lvbnN8bmV0d29ya2luZy5rOHMuaW8pLyIsIGlucHV0LnJldmlldy5vYmplY3QuYXBpVmVyc2lvbikKICAgICAgICAgIGluZ3Jlc3MgOj0gaW5wdXQucmV2aWV3Lm9iamVjdAogICAgICAgICAgbm90IGFubm90YXRpb25fY29tcGxldGUoaW5ncmVzcykKICAgICAgICAgIHRsc19pc19vcHRpb25hbAogICAgICAgICAgbXNnIDo9IHNwcmludGYoIkluZ3Jlc3Mgc2hvdWxkIGJlIGh0dHBzLiBUaGUgYWxsb3ctaHR0cD1mYWxzZSBhbm5vdGF0aW9uIGlzIHJlcXVpcmVkIGZvciAldiIsIFtpbmdyZXNzLm1ldGFkYXRhLm5hbWVdKQogICAgICAgIH0KCiAgICAgICAgaHR0cHNfY29tcGxldGUoaW5ncmVzcykgPSB0cnVlIHsKICAgICAgICAgIGluZ3Jlc3Muc3BlY1sidGxzIl0KICAgICAgICAgIGNvdW50KGluZ3Jlc3Muc3BlYy50bHMpID4gMAogICAgICAgICAgaW5ncmVzcy5tZXRhZGF0YS5hbm5vdGF0aW9uc1sia3ViZXJuZXRlcy5pby9pbmdyZXNzLmFsbG93LWh0dHAiXSA9PSAiZmFsc2UiCiAgICAgICAgfQoKICAgICAgICBhbm5vdGF0aW9uX2NvbXBsZXRlKGluZ3Jlc3MpID0gdHJ1ZSB7CiAgICAgICAgICBpbmdyZXNzLm1ldGFkYXRhLmFubm90YXRpb25zWyJrdWJlcm5ldGVzLmlvL2luZ3Jlc3MuYWxsb3ctaHR0cCJdID09ICJmYWxzZSIKICAgICAgICB9CgogICAgICAgIHRsc19pc19vcHRpb25hbCB7CiAgICAgICAgICBwYXJhbWV0ZXJzIDo9IG9iamVjdC5nZXQoaW5wdXQsICJwYXJhbWV0ZXJzIiwge30pCiAgICAgICAgICBvYmplY3QuZ2V0KHBhcmFtZXRlcnMsICJ0bHNPcHRpb25hbCIsIGZhbHNlKSA9PSB0cnVlCiAgICAgICAgfQ=="</span>
</span><span id="__span-7-20"><a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-21"><a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">        </span><span class="nt">"apiGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-22"><a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">            </span><span class="s2">"/* EDIT HERE */"</span>
</span><span id="__span-7-23"><a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-7-24"><a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">        </span><span class="nt">"kinds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-25"><a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">            </span><span class="s2">"/* EDIT HERE */"</span>
</span><span id="__span-7-26"><a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-7-27"><a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">        </span><span class="nt">"namespaces"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('namespaces')]"</span><span class="p">,</span>
</span><span id="__span-7-28"><a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="nt">"excludedNamespaces"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('excludedNamespaces')]"</span><span class="p">,</span>
</span><span id="__span-7-29"><a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">        </span><span class="nt">"labelSelector"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('labelSelector')]"</span><span class="p">,</span>
</span><span id="__span-7-30"><a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">        </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-31"><a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">            </span><span class="nt">"tlsOptional"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('tlsOptional')]"</span>
</span><span id="__span-7-32"><a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-33"><a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-34"><a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-35"><a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-36"><a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">    </span><span class="nt">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-37"><a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">    </span><span class="nt">"effect"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-38"><a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"String"</span><span class="p">,</span>
</span><span id="__span-7-39"><a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-40"><a href="#__codelineno-7-40" id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">        </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Effect"</span><span class="p">,</span>
</span><span id="__span-7-41"><a href="#__codelineno-7-41" id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"'audit' allows a non-compliant resource to be created or updated, but flags it as non-compliant. 'deny' blocks the non-compliant resource creation or update. 'disabled' turns off the policy."</span>
</span><span id="__span-7-42"><a href="#__codelineno-7-42" id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-43"><a href="#__codelineno-7-43" id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">        </span><span class="nt">"allowedValues"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-44"><a href="#__codelineno-7-44" id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="w">        </span><span class="s2">"audit"</span><span class="p">,</span>
</span><span id="__span-7-45"><a href="#__codelineno-7-45" id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">        </span><span class="s2">"deny"</span><span class="p">,</span>
</span><span id="__span-7-46"><a href="#__codelineno-7-46" id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">        </span><span class="s2">"disabled"</span>
</span><span id="__span-7-47"><a href="#__codelineno-7-47" id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-7-48"><a href="#__codelineno-7-48" id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="w">        </span><span class="nt">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"audit"</span>
</span><span id="__span-7-49"><a href="#__codelineno-7-49" id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-50"><a href="#__codelineno-7-50" id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">    </span><span class="nt">"excludedNamespaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-51"><a href="#__codelineno-7-51" id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Array"</span><span class="p">,</span>
</span><span id="__span-7-52"><a href="#__codelineno-7-52" id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="w">        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-53"><a href="#__codelineno-7-53" id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="w">        </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Namespace exclusions"</span><span class="p">,</span>
</span><span id="__span-7-54"><a href="#__codelineno-7-54" id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Kubernetes namespaces to exclude from policy evaluation."</span>
</span><span id="__span-7-55"><a href="#__codelineno-7-55" id="__codelineno-7-55" name="__codelineno-7-55"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-56"><a href="#__codelineno-7-56" id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="w">        </span><span class="nt">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-57"><a href="#__codelineno-7-57" id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="w">        </span><span class="s2">"kube-system"</span><span class="p">,</span>
</span><span id="__span-7-58"><a href="#__codelineno-7-58" id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">        </span><span class="s2">"gatekeeper-system"</span><span class="p">,</span>
</span><span id="__span-7-59"><a href="#__codelineno-7-59" id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">        </span><span class="s2">"azure-arc"</span>
</span><span id="__span-7-60"><a href="#__codelineno-7-60" id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-7-61"><a href="#__codelineno-7-61" id="__codelineno-7-61" name="__codelineno-7-61"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-62"><a href="#__codelineno-7-62" id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="w">    </span><span class="nt">"namespaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-63"><a href="#__codelineno-7-63" id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Array"</span><span class="p">,</span>
</span><span id="__span-7-64"><a href="#__codelineno-7-64" id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-65"><a href="#__codelineno-7-65" id="__codelineno-7-65" name="__codelineno-7-65"></a><span class="w">        </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Namespace inclusions"</span><span class="p">,</span>
</span><span id="__span-7-66"><a href="#__codelineno-7-66" id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Kubernetes namespaces to only include in policy evaluation. An empty list means the policy is applied to all resources in all namespaces."</span>
</span><span id="__span-7-67"><a href="#__codelineno-7-67" id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-68"><a href="#__codelineno-7-68" id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">        </span><span class="nt">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-7-69"><a href="#__codelineno-7-69" id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-70"><a href="#__codelineno-7-70" id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="w">    </span><span class="nt">"labelSelector"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-71"><a href="#__codelineno-7-71" id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Object"</span><span class="p">,</span>
</span><span id="__span-7-72"><a href="#__codelineno-7-72" id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-73"><a href="#__codelineno-7-73" id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="w">        </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kubernetes label selector"</span><span class="p">,</span>
</span><span id="__span-7-74"><a href="#__codelineno-7-74" id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Label query to select Kubernetes resources for policy evaluation. An empty label selector matches all Kubernetes resources."</span>
</span><span id="__span-7-75"><a href="#__codelineno-7-75" id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-76"><a href="#__codelineno-7-76" id="__codelineno-7-76" name="__codelineno-7-76"></a><span class="w">        </span><span class="nt">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-7-77"><a href="#__codelineno-7-77" id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="w">        </span><span class="nt">"schema"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-78"><a href="#__codelineno-7-78" id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A label selector is a label query over a set of resources. The result of matchLabels and matchExpressions are ANDed. An empty label selector matches all resources."</span><span class="p">,</span>
</span><span id="__span-7-79"><a href="#__codelineno-7-79" id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-7-80"><a href="#__codelineno-7-80" id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="w">        </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-81"><a href="#__codelineno-7-81" id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="w">            </span><span class="nt">"matchLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-82"><a href="#__codelineno-7-82" id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="w">            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"matchLabels is a map of {key,value} pairs."</span><span class="p">,</span>
</span><span id="__span-7-83"><a href="#__codelineno-7-83" id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-7-84"><a href="#__codelineno-7-84" id="__codelineno-7-84" name="__codelineno-7-84"></a><span class="w">            </span><span class="nt">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-85"><a href="#__codelineno-7-85" id="__codelineno-7-85" name="__codelineno-7-85"></a><span class="w">                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
</span><span id="__span-7-86"><a href="#__codelineno-7-86" id="__codelineno-7-86" name="__codelineno-7-86"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-7-87"><a href="#__codelineno-7-87" id="__codelineno-7-87" name="__codelineno-7-87"></a><span class="w">            </span><span class="nt">"minProperties"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-7-88"><a href="#__codelineno-7-88" id="__codelineno-7-88" name="__codelineno-7-88"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-7-89"><a href="#__codelineno-7-89" id="__codelineno-7-89" name="__codelineno-7-89"></a><span class="w">            </span><span class="nt">"matchExpressions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-90"><a href="#__codelineno-7-90" id="__codelineno-7-90" name="__codelineno-7-90"></a><span class="w">            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"matchExpressions is a list of values, a key, and an operator."</span><span class="p">,</span>
</span><span id="__span-7-91"><a href="#__codelineno-7-91" id="__codelineno-7-91" name="__codelineno-7-91"></a><span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span>
</span><span id="__span-7-92"><a href="#__codelineno-7-92" id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="w">            </span><span class="nt">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-93"><a href="#__codelineno-7-93" id="__codelineno-7-93" name="__codelineno-7-93"></a><span class="w">                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-7-94"><a href="#__codelineno-7-94" id="__codelineno-7-94" name="__codelineno-7-94"></a><span class="w">                </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-95"><a href="#__codelineno-7-95" id="__codelineno-7-95" name="__codelineno-7-95"></a><span class="w">                </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-96"><a href="#__codelineno-7-96" id="__codelineno-7-96" name="__codelineno-7-96"></a><span class="w">                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key is the label key that the selector applies to."</span><span class="p">,</span>
</span><span id="__span-7-97"><a href="#__codelineno-7-97" id="__codelineno-7-97" name="__codelineno-7-97"></a><span class="w">                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
</span><span id="__span-7-98"><a href="#__codelineno-7-98" id="__codelineno-7-98" name="__codelineno-7-98"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-7-99"><a href="#__codelineno-7-99" id="__codelineno-7-99" name="__codelineno-7-99"></a><span class="w">                </span><span class="nt">"operator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-100"><a href="#__codelineno-7-100" id="__codelineno-7-100" name="__codelineno-7-100"></a><span class="w">                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"operator represents a key's relationship to a set of values."</span><span class="p">,</span>
</span><span id="__span-7-101"><a href="#__codelineno-7-101" id="__codelineno-7-101" name="__codelineno-7-101"></a><span class="w">                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-7-102"><a href="#__codelineno-7-102" id="__codelineno-7-102" name="__codelineno-7-102"></a><span class="w">                    </span><span class="nt">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-103"><a href="#__codelineno-7-103" id="__codelineno-7-103" name="__codelineno-7-103"></a><span class="w">                    </span><span class="s2">"In"</span><span class="p">,</span>
</span><span id="__span-7-104"><a href="#__codelineno-7-104" id="__codelineno-7-104" name="__codelineno-7-104"></a><span class="w">                    </span><span class="s2">"NotIn"</span><span class="p">,</span>
</span><span id="__span-7-105"><a href="#__codelineno-7-105" id="__codelineno-7-105" name="__codelineno-7-105"></a><span class="w">                    </span><span class="s2">"Exists"</span><span class="p">,</span>
</span><span id="__span-7-106"><a href="#__codelineno-7-106" id="__codelineno-7-106" name="__codelineno-7-106"></a><span class="w">                    </span><span class="s2">"DoesNotExist"</span>
</span><span id="__span-7-107"><a href="#__codelineno-7-107" id="__codelineno-7-107" name="__codelineno-7-107"></a><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-7-108"><a href="#__codelineno-7-108" id="__codelineno-7-108" name="__codelineno-7-108"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-7-109"><a href="#__codelineno-7-109" id="__codelineno-7-109" name="__codelineno-7-109"></a><span class="w">                </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-110"><a href="#__codelineno-7-110" id="__codelineno-7-110" name="__codelineno-7-110"></a><span class="w">                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty."</span><span class="p">,</span>
</span><span id="__span-7-111"><a href="#__codelineno-7-111" id="__codelineno-7-111" name="__codelineno-7-111"></a><span class="w">                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span>
</span><span id="__span-7-112"><a href="#__codelineno-7-112" id="__codelineno-7-112" name="__codelineno-7-112"></a><span class="w">                    </span><span class="nt">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-113"><a href="#__codelineno-7-113" id="__codelineno-7-113" name="__codelineno-7-113"></a><span class="w">                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
</span><span id="__span-7-114"><a href="#__codelineno-7-114" id="__codelineno-7-114" name="__codelineno-7-114"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-7-115"><a href="#__codelineno-7-115" id="__codelineno-7-115" name="__codelineno-7-115"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-7-116"><a href="#__codelineno-7-116" id="__codelineno-7-116" name="__codelineno-7-116"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-7-117"><a href="#__codelineno-7-117" id="__codelineno-7-117" name="__codelineno-7-117"></a><span class="w">                </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-118"><a href="#__codelineno-7-118" id="__codelineno-7-118" name="__codelineno-7-118"></a><span class="w">                </span><span class="s2">"key"</span><span class="p">,</span>
</span><span id="__span-7-119"><a href="#__codelineno-7-119" id="__codelineno-7-119" name="__codelineno-7-119"></a><span class="w">                </span><span class="s2">"operator"</span>
</span><span id="__span-7-120"><a href="#__codelineno-7-120" id="__codelineno-7-120" name="__codelineno-7-120"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-7-121"><a href="#__codelineno-7-121" id="__codelineno-7-121" name="__codelineno-7-121"></a><span class="w">                </span><span class="nt">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-7-122"><a href="#__codelineno-7-122" id="__codelineno-7-122" name="__codelineno-7-122"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-7-123"><a href="#__codelineno-7-123" id="__codelineno-7-123" name="__codelineno-7-123"></a><span class="w">            </span><span class="nt">"minItems"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-7-124"><a href="#__codelineno-7-124" id="__codelineno-7-124" name="__codelineno-7-124"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-125"><a href="#__codelineno-7-125" id="__codelineno-7-125" name="__codelineno-7-125"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-126"><a href="#__codelineno-7-126" id="__codelineno-7-126" name="__codelineno-7-126"></a><span class="w">        </span><span class="nt">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-7-127"><a href="#__codelineno-7-127" id="__codelineno-7-127" name="__codelineno-7-127"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-128"><a href="#__codelineno-7-128" id="__codelineno-7-128" name="__codelineno-7-128"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-129"><a href="#__codelineno-7-129" id="__codelineno-7-129" name="__codelineno-7-129"></a><span class="w">    </span><span class="nt">"tlsOptional"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-130"><a href="#__codelineno-7-130" id="__codelineno-7-130" name="__codelineno-7-130"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Boolean"</span><span class="p">,</span>
</span><span id="__span-7-131"><a href="#__codelineno-7-131" id="__codelineno-7-131" name="__codelineno-7-131"></a><span class="w">        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-132"><a href="#__codelineno-7-132" id="__codelineno-7-132" name="__codelineno-7-132"></a><span class="w">        </span><span class="nt">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/* EDIT HERE */"</span><span class="p">,</span>
</span><span id="__span-7-133"><a href="#__codelineno-7-133" id="__codelineno-7-133" name="__codelineno-7-133"></a><span class="w">        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/* EDIT HERE */"</span>
</span><span id="__span-7-134"><a href="#__codelineno-7-134" id="__codelineno-7-134" name="__codelineno-7-134"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-135"><a href="#__codelineno-7-135" id="__codelineno-7-135" name="__codelineno-7-135"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-136"><a href="#__codelineno-7-136" id="__codelineno-7-136" name="__codelineno-7-136"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-137"><a href="#__codelineno-7-137" id="__codelineno-7-137" name="__codelineno-7-137"></a><span class="p">}</span>
</span><span id="__span-7-138"><a href="#__codelineno-7-138" id="__codelineno-7-138" name="__codelineno-7-138"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Fill the fields with "/<em> EDIT HERE </em>/" in the policy definition JSON file with the appropriate values, such as the display name, description, API groups, and kinds. For example, in this case you must configure apiGroups:
 ["extensions", "networking.k8s.io"] and kinds: ["Ingress"]</li>
<li>Save the policy definition JSON file.</li>
</ol>
</li>
</ol>
<p>This is the complete policy:</p>
<p><code>json title="https-only.json"
    {
    "properties": {
        "policyType": "Custom",
        "mode": "Microsoft.Kubernetes.Data",
        "displayName": "Require HTTPS for Ingress resources",
        "description": "This policy requires Ingress resources to be HTTPS only. Ingress resources must include the `kubernetes.io/ingress.allow-http` annotation, set to `false`. By default a valid TLS configuration is required, this can be made optional by setting the `tlsOptional` parameter to `true`.",
        "policyRule": {
        "if": {
            "field": "type",
            "in": [
            "Microsoft.ContainerService/managedClusters"
            ]
        },
        "then": {
            "effect": "[parameters('effect')]",
            "details": {
            "templateInfo": {
                "sourceType": "Base64Encoded",
                "content": "YXBpVmVyc2lvbjogdGVtcGxhdGVzLmdhdGVrZWVwZXIuc2gvdjEKa2luZDogQ29uc3RyYWludFRlbXBsYXRlCm1ldGFkYXRhOgogIG5hbWU6IGs4c2h0dHBzb25seQogIGFubm90YXRpb25zOgogICAgbWV0YWRhdGEuZ2F0ZWtlZXBlci5zaC90aXRsZTogIkhUVFBTIE9ubHkiCiAgICBtZXRhZGF0YS5nYXRla2VlcGVyLnNoL3ZlcnNpb246IDEuMC4yCiAgICBkZXNjcmlwdGlvbjogPi0KICAgICAgUmVxdWlyZXMgSW5ncmVzcyByZXNvdXJjZXMgdG8gYmUgSFRUUFMgb25seS4gIEluZ3Jlc3MgcmVzb3VyY2VzIG11c3QKICAgICAgaW5jbHVkZSB0aGUgYGt1YmVybmV0ZXMuaW8vaW5ncmVzcy5hbGxvdy1odHRwYCBhbm5vdGF0aW9uLCBzZXQgdG8gYGZhbHNlYC4KICAgICAgQnkgZGVmYXVsdCBhIHZhbGlkIFRMUyB7fSBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkLCB0aGlzIGNhbiBiZSBtYWRlCiAgICAgIG9wdGlvbmFsIGJ5IHNldHRpbmcgdGhlIGB0bHNPcHRpb25hbGAgcGFyYW1ldGVyIHRvIGB0cnVlYC4KCiAgICAgIGh0dHBzOi8va3ViZXJuZXRlcy5pby9kb2NzL2NvbmNlcHRzL3NlcnZpY2VzLW5ldHdvcmtpbmcvaW5ncmVzcy8jdGxzCnNwZWM6CiAgY3JkOgogICAgc3BlYzoKICAgICAgbmFtZXM6CiAgICAgICAga2luZDogSzhzSHR0cHNPbmx5CiAgICAgIHZhbGlkYXRpb246CiAgICAgICAgIyBTY2hlbWEgZm9yIHRoZSBgcGFyYW1ldGVyc2AgZmllbGQKICAgICAgICBvcGVuQVBJVjNTY2hlbWE6CiAgICAgICAgICB0eXBlOiBvYmplY3QKICAgICAgICAgIGRlc2NyaXB0aW9uOiA+LQogICAgICAgICAgICBSZXF1aXJlcyBJbmdyZXNzIHJlc291cmNlcyB0byBiZSBIVFRQUyBvbmx5LiAgSW5ncmVzcyByZXNvdXJjZXMgbXVzdAogICAgICAgICAgICBpbmNsdWRlIHRoZSBga3ViZXJuZXRlcy5pby9pbmdyZXNzLmFsbG93LWh0dHBgIGFubm90YXRpb24sIHNldCB0bwogICAgICAgICAgICBgZmFsc2VgLiBCeSBkZWZhdWx0IGEgdmFsaWQgVExTIHt9IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQsIHRoaXMKICAgICAgICAgICAgY2FuIGJlIG1hZGUgb3B0aW9uYWwgYnkgc2V0dGluZyB0aGUgYHRsc09wdGlvbmFsYCBwYXJhbWV0ZXIgdG8KICAgICAgICAgICAgYHRydWVgLgogICAgICAgICAgcHJvcGVydGllczoKICAgICAgICAgICAgdGxzT3B0aW9uYWw6CiAgICAgICAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiV2hlbiBzZXQgdG8gYHRydWVgIHRoZSBUTFMge30gaXMgb3B0aW9uYWwsIGRlZmF1bHRzCiAgICAgICAgICAgICAgdG8gZmFsc2UuIgogIHRhcmdldHM6CiAgICAtIHRhcmdldDogYWRtaXNzaW9uLms4cy5nYXRla2VlcGVyLnNoCiAgICAgIHJlZ286IHwKICAgICAgICBwYWNrYWdlIGs4c2h0dHBzb25seQoKICAgICAgICB2aW9sYXRpb25beyJtc2ciOiBtc2d9XSB7CiAgICAgICAgICBpbnB1dC5yZXZpZXcub2JqZWN0LmtpbmQgPT0gIkluZ3Jlc3MiCiAgICAgICAgICByZWdleC5tYXRjaCgiXihleHRlbnNpb25zfG5ldHdvcmtpbmcuazhzLmlvKS8iLCBpbnB1dC5yZXZpZXcub2JqZWN0LmFwaVZlcnNpb24pCiAgICAgICAgICBpbmdyZXNzIDo9IGlucHV0LnJldmlldy5vYmplY3QKICAgICAgICAgIG5vdCBodHRwc19jb21wbGV0ZShpbmdyZXNzKQogICAgICAgICAgbm90IHRsc19pc19vcHRpb25hbAogICAgICAgICAgbXNnIDo9IHNwcmludGYoIkluZ3Jlc3Mgc2hvdWxkIGJlIGh0dHBzLiB0bHMgY29uZmlndXJhdGlvbiBhbmQgYWxsb3ctaHR0cD1mYWxzZSBhbm5vdGF0aW9uIGFyZSByZXF1aXJlZCBmb3IgJXYiLCBbaW5ncmVzcy5tZXRhZGF0YS5uYW1lXSkKICAgICAgICB9CgogICAgICAgIHZpb2xhdGlvblt7Im1zZyI6IG1zZ31dIHsKICAgICAgICAgIGlucHV0LnJldmlldy5vYmplY3Qua2luZCA9PSAiSW5ncmVzcyIKICAgICAgICAgIHJlZ2V4Lm1hdGNoKCJeKGV4dGVuc2lvbnN8bmV0d29ya2luZy5rOHMuaW8pLyIsIGlucHV0LnJldmlldy5vYmplY3QuYXBpVmVyc2lvbikKICAgICAgICAgIGluZ3Jlc3MgOj0gaW5wdXQucmV2aWV3Lm9iamVjdAogICAgICAgICAgbm90IGFubm90YXRpb25fY29tcGxldGUoaW5ncmVzcykKICAgICAgICAgIHRsc19pc19vcHRpb25hbAogICAgICAgICAgbXNnIDo9IHNwcmludGYoIkluZ3Jlc3Mgc2hvdWxkIGJlIGh0dHBzLiBUaGUgYWxsb3ctaHR0cD1mYWxzZSBhbm5vdGF0aW9uIGlzIHJlcXVpcmVkIGZvciAldiIsIFtpbmdyZXNzLm1ldGFkYXRhLm5hbWVdKQogICAgICAgIH0KCiAgICAgICAgaHR0cHNfY29tcGxldGUoaW5ncmVzcykgPSB0cnVlIHsKICAgICAgICAgIGluZ3Jlc3Muc3BlY1sidGxzIl0KICAgICAgICAgIGNvdW50KGluZ3Jlc3Muc3BlYy50bHMpID4gMAogICAgICAgICAgaW5ncmVzcy5tZXRhZGF0YS5hbm5vdGF0aW9uc1sia3ViZXJuZXRlcy5pby9pbmdyZXNzLmFsbG93LWh0dHAiXSA9PSAiZmFsc2UiCiAgICAgICAgfQoKICAgICAgICBhbm5vdGF0aW9uX2NvbXBsZXRlKGluZ3Jlc3MpID0gdHJ1ZSB7CiAgICAgICAgICBpbmdyZXNzLm1ldGFkYXRhLmFubm90YXRpb25zWyJrdWJlcm5ldGVzLmlvL2luZ3Jlc3MuYWxsb3ctaHR0cCJdID09ICJmYWxzZSIKICAgICAgICB9CgogICAgICAgIHRsc19pc19vcHRpb25hbCB7CiAgICAgICAgICBwYXJhbWV0ZXJzIDo9IG9iamVjdC5nZXQoaW5wdXQsICJwYXJhbWV0ZXJzIiwge30pCiAgICAgICAgICBvYmplY3QuZ2V0KHBhcmFtZXRlcnMsICJ0bHNPcHRpb25hbCIsIGZhbHNlKSA9PSB0cnVlCiAgICAgICAgfQ=="
            },
            "apiGroups": [
                "extensions",
                "networking.k8s.io"
            ],
            "kinds": [
                "Ingress"
            ],
            "namespaces": "[parameters('namespaces')]",
            "excludedNamespaces": "[parameters('excludedNamespaces')]",
            "labelSelector": "[parameters('labelSelector')]",
            "values": {
                "tlsOptional": "[parameters('tlsOptional')]"
            }
            }
        }
        },
        "parameters": {
        "effect": {
            "type": "String",
            "metadata": {
            "displayName": "Effect",
            "description": "'audit' allows a non-compliant resource to be created or updated, but flags it as non-compliant. 'deny' blocks the non-compliant resource creation or update. 'disabled' turns off the policy."
            },
            "allowedValues": [
            "audit",
            "deny",
            "disabled"
            ],
            "defaultValue": "audit"
        },
        "excludedNamespaces": {
            "type": "Array",
            "metadata": {
            "displayName": "Namespace exclusions",
            "description": "List of Kubernetes namespaces to exclude from policy evaluation."
            },
            "defaultValue": [
            "kube-system",
            "gatekeeper-system",
            "azure-arc"
            ]
        },
        "namespaces": {
            "type": "Array",
            "metadata": {
            "displayName": "Namespace inclusions",
            "description": "List of Kubernetes namespaces to only include in policy evaluation. An empty list means the policy is applied to all resources in all namespaces."
            },
            "defaultValue": []
        },
        "labelSelector": {
            "type": "Object",
            "metadata": {
            "displayName": "Kubernetes label selector",
            "description": "Label query to select Kubernetes resources for policy evaluation. An empty label selector matches all Kubernetes resources."
            },
            "defaultValue": {},
            "schema": {
            "description": "A label selector is a label query over a set of resources. The result of matchLabels and matchExpressions are ANDed. An empty label selector matches all resources.",
            "type": "object",
            "properties": {
                "matchLabels": {
                "description": "matchLabels is a map of {key,value} pairs.",
                "type": "object",
                "additionalProperties": {
                    "type": "string"
                },
                "minProperties": 1
                },
                "matchExpressions": {
                "description": "matchExpressions is a list of values, a key, and an operator.",
                "type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                    "key": {
                        "description": "key is the label key that the selector applies to.",
                        "type": "string"
                    },
                    "operator": {
                        "description": "operator represents a key's relationship to a set of values.",
                        "type": "string",
                        "enum": [
                        "In",
                        "NotIn",
                        "Exists",
                        "DoesNotExist"
                        ]
                    },
                    "values": {
                        "description": "values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty.",
                        "type": "array",
                        "items": {
                        "type": "string"
                        }
                    }
                    },
                    "required": [
                    "key",
                    "operator"
                    ],
                    "additionalProperties": false
                },
                "minItems": 1
                }
            },
            "additionalProperties": false
            }
        },
        "tlsOptional": {
            "type": "Boolean",
            "metadata": {
            "displayName": "TLS Optional",
            "description": "Set to true to make TLS optional"
            }
        }
        }
    }
    }</code></p>
<p>Now you have created a custom Azure Policy for Kubernetes that enforces the HTTPS only constraint on your Kubernetes cluster. You can apply this policy to your cluster to ensure that all Ingress resources are HTTPS only creating a policy definition and assigning it to the management group, subscription or resource group where the AKS cluster is located.</p>
<h3 id="conclusion"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/#conclusion">Conclusion</a></h3>
<p>In this article, we discussed how to create a custom Azure Policy for Kubernetes. We showed you how to define a policy in the Open Policy Agent (OPA) policy language and apply it to your Kubernetes cluster. We also showed you how to create a constraint template for the policy and create an Azure Policy for the constraint template. By following these steps, you can create custom policies that enforce specific rules and effects on your Kubernetes resources.</p>
<h3 id="references"><a class="toclink" href="2024/11/05/custom-azure-policy-for-kubernetes/#references">References</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes#install-azure-policy-add-on-for-aks">Understand Azure Policy for kubernetes clusters</a></li>
<li><a href="https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/httpsonly">Gatekeeper Library</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/governance/policy/how-to/extension-for-vscode">Azure Policy extension for Visual Studio Code</a></li>
<li><a href="https://open-policy-agent.github.io/gatekeeper/website/docs/howto/">How to use Gatekeeper</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-10-16 00:00:00">October 16, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-check-if-a-private-endpoint-is-connected-to-a-external-private-link-service-in-azure"><a class="toclink" href="2024/10/16/how-to-check-if-a-private-endpoint-is-connected-to-a-external-private-link-service-in-azure/">How to check if a private endpoint is connected to a external private link service in Azure</a></h2>
<p>Do you need to check if a private endpoint is connected to an external private link service in Azure or just don't know how to do it?</p>
<p>Check this blog post to learn how to do it: <a href="https://www.jannemattila.com/azure/2024/06/17/private-endpoint-connections.html">Find cross-tenant private endpoint connections in Azure</a></p>
<p>This is a copy of the script used in the blog post in case it disappears: </p>
<div class="language-powershell highlight"><span class="filename">scan-private-endpoints-with-manual-connections.ps1</span><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nv">$ErrorActionPreference</span> <span class="p">=</span> <span class="s2">"Stop"</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">class</span> <span class="n">SubscriptionInformation</span> <span class="p">{</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="no">[string]</span> <span class="nv">$SubscriptionID</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="no">[string]</span> <span class="nv">$Name</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="no">[string]</span> <span class="nv">$TenantID</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">}</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="n">class</span> <span class="n">TenantInformation</span> <span class="p">{</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="no">[string]</span> <span class="nv">$TenantID</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="no">[string]</span> <span class="nv">$DisplayName</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="no">[string]</span> <span class="nv">$DomainName</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="p">}</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="n">class</span> <span class="n">PrivateEndpointData</span> <span class="p">{</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="no">[string]</span> <span class="nv">$ID</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="no">[string]</span> <span class="nv">$Name</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="no">[string]</span> <span class="nv">$Type</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="no">[string]</span> <span class="nv">$Location</span>
</span><span id="__span-0-20"><a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="no">[string]</span> <span class="nv">$ResourceGroup</span>
</span><span id="__span-0-21"><a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="no">[string]</span> <span class="nv">$SubscriptionName</span>
</span><span id="__span-0-22"><a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="no">[string]</span> <span class="nv">$SubscriptionID</span>
</span><span id="__span-0-23"><a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="no">[string]</span> <span class="nv">$TenantID</span>
</span><span id="__span-0-24"><a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="no">[string]</span> <span class="nv">$TenantDisplayName</span>
</span><span id="__span-0-25"><a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="no">[string]</span> <span class="nv">$TenantDomainName</span>
</span><span id="__span-0-26"><a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="no">[string]</span> <span class="nv">$TargetResourceId</span>
</span><span id="__span-0-27"><a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="no">[string]</span> <span class="nv">$TargetSubscriptionName</span>
</span><span id="__span-0-28"><a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="no">[string]</span> <span class="nv">$TargetSubscriptionID</span>
</span><span id="__span-0-29"><a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="no">[string]</span> <span class="nv">$TargetTenantID</span>
</span><span id="__span-0-30"><a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="no">[string]</span> <span class="nv">$TargetTenantDisplayName</span>
</span><span id="__span-0-31"><a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="no">[string]</span> <span class="nv">$TargetTenantDomainName</span>
</span><span id="__span-0-32"><a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="no">[string]</span> <span class="nv">$Description</span>
</span><span id="__span-0-33"><a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="no">[string]</span> <span class="nv">$Status</span>
</span><span id="__span-0-34"><a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="no">[string]</span> <span class="nv">$External</span>
</span><span id="__span-0-35"><a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="p">}</span>
</span><span id="__span-0-36"><a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="nv">$installedModule</span> <span class="p">=</span> <span class="nb">Get-Module</span> <span class="n">-Name</span> <span class="s2">"Az.ResourceGraph"</span> <span class="n">-ListAvailable</span>
</span><span id="__span-0-38"><a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$null</span> <span class="o">-eq</span> <span class="nv">$installedModule</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-39"><a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="nb">Install-Module</span> <span class="s2">"Az.ResourceGraph"</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-0-40"><a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="p">}</span>
</span><span id="__span-0-41"><a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-42"><a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="nb">Import-Module</span> <span class="s2">"Az.ResourceGraph"</span>
</span><span id="__span-0-43"><a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="p">}</span>
</span><span id="__span-0-44"><a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="nv">$kqlQuery</span> <span class="p">=</span> <span class="sh">@"</span>
</span><span id="__span-0-46"><a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sh">resourcecontainers | where type == 'microsoft.resources/subscriptions'</span>
</span><span id="__span-0-47"><a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sh">| project  subscriptionId, name, tenantId</span>
</span><span id="__span-0-48"><a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sh">"@</span>
</span><span id="__span-0-49"><a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a>
</span><span id="__span-0-50"><a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="nv">$batchSize</span> <span class="p">=</span> <span class="n">1000</span>
</span><span id="__span-0-51"><a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="nv">$skipResult</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-0-52"><a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="nv">$subscriptions</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-0-54"><a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">while</span> <span class="p">(</span><span class="nv">$true</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-56"><a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$skipResult</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-58"><a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span> <span class="n">-SkipToken</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">SkipToken</span> <span class="n">-UseTenantScope</span>
</span><span id="__span-0-59"><a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="p">}</span>
</span><span id="__span-0-60"><a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-61"><a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span> <span class="n">-UseTenantScope</span>
</span><span id="__span-0-62"><a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="p">}</span>
</span><span id="__span-0-63"><a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a>
</span><span id="__span-0-64"><a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">in</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-65"><a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="nv">$s</span> <span class="p">=</span> <span class="no">[SubscriptionInformation]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-66"><a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="nv">$s</span><span class="p">.</span><span class="n">SubscriptionID</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">subscriptionId</span>
</span><span id="__span-0-67"><a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="nv">$s</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">name</span>
</span><span id="__span-0-68"><a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="nv">$s</span><span class="p">.</span><span class="n">TenantID</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">tenantId</span>
</span><span id="__span-0-69"><a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="nv">$subscriptions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$s</span><span class="p">.</span><span class="n">SubscriptionID</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-0-71"><a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="p">}</span>
</span><span id="__span-0-72"><a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Count</span> <span class="o">-lt</span> <span class="nv">$batchSize</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-74"><a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">break</span><span class="p">;</span>
</span><span id="__span-0-75"><a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="p">}</span>
</span><span id="__span-0-76"><a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="nv">$skipResult</span> <span class="p">+=</span> <span class="nv">$skipResult</span> <span class="p">+</span> <span class="nv">$batchSize</span>
</span><span id="__span-0-77"><a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="p">}</span>
</span><span id="__span-0-78"><a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="s2">"Found </span><span class="p">$(</span><span class="nv">$subscriptions</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> subscriptions"</span>
</span><span id="__span-0-80"><a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="k">function</span> <span class="nb">Get-SubscriptionInformation</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-82"><a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$subscriptions</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-83"><a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="k">return</span> <span class="nv">$subscriptions</span><span class="p">[</span><span class="nv">$SubscriptionID</span><span class="p">]</span>
</span><span id="__span-0-84"><a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="p">}</span> 
</span><span id="__span-0-85"><a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a href="#__codelineno-0-86" id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="nb">Write-Warning</span> <span class="s2">"Using fallback subscription information for '$SubscriptionID'"</span>
</span><span id="__span-0-87"><a href="#__codelineno-0-87" id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="nv">$s</span> <span class="p">=</span> <span class="no">[SubscriptionInformation]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-88"><a href="#__codelineno-0-88" id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="nv">$s</span><span class="p">.</span><span class="n">SubscriptionID</span> <span class="p">=</span> <span class="nv">$SubscriptionID</span>
</span><span id="__span-0-89"><a href="#__codelineno-0-89" id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="nv">$s</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">"&lt;unknown&gt;"</span>
</span><span id="__span-0-90"><a href="#__codelineno-0-90" id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="nv">$s</span><span class="p">.</span><span class="n">TenantID</span> <span class="p">=</span> <span class="no">[Guid]</span><span class="p">::</span><span class="n">Empty</span><span class="p">.</span><span class="n">Guid</span>
</span><span id="__span-0-91"><a href="#__codelineno-0-91" id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">return</span> <span class="nv">$s</span>
</span><span id="__span-0-92"><a href="#__codelineno-0-92" id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="p">}</span>
</span><span id="__span-0-93"><a href="#__codelineno-0-93" id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a href="#__codelineno-0-94" id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="nv">$tenantCache</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-0-95"><a href="#__codelineno-0-95" id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="nv">$subscriptionToTenantCache</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-0-96"><a href="#__codelineno-0-96" id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a href="#__codelineno-0-97" id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">function</span> <span class="nb">Get-TenantInformation</span><span class="p">(</span><span class="nv">$TenantID</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-98"><a href="#__codelineno-0-98" id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="nv">$domain</span> <span class="p">=</span> <span class="nv">$null</span>
</span><span id="__span-0-99"><a href="#__codelineno-0-99" id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$tenantCache</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$TenantID</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-100"><a href="#__codelineno-0-100" id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="nv">$domain</span> <span class="p">=</span> <span class="nv">$tenantCache</span><span class="p">[</span><span class="nv">$TenantID</span><span class="p">]</span>
</span><span id="__span-0-101"><a href="#__codelineno-0-101" id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">}</span> 
</span><span id="__span-0-102"><a href="#__codelineno-0-102" id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-103"><a href="#__codelineno-0-103" id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-0-104"><a href="#__codelineno-0-104" id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="nv">$tenantResponse</span> <span class="p">=</span> <span class="nb">Invoke-AzRestMethod</span> <span class="n">-Uri</span> <span class="s2">"https://graph.microsoft.com/v1.0/tenantRelationships/findTenantInformationByTenantId(tenantId='$TenantID')"</span>
</span><span id="__span-0-105"><a href="#__codelineno-0-105" id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="nv">$tenantInformation</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$tenantResponse</span><span class="p">.</span><span class="n">Content</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span><span class="p">)</span>
</span><span id="__span-0-106"><a href="#__codelineno-0-106" id="__codelineno-0-106" name="__codelineno-0-106"></a>
</span><span id="__span-0-107"><a href="#__codelineno-0-107" id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="nv">$ti</span> <span class="p">=</span> <span class="no">[TenantInformation]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-108"><a href="#__codelineno-0-108" id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">TenantID</span> <span class="p">=</span> <span class="nv">$TenantID</span>
</span><span id="__span-0-109"><a href="#__codelineno-0-109" id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">DisplayName</span> <span class="p">=</span> <span class="nv">$tenantInformation</span><span class="p">.</span><span class="n">displayName</span>
</span><span id="__span-0-110"><a href="#__codelineno-0-110" id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">DomainName</span> <span class="p">=</span> <span class="nv">$tenantInformation</span><span class="p">.</span><span class="n">defaultDomainName</span>
</span><span id="__span-0-111"><a href="#__codelineno-0-111" id="__codelineno-0-111" name="__codelineno-0-111"></a>
</span><span id="__span-0-112"><a href="#__codelineno-0-112" id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="nv">$domain</span> <span class="p">=</span> <span class="nv">$ti</span>
</span><span id="__span-0-113"><a href="#__codelineno-0-113" id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="p">}</span>
</span><span id="__span-0-114"><a href="#__codelineno-0-114" id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-0-115"><a href="#__codelineno-0-115" id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="nb">Write-Warning</span> <span class="s2">"Failed to get domain information for '$TenantID'"</span>
</span><span id="__span-0-116"><a href="#__codelineno-0-116" id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="p">}</span>
</span><span id="__span-0-117"><a href="#__codelineno-0-117" id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a href="#__codelineno-0-118" id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">if</span> <span class="p">(</span><span class="no">[string]</span><span class="p">::</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="nv">$domain</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-119"><a href="#__codelineno-0-119" id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="nb">Write-Warning</span> <span class="s2">"Using fallback domain information for '$TenantID'"</span>
</span><span id="__span-0-120"><a href="#__codelineno-0-120" id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="nv">$ti</span> <span class="p">=</span> <span class="no">[TenantInformation]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-121"><a href="#__codelineno-0-121" id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">TenantID</span> <span class="p">=</span> <span class="nv">$TenantID</span>
</span><span id="__span-0-122"><a href="#__codelineno-0-122" id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">DisplayName</span> <span class="p">=</span> <span class="s2">"&lt;unknown&gt;"</span>
</span><span id="__span-0-123"><a href="#__codelineno-0-123" id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="nv">$ti</span><span class="p">.</span><span class="n">DomainName</span> <span class="p">=</span> <span class="s2">"&lt;unknown&gt;"</span>
</span><span id="__span-0-124"><a href="#__codelineno-0-124" id="__codelineno-0-124" name="__codelineno-0-124"></a>
</span><span id="__span-0-125"><a href="#__codelineno-0-125" id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="nv">$domain</span> <span class="p">=</span> <span class="nv">$ti</span>
</span><span id="__span-0-126"><a href="#__codelineno-0-126" id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">}</span>
</span><span id="__span-0-127"><a href="#__codelineno-0-127" id="__codelineno-0-127" name="__codelineno-0-127"></a>
</span><span id="__span-0-128"><a href="#__codelineno-0-128" id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="nv">$tenantCache</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$TenantID</span><span class="p">,</span> <span class="nv">$domain</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-0-129"><a href="#__codelineno-0-129" id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="p">}</span>
</span><span id="__span-0-130"><a href="#__codelineno-0-130" id="__codelineno-0-130" name="__codelineno-0-130"></a>
</span><span id="__span-0-131"><a href="#__codelineno-0-131" id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">return</span> <span class="nv">$domain</span>
</span><span id="__span-0-132"><a href="#__codelineno-0-132" id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="p">}</span>
</span><span id="__span-0-133"><a href="#__codelineno-0-133" id="__codelineno-0-133" name="__codelineno-0-133"></a>
</span><span id="__span-0-134"><a href="#__codelineno-0-134" id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="k">function</span> <span class="nb">Get-TenantFromSubscription</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-135"><a href="#__codelineno-0-135" id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="nv">$tenant</span> <span class="p">=</span> <span class="nv">$null</span>
</span><span id="__span-0-136"><a href="#__codelineno-0-136" id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$subscriptionToTenantCache</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-137"><a href="#__codelineno-0-137" id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="nv">$tenant</span> <span class="p">=</span> <span class="nv">$subscriptionToTenantCache</span><span class="p">[</span><span class="nv">$SubscriptionID</span><span class="p">]</span>
</span><span id="__span-0-138"><a href="#__codelineno-0-138" id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="p">}</span>
</span><span id="__span-0-139"><a href="#__codelineno-0-139" id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">elseif</span> <span class="p">(</span><span class="nv">$subscriptions</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-140"><a href="#__codelineno-0-140" id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="nv">$tenant</span> <span class="p">=</span> <span class="nv">$subscriptions</span><span class="p">[</span><span class="nv">$SubscriptionID</span><span class="p">].</span><span class="n">TenantID</span>
</span><span id="__span-0-141"><a href="#__codelineno-0-141" id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="nv">$subscriptionToTenantCache</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">,</span> <span class="nv">$tenant</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-0-142"><a href="#__codelineno-0-142" id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="p">}</span>
</span><span id="__span-0-143"><a href="#__codelineno-0-143" id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-144"><a href="#__codelineno-0-144" id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-0-145"><a href="#__codelineno-0-145" id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a href="#__codelineno-0-146" id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="nv">$subscriptionResponse</span> <span class="p">=</span> <span class="nb">Invoke-AzRestMethod</span> <span class="n">-Path</span> <span class="s2">"/subscriptions/</span><span class="p">$(</span><span class="nv">$SubscriptionID</span><span class="p">)</span><span class="s2">?api-version=2022-12-01"</span>
</span><span id="__span-0-147"><a href="#__codelineno-0-147" id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="nv">$startIndex</span> <span class="p">=</span> <span class="nv">$subscriptionResponse</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">WwwAuthenticate</span><span class="p">.</span><span class="k">Parameter</span><span class="p">.</span><span class="n">IndexOf</span><span class="p">(</span><span class="s2">"https://login.windows.net/"</span><span class="p">)</span>
</span><span id="__span-0-148"><a href="#__codelineno-0-148" id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="nv">$tenantID</span> <span class="p">=</span> <span class="nv">$subscriptionResponse</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">WwwAuthenticate</span><span class="p">.</span><span class="k">Parameter</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="nv">$startIndex</span> <span class="p">+</span> <span class="s2">"https://login.windows.net/"</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">36</span><span class="p">)</span>
</span><span id="__span-0-149"><a href="#__codelineno-0-149" id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a href="#__codelineno-0-150" id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="nv">$tenant</span> <span class="p">=</span> <span class="nv">$tenantID</span>
</span><span id="__span-0-151"><a href="#__codelineno-0-151" id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="p">}</span>
</span><span id="__span-0-152"><a href="#__codelineno-0-152" id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-0-153"><a href="#__codelineno-0-153" id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="nb">Write-Warning</span> <span class="s2">"Failed to get tenant from subscription '$SubscriptionID'"</span>
</span><span id="__span-0-154"><a href="#__codelineno-0-154" id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="p">}</span>
</span><span id="__span-0-155"><a href="#__codelineno-0-155" id="__codelineno-0-155" name="__codelineno-0-155"></a>
</span><span id="__span-0-156"><a href="#__codelineno-0-156" id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="p">(</span><span class="no">[string]</span><span class="p">::</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="nv">$tenant</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-0-157"><a href="#__codelineno-0-157" id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="nb">Write-Warning</span> <span class="s2">"Using fallback tenant information for '$SubscriptionID'"</span>
</span><span id="__span-0-158"><a href="#__codelineno-0-158" id="__codelineno-0-158" name="__codelineno-0-158"></a>
</span><span id="__span-0-159"><a href="#__codelineno-0-159" id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="nv">$tenant</span> <span class="p">=</span> <span class="no">[Guid]</span><span class="p">::</span><span class="n">Empty</span><span class="p">.</span><span class="n">Guid</span>
</span><span id="__span-0-160"><a href="#__codelineno-0-160" id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="p">}</span>
</span><span id="__span-0-161"><a href="#__codelineno-0-161" id="__codelineno-0-161" name="__codelineno-0-161"></a>
</span><span id="__span-0-162"><a href="#__codelineno-0-162" id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="nv">$subscriptionToTenantCache</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$SubscriptionID</span><span class="p">,</span> <span class="nv">$tenant</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-0-163"><a href="#__codelineno-0-163" id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="p">}</span>
</span><span id="__span-0-164"><a href="#__codelineno-0-164" id="__codelineno-0-164" name="__codelineno-0-164"></a>
</span><span id="__span-0-165"><a href="#__codelineno-0-165" id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">return</span> <span class="nv">$tenant</span>
</span><span id="__span-0-166"><a href="#__codelineno-0-166" id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="p">}</span>
</span><span id="__span-0-167"><a href="#__codelineno-0-167" id="__codelineno-0-167" name="__codelineno-0-167"></a>
</span><span id="__span-0-168"><a href="#__codelineno-0-168" id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="nv">$kqlQuery</span> <span class="p">=</span> <span class="sh">@"</span>
</span><span id="__span-0-169"><a href="#__codelineno-0-169" id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sh">resources</span>
</span><span id="__span-0-170"><a href="#__codelineno-0-170" id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sh">| where type == "microsoft.network/privateendpoints"</span>
</span><span id="__span-0-171"><a href="#__codelineno-0-171" id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sh">| where isnotnull(properties) and properties contains "manualPrivateLinkServiceConnections"</span>
</span><span id="__span-0-172"><a href="#__codelineno-0-172" id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sh">| where array_length(properties.manualPrivateLinkServiceConnections) &gt; 0</span>
</span><span id="__span-0-173"><a href="#__codelineno-0-173" id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sh">| mv-expand properties.manualPrivateLinkServiceConnections</span>
</span><span id="__span-0-174"><a href="#__codelineno-0-174" id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sh">| extend status = properties_manualPrivateLinkServiceConnections.properties.privateLinkServiceConnectionState.status</span>
</span><span id="__span-0-175"><a href="#__codelineno-0-175" id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sh">| extend description = coalesce(properties_manualPrivateLinkServiceConnections.properties.privateLinkServiceConnectionState.description, "")</span>
</span><span id="__span-0-176"><a href="#__codelineno-0-176" id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sh">| extend privateLinkServiceId = properties_manualPrivateLinkServiceConnections.properties.privateLinkServiceId</span>
</span><span id="__span-0-177"><a href="#__codelineno-0-177" id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sh">| extend privateLinkServiceSubscriptionId = tostring(split(privateLinkServiceId, "/")[2])</span>
</span><span id="__span-0-178"><a href="#__codelineno-0-178" id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sh">| project id, name, location, type, resourceGroup, subscriptionId, tenantId, privateLinkServiceId, privateLinkServiceSubscriptionId, status, description</span>
</span><span id="__span-0-179"><a href="#__codelineno-0-179" id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sh">"@</span>
</span><span id="__span-0-180"><a href="#__codelineno-0-180" id="__codelineno-0-180" name="__codelineno-0-180"></a>
</span><span id="__span-0-181"><a href="#__codelineno-0-181" id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="nv">$batchSize</span> <span class="p">=</span> <span class="n">1000</span>
</span><span id="__span-0-182"><a href="#__codelineno-0-182" id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="nv">$skipResult</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-0-183"><a href="#__codelineno-0-183" id="__codelineno-0-183" name="__codelineno-0-183"></a>
</span><span id="__span-0-184"><a href="#__codelineno-0-184" id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="nv">$privateEndpoints</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
</span><span id="__span-0-185"><a href="#__codelineno-0-185" id="__codelineno-0-185" name="__codelineno-0-185"></a>
</span><span id="__span-0-186"><a href="#__codelineno-0-186" id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="k">while</span> <span class="p">(</span><span class="nv">$true</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-187"><a href="#__codelineno-0-187" id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a href="#__codelineno-0-188" id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$skipResult</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-189"><a href="#__codelineno-0-189" id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span> <span class="n">-SkipToken</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">SkipToken</span> <span class="n">-UseTenantScope</span>
</span><span id="__span-0-190"><a href="#__codelineno-0-190" id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="p">}</span>
</span><span id="__span-0-191"><a href="#__codelineno-0-191" id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-192"><a href="#__codelineno-0-192" id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span> <span class="n">-UseTenantScope</span>
</span><span id="__span-0-193"><a href="#__codelineno-0-193" id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="p">}</span>
</span><span id="__span-0-194"><a href="#__codelineno-0-194" id="__codelineno-0-194" name="__codelineno-0-194"></a>
</span><span id="__span-0-195"><a href="#__codelineno-0-195" id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">in</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-196"><a href="#__codelineno-0-196" id="__codelineno-0-196" name="__codelineno-0-196"></a>
</span><span id="__span-0-197"><a href="#__codelineno-0-197" id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="nv">$si1</span> <span class="p">=</span> <span class="nb">Get-SubscriptionInformation</span> <span class="n">-SubscriptionID</span> <span class="nv">$row</span><span class="p">.</span><span class="n">SubscriptionID</span>
</span><span id="__span-0-198"><a href="#__codelineno-0-198" id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="nv">$ti1</span> <span class="p">=</span> <span class="nb">Get-TenantInformation</span> <span class="n">-TenantID</span> <span class="nv">$row</span><span class="p">.</span><span class="n">TenantID</span>
</span><span id="__span-0-199"><a href="#__codelineno-0-199" id="__codelineno-0-199" name="__codelineno-0-199"></a>
</span><span id="__span-0-200"><a href="#__codelineno-0-200" id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="nv">$si2</span> <span class="p">=</span> <span class="nb">Get-SubscriptionInformation</span> <span class="n">-SubscriptionID</span> <span class="nv">$row</span><span class="p">.</span><span class="n">PrivateLinkServiceSubscriptionId</span>
</span><span id="__span-0-201"><a href="#__codelineno-0-201" id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="nv">$tenant2</span> <span class="p">=</span> <span class="nb">Get-TenantFromSubscription</span> <span class="n">-SubscriptionID</span> <span class="nv">$si2</span><span class="p">.</span><span class="n">SubscriptionID</span>
</span><span id="__span-0-202"><a href="#__codelineno-0-202" id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="nv">$ti2</span> <span class="p">=</span> <span class="nb">Get-TenantInformation</span> <span class="n">-TenantID</span> <span class="nv">$tenant2</span>
</span><span id="__span-0-203"><a href="#__codelineno-0-203" id="__codelineno-0-203" name="__codelineno-0-203"></a>
</span><span id="__span-0-204"><a href="#__codelineno-0-204" id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="nv">$peData</span> <span class="p">=</span> <span class="no">[PrivateEndpointData]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-205"><a href="#__codelineno-0-205" id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">ID</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">ID</span>
</span><span id="__span-0-206"><a href="#__codelineno-0-206" id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-0-207"><a href="#__codelineno-0-207" id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="nb">Type </span><span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="nb">Type</span>
</span><span id="__span-0-208"><a href="#__codelineno-0-208" id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">Location</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">Location</span>
</span><span id="__span-0-209"><a href="#__codelineno-0-209" id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">ResourceGroup</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">ResourceGroup</span>
</span><span id="__span-0-210"><a href="#__codelineno-0-210" id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a href="#__codelineno-0-211" id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">SubscriptionName</span> <span class="p">=</span> <span class="nv">$si1</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-0-212"><a href="#__codelineno-0-212" id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">SubscriptionID</span> <span class="p">=</span> <span class="nv">$si1</span><span class="p">.</span><span class="n">SubscriptionID</span>
</span><span id="__span-0-213"><a href="#__codelineno-0-213" id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TenantID</span> <span class="p">=</span> <span class="nv">$ti1</span><span class="p">.</span><span class="n">TenantID</span>
</span><span id="__span-0-214"><a href="#__codelineno-0-214" id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TenantDisplayName</span> <span class="p">=</span> <span class="nv">$ti1</span><span class="p">.</span><span class="n">DisplayName</span>
</span><span id="__span-0-215"><a href="#__codelineno-0-215" id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TenantDomainName</span> <span class="p">=</span> <span class="nv">$ti1</span><span class="p">.</span><span class="n">DomainName</span>
</span><span id="__span-0-216"><a href="#__codelineno-0-216" id="__codelineno-0-216" name="__codelineno-0-216"></a>
</span><span id="__span-0-217"><a href="#__codelineno-0-217" id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetResourceId</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">PrivateLinkServiceId</span>
</span><span id="__span-0-218"><a href="#__codelineno-0-218" id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetSubscriptionName</span> <span class="p">=</span> <span class="nv">$si2</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-0-219"><a href="#__codelineno-0-219" id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetSubscriptionID</span> <span class="p">=</span> <span class="nv">$si2</span><span class="p">.</span><span class="n">SubscriptionID</span>
</span><span id="__span-0-220"><a href="#__codelineno-0-220" id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetTenantID</span> <span class="p">=</span> <span class="nv">$ti2</span><span class="p">.</span><span class="n">TenantID</span>
</span><span id="__span-0-221"><a href="#__codelineno-0-221" id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetTenantDisplayName</span> <span class="p">=</span> <span class="nv">$ti2</span><span class="p">.</span><span class="n">DisplayName</span>
</span><span id="__span-0-222"><a href="#__codelineno-0-222" id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">TargetTenantDomainName</span> <span class="p">=</span> <span class="nv">$ti2</span><span class="p">.</span><span class="n">DomainName</span>
</span><span id="__span-0-223"><a href="#__codelineno-0-223" id="__codelineno-0-223" name="__codelineno-0-223"></a>
</span><span id="__span-0-224"><a href="#__codelineno-0-224" id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">Description</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">Description</span>
</span><span id="__span-0-225"><a href="#__codelineno-0-225" id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="nv">$peData</span><span class="p">.</span><span class="n">Status</span> <span class="p">=</span> <span class="nv">$row</span><span class="p">.</span><span class="n">Status</span>
</span><span id="__span-0-226"><a href="#__codelineno-0-226" id="__codelineno-0-226" name="__codelineno-0-226"></a>
</span><span id="__span-0-227"><a href="#__codelineno-0-227" id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$ti2</span><span class="p">.</span><span class="n">DomainName</span> <span class="o">-eq</span> <span class="s2">"MSAzureCloud.onmicrosoft.com"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-228"><a href="#__codelineno-0-228" id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="nv">$peData</span><span class="p">.</span><span class="n">External</span> <span class="p">=</span> <span class="s2">"Managed by Microsoft"</span>
</span><span id="__span-0-229"><a href="#__codelineno-0-229" id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="p">}</span>
</span><span id="__span-0-230"><a href="#__codelineno-0-230" id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="k">elseif</span> <span class="p">(</span><span class="nv">$si2</span><span class="p">.</span><span class="n">TenantID</span> <span class="o">-eq</span> <span class="no">[Guid]</span><span class="p">::</span><span class="n">Empty</span><span class="p">.</span><span class="n">Guid</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-231"><a href="#__codelineno-0-231" id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="nv">$peData</span><span class="p">.</span><span class="n">External</span> <span class="p">=</span> <span class="s2">"Yes"</span>
</span><span id="__span-0-232"><a href="#__codelineno-0-232" id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="p">}</span>
</span><span id="__span-0-233"><a href="#__codelineno-0-233" id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-0-234"><a href="#__codelineno-0-234" id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="nv">$peData</span><span class="p">.</span><span class="n">External</span> <span class="p">=</span> <span class="s2">"No"</span>
</span><span id="__span-0-235"><a href="#__codelineno-0-235" id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="p">}</span>
</span><span id="__span-0-236"><a href="#__codelineno-0-236" id="__codelineno-0-236" name="__codelineno-0-236"></a>
</span><span id="__span-0-237"><a href="#__codelineno-0-237" id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="nv">$privateEndpoints</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$peData</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-0-238"><a href="#__codelineno-0-238" id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="p">}</span>
</span><span id="__span-0-239"><a href="#__codelineno-0-239" id="__codelineno-0-239" name="__codelineno-0-239"></a>
</span><span id="__span-0-240"><a href="#__codelineno-0-240" id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Count</span> <span class="o">-lt</span> <span class="nv">$batchSize</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-241"><a href="#__codelineno-0-241" id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">break</span><span class="p">;</span>
</span><span id="__span-0-242"><a href="#__codelineno-0-242" id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="p">}</span>
</span><span id="__span-0-243"><a href="#__codelineno-0-243" id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="nv">$skipResult</span> <span class="p">+=</span> <span class="nv">$skipResult</span> <span class="p">+</span> <span class="nv">$batchSize</span>
</span><span id="__span-0-244"><a href="#__codelineno-0-244" id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="p">}</span>
</span><span id="__span-0-245"><a href="#__codelineno-0-245" id="__codelineno-0-245" name="__codelineno-0-245"></a>
</span><span id="__span-0-246"><a href="#__codelineno-0-246" id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="nv">$privateEndpoints</span> <span class="p">|</span> <span class="nb">Format-Table</span>
</span><span id="__span-0-247"><a href="#__codelineno-0-247" id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="nv">$privateEndpoints</span> <span class="p">|</span> <span class="nb">Export-CSV</span> <span class="s2">"private-endpoints.csv"</span> <span class="n">-Delimiter</span> <span class="s1">';'</span> <span class="n">-Force</span>
</span><span id="__span-0-248"><a href="#__codelineno-0-248" id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a href="#__codelineno-0-249" id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="s2">"Found </span><span class="p">$(</span><span class="nv">$privateEndpoints</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> private endpoints with manual connections"</span>
</span><span id="__span-0-250"><a href="#__codelineno-0-250" id="__codelineno-0-250" name="__codelineno-0-250"></a>
</span><span id="__span-0-251"><a href="#__codelineno-0-251" id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$privateEndpoints</span><span class="p">.</span><span class="n">Count</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-252"><a href="#__codelineno-0-252" id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="nb">Start-Process</span> <span class="s2">"private-endpoints.csv"</span>
</span><span id="__span-0-253"><a href="#__codelineno-0-253" id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="2024/10/16/how-to-check-if-a-private-endpoint-is-connected-to-a-external-private-link-service-in-azure/#conclusion">Conclusion</a></h3>
<p>Now you know how to check if a private endpoint is connected to an external private link service in Azure.</p>
<p>That's all folks!</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341"/>
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-10-04 00:00:00">October 4, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-check-if-a-role-permission-is-good-or-bad-in-azure-rbac"><a class="toclink" href="2024/10/04/how-to-check-if-a-role-permission-is-good-or-bad-in-azure-rbac/">How to check if a role permission is good or bad in Azure RBAC</a></h2>
<p>Do you need to check if a role permission is good or bad or just don't know what actions a provider has in Azure RBAC?</p>
<p>Get-AzProviderOperation * is your friend and you can always export everything to csv:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nb">Get-AzProviderOperation</span> <span class="p">|</span> <span class="nb">select </span><span class="n">Operation</span> <span class="p">,</span> <span class="n">OperationName</span> <span class="p">,</span> <span class="n">ProviderNamespace</span> <span class="p">,</span> <span class="n">ResourceName</span> <span class="p">,</span> <span class="n">Description</span> <span class="p">,</span> <span class="n">IsDataAction</span> <span class="p">|</span> <span class="nb">Export-csv</span> <span class="n">AzProviderOperation</span><span class="p">.</span><span class="n">csv</span>
</span></code></pre></div>
<p>This command will give you a list of all the operations that you can perform on Azure resources, including the operation name, provider namespace, resource name, description, and whether it is a data action or not. You can use this information to check if a role permission is good or bad, or to find out what actions a provider has in Azure RBAC.</p>
<h3 id="script-to-check-if-a-role-permission-is-good-or-bad-on-tf-files"><a class="toclink" href="2024/10/04/how-to-check-if-a-role-permission-is-good-or-bad-in-azure-rbac/#script-to-check-if-a-role-permission-is-good-or-bad-on-tf-files">Script to check if a role permission is good or bad on tf files</a></h3>
<p>You can use the following script to check if a role permission is good or bad on tf files:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="cm">&lt;#</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="sd">.SYNOPSIS</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="cm">Script to check if a role permission is good or bad in Azure RBAC using Terraform files.</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="sd">.DESCRIPTION</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="cm">This script downloads Azure provider operations to a CSV file, reads the CSV file, extracts text from Terraform (.tf and .tfvars) files, and compares the extracted text with the CSV data to find mismatches.</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">.PARAMETER</span><span class="cm"> csvFilePath</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="cm">The path to the CSV file where Azure provider operations will be downloaded.</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="sd">.PARAMETER</span><span class="cm"> tfFolderPath</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="cm">The path to the folder containing Terraform (.tf and .tfvars) files.</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="sd">.PARAMETER</span><span class="cm"> DebugMode</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="cm">Switch to enable debug mode for detailed output.</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="cm">.\Check-RBAC.ps1 -csvFilePath ".\petete.csv" -tfFolderPath ".\"</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="cm">.\Check-RBAC.ps1 -csvFilePath ".\petete.csv" -tfFolderPath ".\" -DebugMode</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="sd">.NOTES</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="cm">For more information, refer to the following resources:</span>
</span><span id="__span-1-25"><a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="cm">- Azure RBAC Documentation: https://docs.microsoft.com/en-us/azure/role-based-access-control/</span>
</span><span id="__span-1-26"><a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="cm">- Get-AzProviderOperation Cmdlet: https://docs.microsoft.com/en-us/powershell/module/az.resources/get-azprovideroperation</span>
</span><span id="__span-1-27"><a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="cm">- Export-Csv Cmdlet: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/export-csv</span>
</span><span id="__span-1-28"><a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="cm">#&gt;</span>
</span><span id="__span-1-29"><a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a>
</span><span id="__span-1-30"><a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="k">param</span><span class="p">(</span>
</span><span id="__span-1-31"><a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a>    <span class="no">[string]</span><span class="nv">$csvFilePath</span> <span class="p">=</span> <span class="s2">".\petete.csv"</span><span class="p">,</span>
</span><span id="__span-1-32"><a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a>    <span class="no">[string]</span><span class="nv">$tfFolderPath</span> <span class="p">=</span> <span class="s2">".\"</span><span class="p">,</span>
</span><span id="__span-1-33"><a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a>    <span class="no">[switch]</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-34"><a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="p">)</span>
</span><span id="__span-1-35"><a href="#__codelineno-1-35" id="__codelineno-1-35" name="__codelineno-1-35"></a>
</span><span id="__span-1-36"><a href="#__codelineno-1-36" id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="c"># Download petete.csv using Get-AzProviderOperation</span>
</span><span id="__span-1-37"><a href="#__codelineno-1-37" id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="k">function</span> <span class="n">Download-CSV</span> <span class="p">{</span>
</span><span id="__span-1-38"><a href="#__codelineno-1-38" id="__codelineno-1-38" name="__codelineno-1-38"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-1-39"><a href="#__codelineno-1-39" id="__codelineno-1-39" name="__codelineno-1-39"></a>        <span class="no">[string]</span><span class="nv">$filename</span><span class="p">,</span>
</span><span id="__span-1-40"><a href="#__codelineno-1-40" id="__codelineno-1-40" name="__codelineno-1-40"></a>        <span class="no">[switch]</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-41"><a href="#__codelineno-1-41" id="__codelineno-1-41" name="__codelineno-1-41"></a>    <span class="p">)</span>
</span><span id="__span-1-42"><a href="#__codelineno-1-42" id="__codelineno-1-42" name="__codelineno-1-42"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Downloading petete.csv using Get-AzProviderOperation"</span> <span class="p">}</span>
</span><span id="__span-1-43"><a href="#__codelineno-1-43" id="__codelineno-1-43" name="__codelineno-1-43"></a>    <span class="nb">Get-AzProviderOperation</span> <span class="p">|</span> <span class="nb">select </span><span class="n">Operation</span><span class="p">,</span> <span class="n">OperationName</span><span class="p">,</span> <span class="n">ProviderNamespace</span><span class="p">,</span> <span class="n">ResourceName</span><span class="p">,</span> <span class="n">Description</span><span class="p">,</span> <span class="n">IsDataAction</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">-Path</span> <span class="nv">$filename</span> <span class="n">-NoTypeInformation</span>
</span><span id="__span-1-44"><a href="#__codelineno-1-44" id="__codelineno-1-44" name="__codelineno-1-44"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"CSV file downloaded: $filename"</span> <span class="p">}</span>
</span><span id="__span-1-45"><a href="#__codelineno-1-45" id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="p">}</span>
</span><span id="__span-1-46"><a href="#__codelineno-1-46" id="__codelineno-1-46" name="__codelineno-1-46"></a>
</span><span id="__span-1-47"><a href="#__codelineno-1-47" id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="c"># Function to read the CSV file</span>
</span><span id="__span-1-48"><a href="#__codelineno-1-48" id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="k">function</span> <span class="nb">Read-CSV</span> <span class="p">{</span>
</span><span id="__span-1-49"><a href="#__codelineno-1-49" id="__codelineno-1-49" name="__codelineno-1-49"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-1-50"><a href="#__codelineno-1-50" id="__codelineno-1-50" name="__codelineno-1-50"></a>        <span class="no">[string]</span><span class="nv">$filename</span><span class="p">,</span>
</span><span id="__span-1-51"><a href="#__codelineno-1-51" id="__codelineno-1-51" name="__codelineno-1-51"></a>        <span class="no">[switch]</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-52"><a href="#__codelineno-1-52" id="__codelineno-1-52" name="__codelineno-1-52"></a>    <span class="p">)</span>
</span><span id="__span-1-53"><a href="#__codelineno-1-53" id="__codelineno-1-53" name="__codelineno-1-53"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Reading CSV file: $filename"</span> <span class="p">}</span>
</span><span id="__span-1-54"><a href="#__codelineno-1-54" id="__codelineno-1-54" name="__codelineno-1-54"></a>    <span class="nv">$csv</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="n">-Path</span> <span class="nv">$filename</span>
</span><span id="__span-1-55"><a href="#__codelineno-1-55" id="__codelineno-1-55" name="__codelineno-1-55"></a>    <span class="nv">$csvData</span> <span class="p">=</span> <span class="nv">$csv</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-1-56"><a href="#__codelineno-1-56" id="__codelineno-1-56" name="__codelineno-1-56"></a>        <span class="no">[PSCustomObject]</span><span class="p">@{</span>
</span><span id="__span-1-57"><a href="#__codelineno-1-57" id="__codelineno-1-57" name="__codelineno-1-57"></a>            <span class="n">Provider</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Operation</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="n">0</span><span class="p">].</span><span class="n">Trim</span><span class="p">()</span>
</span><span id="__span-1-58"><a href="#__codelineno-1-58" id="__codelineno-1-58" name="__codelineno-1-58"></a>            <span class="n">Operation</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Operation</span>
</span><span id="__span-1-59"><a href="#__codelineno-1-59" id="__codelineno-1-59" name="__codelineno-1-59"></a>            <span class="n">OperationName</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">OperationName</span>
</span><span id="__span-1-60"><a href="#__codelineno-1-60" id="__codelineno-1-60" name="__codelineno-1-60"></a>            <span class="n">ProviderNamespace</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">ProviderNamespace</span>
</span><span id="__span-1-61"><a href="#__codelineno-1-61" id="__codelineno-1-61" name="__codelineno-1-61"></a>            <span class="n">ResourceName</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">ResourceName</span>
</span><span id="__span-1-62"><a href="#__codelineno-1-62" id="__codelineno-1-62" name="__codelineno-1-62"></a>            <span class="n">Description</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Description</span>
</span><span id="__span-1-63"><a href="#__codelineno-1-63" id="__codelineno-1-63" name="__codelineno-1-63"></a>            <span class="n">IsDataAction</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">IsDataAction</span>
</span><span id="__span-1-64"><a href="#__codelineno-1-64" id="__codelineno-1-64" name="__codelineno-1-64"></a>        <span class="p">}</span>
</span><span id="__span-1-65"><a href="#__codelineno-1-65" id="__codelineno-1-65" name="__codelineno-1-65"></a>    <span class="p">}</span>
</span><span id="__span-1-66"><a href="#__codelineno-1-66" id="__codelineno-1-66" name="__codelineno-1-66"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Data read from CSV:"</span><span class="p">;</span> <span class="nv">$csvData</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span> <span class="p">}</span>
</span><span id="__span-1-67"><a href="#__codelineno-1-67" id="__codelineno-1-67" name="__codelineno-1-67"></a>    <span class="k">return</span> <span class="nv">$csvData</span>
</span><span id="__span-1-68"><a href="#__codelineno-1-68" id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="p">}</span>
</span><span id="__span-1-69"><a href="#__codelineno-1-69" id="__codelineno-1-69" name="__codelineno-1-69"></a>
</span><span id="__span-1-70"><a href="#__codelineno-1-70" id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="c"># Function to extract text from the Terraform files</span>
</span><span id="__span-1-71"><a href="#__codelineno-1-71" id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="k">function</span> <span class="n">Extract-Text-From-TF</span> <span class="p">{</span>
</span><span id="__span-1-72"><a href="#__codelineno-1-72" id="__codelineno-1-72" name="__codelineno-1-72"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-1-73"><a href="#__codelineno-1-73" id="__codelineno-1-73" name="__codelineno-1-73"></a>        <span class="no">[string]</span><span class="nv">$folderPath</span><span class="p">,</span>
</span><span id="__span-1-74"><a href="#__codelineno-1-74" id="__codelineno-1-74" name="__codelineno-1-74"></a>        <span class="no">[switch]</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-75"><a href="#__codelineno-1-75" id="__codelineno-1-75" name="__codelineno-1-75"></a>    <span class="p">)</span>
</span><span id="__span-1-76"><a href="#__codelineno-1-76" id="__codelineno-1-76" name="__codelineno-1-76"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Reading TF and TFVARS files in folder: $folderPath"</span> <span class="p">}</span>
</span><span id="__span-1-77"><a href="#__codelineno-1-77" id="__codelineno-1-77" name="__codelineno-1-77"></a>    <span class="nv">$tfTexts</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-1-78"><a href="#__codelineno-1-78" id="__codelineno-1-78" name="__codelineno-1-78"></a>    <span class="nv">$files</span> <span class="p">=</span> <span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="nv">$folderPath</span> <span class="n">-Filter</span> <span class="p">*.</span><span class="n">tf</span><span class="p">,*.</span><span class="n">tfvars</span>
</span><span id="__span-1-79"><a href="#__codelineno-1-79" id="__codelineno-1-79" name="__codelineno-1-79"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$file</span> <span class="k">in</span> <span class="nv">$files</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-1-80"><a href="#__codelineno-1-80" id="__codelineno-1-80" name="__codelineno-1-80"></a>        <span class="nv">$content</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="nv">$file</span><span class="p">.</span><span class="n">FullName</span>
</span><span id="__span-1-81"><a href="#__codelineno-1-81" id="__codelineno-1-81" name="__codelineno-1-81"></a>        <span class="nv">$tfTexts</span> <span class="p">+=</span> <span class="nv">$content</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="n">-Pattern</span> <span class="s1">'"Microsoft\.[^"]*"'</span> <span class="n">-AllMatches</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Matches</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">(</span><span class="s1">'"'</span><span class="p">).</span><span class="n">Trim</span><span class="p">()</span> <span class="p">}</span>
</span><span id="__span-1-82"><a href="#__codelineno-1-82" id="__codelineno-1-82" name="__codelineno-1-82"></a>        <span class="nv">$tfTexts</span> <span class="p">+=</span> <span class="nv">$content</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="n">-Pattern</span> <span class="s1">'"\*"'</span> <span class="n">-AllMatches</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Matches</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">(</span><span class="s1">'"'</span><span class="p">).</span><span class="n">Trim</span><span class="p">()</span> <span class="p">}</span>
</span><span id="__span-1-83"><a href="#__codelineno-1-83" id="__codelineno-1-83" name="__codelineno-1-83"></a>        <span class="nv">$tfTexts</span> <span class="p">+=</span> <span class="nv">$content</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="n">-Pattern</span> <span class="s1">'^\s*\*/'</span> <span class="n">-AllMatches</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Matches</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span> <span class="p">}</span>
</span><span id="__span-1-84"><a href="#__codelineno-1-84" id="__codelineno-1-84" name="__codelineno-1-84"></a>    <span class="p">}</span>
</span><span id="__span-1-85"><a href="#__codelineno-1-85" id="__codelineno-1-85" name="__codelineno-1-85"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Texts extracted from TF and TFVARS files:"</span><span class="p">;</span> <span class="nv">$tfTexts</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span> <span class="p">}</span>
</span><span id="__span-1-86"><a href="#__codelineno-1-86" id="__codelineno-1-86" name="__codelineno-1-86"></a>    <span class="k">return</span> <span class="nv">$tfTexts</span>
</span><span id="__span-1-87"><a href="#__codelineno-1-87" id="__codelineno-1-87" name="__codelineno-1-87"></a><span class="p">}</span>
</span><span id="__span-1-88"><a href="#__codelineno-1-88" id="__codelineno-1-88" name="__codelineno-1-88"></a>
</span><span id="__span-1-89"><a href="#__codelineno-1-89" id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="c"># Function to compare extracted text with CSV data</span>
</span><span id="__span-1-90"><a href="#__codelineno-1-90" id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="k">function</span> <span class="nb">Compare-Text</span><span class="n">-With-CSV</span> <span class="p">{</span>
</span><span id="__span-1-91"><a href="#__codelineno-1-91" id="__codelineno-1-91" name="__codelineno-1-91"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-1-92"><a href="#__codelineno-1-92" id="__codelineno-1-92" name="__codelineno-1-92"></a>        <span class="no">[array]</span><span class="nv">$csvData</span><span class="p">,</span>
</span><span id="__span-1-93"><a href="#__codelineno-1-93" id="__codelineno-1-93" name="__codelineno-1-93"></a>        <span class="no">[array]</span><span class="nv">$tfTexts</span><span class="p">,</span>
</span><span id="__span-1-94"><a href="#__codelineno-1-94" id="__codelineno-1-94" name="__codelineno-1-94"></a>        <span class="no">[switch]</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-95"><a href="#__codelineno-1-95" id="__codelineno-1-95" name="__codelineno-1-95"></a>    <span class="p">)</span>
</span><span id="__span-1-96"><a href="#__codelineno-1-96" id="__codelineno-1-96" name="__codelineno-1-96"></a>    <span class="nv">$mismatches</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-1-97"><a href="#__codelineno-1-97" id="__codelineno-1-97" name="__codelineno-1-97"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$tfText</span> <span class="k">in</span> <span class="nv">$tfTexts</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-1-98"><a href="#__codelineno-1-98" id="__codelineno-1-98" name="__codelineno-1-98"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$tfText</span> <span class="o">-eq</span> <span class="s2">"*"</span> <span class="o">-or</span> <span class="nv">$tfText</span> <span class="o">-match</span> <span class="s1">'^\*/'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-1-99"><a href="#__codelineno-1-99" id="__codelineno-1-99" name="__codelineno-1-99"></a>            <span class="k">continue</span>
</span><span id="__span-1-100"><a href="#__codelineno-1-100" id="__codelineno-1-100" name="__codelineno-1-100"></a>        <span class="p">}</span>
</span><span id="__span-1-101"><a href="#__codelineno-1-101" id="__codelineno-1-101" name="__codelineno-1-101"></a>        <span class="nv">$tfTextPattern</span> <span class="p">=</span> <span class="nv">$tfText</span> <span class="o">-replace</span> <span class="s1">'\*'</span><span class="p">,</span> <span class="s1">'.*'</span>
</span><span id="__span-1-102"><a href="#__codelineno-1-102" id="__codelineno-1-102" name="__codelineno-1-102"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nv">$csvData</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Operation</span> <span class="o">-match</span> <span class="s2">"^$tfTextPattern$"</span> <span class="p">}))</span> <span class="p">{</span>
</span><span id="__span-1-103"><a href="#__codelineno-1-103" id="__codelineno-1-103" name="__codelineno-1-103"></a>            <span class="nv">$mismatches</span> <span class="p">+=</span> <span class="nv">$tfText</span>
</span><span id="__span-1-104"><a href="#__codelineno-1-104" id="__codelineno-1-104" name="__codelineno-1-104"></a>        <span class="p">}</span>
</span><span id="__span-1-105"><a href="#__codelineno-1-105" id="__codelineno-1-105" name="__codelineno-1-105"></a>    <span class="p">}</span>
</span><span id="__span-1-106"><a href="#__codelineno-1-106" id="__codelineno-1-106" name="__codelineno-1-106"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$DebugMode</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">"Mismatches found:"</span><span class="p">;</span> <span class="nv">$mismatches</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span> <span class="p">}</span>
</span><span id="__span-1-107"><a href="#__codelineno-1-107" id="__codelineno-1-107" name="__codelineno-1-107"></a>    <span class="k">return</span> <span class="nv">$mismatches</span>
</span><span id="__span-1-108"><a href="#__codelineno-1-108" id="__codelineno-1-108" name="__codelineno-1-108"></a><span class="p">}</span>
</span><span id="__span-1-109"><a href="#__codelineno-1-109" id="__codelineno-1-109" name="__codelineno-1-109"></a>
</span><span id="__span-1-110"><a href="#__codelineno-1-110" id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="c"># Main script execution</span>
</span><span id="__span-1-111"><a href="#__codelineno-1-111" id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="n">Download-CSV</span> <span class="n">-filename</span> <span class="nv">$csvFilePath</span> <span class="n">-DebugMode</span><span class="p">:</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-112"><a href="#__codelineno-1-112" id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="nv">$csvData</span> <span class="p">=</span> <span class="nb">Read-CSV</span> <span class="n">-filename</span> <span class="nv">$csvFilePath</span> <span class="n">-DebugMode</span><span class="p">:</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-113"><a href="#__codelineno-1-113" id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="nv">$tfTexts</span> <span class="p">=</span> <span class="n">Extract-Text-From-TF</span> <span class="n">-folderPath</span> <span class="nv">$tfFolderPath</span> <span class="n">-DebugMode</span><span class="p">:</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-114"><a href="#__codelineno-1-114" id="__codelineno-1-114" name="__codelineno-1-114"></a><span class="nv">$mismatches</span> <span class="p">=</span> <span class="nb">Compare-Text</span><span class="n">-With-CSV</span> <span class="n">-csvData</span> <span class="nv">$csvData</span> <span class="n">-tfTexts</span> <span class="nv">$tfTexts</span> <span class="n">-DebugMode</span><span class="p">:</span><span class="nv">$DebugMode</span>
</span><span id="__span-1-115"><a href="#__codelineno-1-115" id="__codelineno-1-115" name="__codelineno-1-115"></a>
</span><span id="__span-1-116"><a href="#__codelineno-1-116" id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$mismatches</span><span class="p">.</span><span class="n">Count</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-1-117"><a href="#__codelineno-1-117" id="__codelineno-1-117" name="__codelineno-1-117"></a>    <span class="nb">Write-Host</span> <span class="s2">"All extracted texts match the CSV data."</span>
</span><span id="__span-1-118"><a href="#__codelineno-1-118" id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-1-119"><a href="#__codelineno-1-119" id="__codelineno-1-119" name="__codelineno-1-119"></a>    <span class="nb">Write-Host</span> <span class="s2">"Mismatches found:"</span>
</span><span id="__span-1-120"><a href="#__codelineno-1-120" id="__codelineno-1-120" name="__codelineno-1-120"></a>    <span class="nv">$mismatches</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span>
</span><span id="__span-1-121"><a href="#__codelineno-1-121" id="__codelineno-1-121" name="__codelineno-1-121"></a><span class="p">}</span>
</span></code></pre></div>
<p>This script downloads Azure provider operations to a CSV file, reads the CSV file, extracts text from Terraform files, and compares the extracted text with the CSV data to find mismatches. You can use this script to check if a role permission is good or bad in Azure RBAC using Terraform files.</p>
<p>I hope this post has given you a good introduction to how you can check if a role permission is good or bad in Azure RBAC and how you can use Terraform files to automate this process. </p>
<p>Happy coding! ð</p>
</div>
</article>
<nav class="md-pagination">
<span class="md-pagination__current">1</span> <a class="md-pagination__link" href="page/2/">2</a> <a class="md-pagination__link" href="page/3/">3</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="page/8/">8</a>
</nav>
</div>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright Â© 2023-now Rafael FernÃ¡ndez
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/rafaelfernandezd/" rel="noopener" target="_blank" title="LinkedIn">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/rfernandezdo" rel="noopener" target="_blank" title="GitHub">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://rfernandezdo.github.io/feed_rss_created.xml" rel="noopener" target="_blank" title="RSS feed">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24m0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24m0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../javascripts/tablesort.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>