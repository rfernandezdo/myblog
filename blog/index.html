<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="A blog about Azure, DevOps and other stuff" name=description><meta content="Rafael Fernández" name=author><link href=https://rfernandezdo.github.io/blog/ rel=canonical><link href=tags/ rel=next><link href=../feed_rss_created.xml rel=alternate title="RSS feed" type=application/rss+xml><link href=../feed_rss_updated.xml rel=alternate title="RSS feed of updated content" type=application/rss+xml><link href=../assets/images/favicon.png rel=icon><meta content="mkdocs-1.5.3, mkdocs-material-9.5.17" name=generator><title>Blog - Un Rinconcito donde contar lo que quiera</title><link href=../assets/stylesheets/main.bcfcd587.min.css rel=stylesheet><link href=../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta content=website property=og:type><meta content="Blog - Un Rinconcito donde contar lo que quiera" property=og:title><meta content="A blog about Azure, DevOps and other stuff" property=og:description><meta content=https://rfernandezdo.github.io/assets/images/social/blog/index.png property=og:image><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=https://rfernandezdo.github.io/blog/ property=og:url><meta content=summary_large_image name=twitter:card><meta content="Blog - Un Rinconcito donde contar lo que quiera" name=twitter:title><meta content="A blog about Azure, DevOps and other stuff" name=twitter:description><meta content=https://rfernandezdo.github.io/assets/images/social/blog/index.png name=twitter:image> <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head> <body data-md-color-accent=blue data-md-color-primary=blue data-md-color-scheme=default dir=ltr> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#blog> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component=logo href=.. title="Un Rinconcito donde contar lo que quiera"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Un Rinconcito donde contar lo que quiera </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Blog </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=blue data-md-color-media data-md-color-primary=blue data-md-color-scheme=default id=__palette_0 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=blue data-md-color-media data-md-color-primary=black data-md-color-scheme=slate id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_0 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button aria-label="Select language" class="md-header__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"></path></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a class=md-select__link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&_x_tr_tl=es&_x_tr_hl=es&_x_tr_pto=wapp" hreflang=en> English </a> </li> <li class=md-select__item> <a class=md-select__link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=en&_x_tr_pto=wapp" hreflang=es> Spanish </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=..> About </a> </li> <li class=md-tabs__item> <a href=../contributions/ class=md-tabs__link> Contributions </a> </li> <li class=md-tabs__item> <a href=../Azure/Security/MCSB/Readme/ class=md-tabs__link> Azure </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component=logo href=.. title="Un Rinconcito donde contar lo que quiera"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> Un Rinconcito donde contar lo que quiera </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_1_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=tags/ class=md-nav__link> <span class=md-ellipsis> Posts by Tags </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_1_3 type=checkbox> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_1_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=2024/04/ class=md-nav__link> <span class=md-ellipsis> 2024/04 </span> </a> </li> <li class=md-nav__item> <a href=2024/03/ class=md-nav__link> <span class=md-ellipsis> 2024/03 </span> </a> </li> <li class=md-nav__item> <a href=2024/02/ class=md-nav__link> <span class=md-ellipsis> 2024/02 </span> </a> </li> <li class=md-nav__item> <a href=2023/12/ class=md-nav__link> <span class=md-ellipsis> 2023/12 </span> </a> </li> <li class=md-nav__item> <a href=2023/11/ class=md-nav__link> <span class=md-ellipsis> 2023/11 </span> </a> </li> <li class=md-nav__item> <a href=2023/10/ class=md-nav__link> <span class=md-ellipsis> 2023/10 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_1_4 type=checkbox> <label class=md-nav__link for=__nav_1_4 id=__nav_1_4_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_1_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=category/azure-frameworks/ class=md-nav__link> <span class=md-ellipsis> Azure Frameworks </span> </a> </li> <li class=md-nav__item> <a href=category/azure-services/ class=md-nav__link> <span class=md-ellipsis> Azure Services </span> </a> </li> <li class=md-nav__item> <a href=category/azure-updates/ class=md-nav__link> <span class=md-ellipsis> Azure Updates </span> </a> </li> <li class=md-nav__item> <a href=category/devops/ class=md-nav__link> <span class=md-ellipsis> DevOps </span> </a> </li> <li class=md-nav__item> <a href=category/development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=category/english/ class=md-nav__link> <span class=md-ellipsis> English </span> </a> </li> <li class=md-nav__item> <a href=category/hello_world/ class=md-nav__link> <span class=md-ellipsis> Hello_World </span> </a> </li> <li class=md-nav__item> <a href=category/microsoft-365/ class=md-nav__link> <span class=md-ellipsis> Microsoft 365 </span> </a> </li> <li class=md-nav__item> <a href=category/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=category/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> <li class=md-nav__item> <a href=category/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=..> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../contributions/ class=md-nav__link> <span class=md-ellipsis> Contributions </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4_1 type=checkbox> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_1_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4_1_1 type=checkbox> <label class=md-nav__link for=__nav_4_1_1 id=__nav_4_1_1_label tabindex=0> <span class=md-ellipsis> MCSB </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_1_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> MCSB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Readme/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Readme </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Asset%20Management/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Asset Management </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Backup%20and%20Recovery/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Backup and Recovery </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Data%20Protection/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Data Protection </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/DevOps%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - DevOps Security </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Endpoint%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Endpoint Security </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Governance%20and%20Strategy/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Governance and Strategy </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Identity%20Management/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Identity Management </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Incident%20Response/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Incident Response </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Logging and Threat Detection </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Network%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Network Security </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Posture and Vulnerability Mgmt </span> </a> </li> <li class=md-nav__item> <a href=../Azure/Security/MCSB/Privileged%20Access/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Privileged Access </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=blog>Blog</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-04 00:00:00">April 4, 2024</time></li> <li class=md-meta__item> in <a href=category/security/ class=md-meta__link>Security</a></li> <li class=md-meta__item> 4 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services><a href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/ class=toclink>Privileged Access Management (PAM) Strategy with Microsoft Entra ID and some Azure Services</a></h2> <p>Today, I'd like to share a brief of a recommended strategy for Privileged Access Management (PAM) of other vendors with Microsoft Entra ID and some Azure Services. This strategy is divided into seven phases:</p> <pre class=mermaid><code>
graph LR;
    A[Phase 1: Set Policy] 
    C[Phase 2: The Process of Discovery]
    E[Phase 3: Protect Credentials]
    G[Phase 4: Secure Privileged Access]
    I[Phase 5: Least Privilege]
    K[Phase 6: Control All Applications]
    M[Phase 7: Detect and Respond]

    A--&gt;C
    C--&gt;E
    E--&gt;G
    G--&gt;I
    I--&gt;K
    K--&gt;M
    M--&gt;A

    classDef phase fill:#f9f,stroke:#333,stroke-width:2px;
    class A,C,E,G,I,K,M phase;

</code></pre> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Be hybrid, be secure with a single control plane, use Azure ARC to inherit the same security and compliance policies across your on-premises, multi-cloud, and edge environments as in Azure.</p> </div> <h3 id=phase-1-set-policy><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-1-set-policy><strong>Phase 1: Set Policy</strong></a></h3> <p>The first step in any PAM strategy is to establish a clear policy. This policy should define who has access to what, when they have access, and what they can do with that access. It should also include guidelines for password management and multi-factor authentication. For example:</p> <ul> <li>Define clear access control policies.</li> <li>Establish guidelines for password management and multi-factor authentication.</li> <li>Regularly review and update the policy to reflect changes in the organization.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Azure Policy</strong> to define and manage policies for your Azure environment.</li> <li>Use <strong>Microsoft Entra multifactor authentication</strong> for implementing multi-factor authentication.</li> </ul> <h3 id=phase-2-the-process-of-discovery><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-2-the-process-of-discovery><strong>Phase 2: The Process of Discovery</strong></a></h3> <p>In this phase, we identify all the privileged accounts across the organization. This includes service accounts, local administrative accounts, domain administrative accounts, emergency accounts, and application accounts. For example:</p> <ul> <li>Use automated tools to identify all privileged accounts across the organization.</li> <li>Regularly update the inventory of privileged accounts.</li> <li>Identify any accounts that are no longer in use and deactivate them.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra Privileged Identity Management</strong> to discover, restrict and monitor administrators and their access to resources and provide just-in-time access when needed.</li> </ul> <h3 id=phase-3-protect-credentials><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-3-protect-credentials><strong>Phase 3: Protect Credentials</strong></a></h3> <p>Once we've identified all privileged accounts, we need to ensure that these credentials are stored securely. This could involve using a secure vault, regularly rotating passwords, and using unique passwords for each account. For example:</p> <ul> <li>Store credentials in a secure vault.</li> <li>Implement regular password rotation.</li> <li>Use unique passwords for each account.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Azure Key Vault</strong> to safeguard cryptographic keys and other secrets used by your apps and services and <a href="https://learn.microsoft.com/en-us/azure/key-vault/secrets/tutorial-rotation-dual?tabs=azure-cli">rotate secrets regularly</a>.</li> <li>Implement <strong>Microsoft Entra ID Password Protection</strong> to protect against weak passwords that can be easily guessed or cracked.</li> </ul> <h3 id=phase-4-secure-privileged-access><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-4-secure-privileged-access><strong>Phase 4: Secure Privileged Access</strong></a></h3> <p>Securing privileged access involves implementing controls to prevent unauthorized access. This could include limiting the number of privileged accounts, implementing least privilege, and using just-in-time access. For example:</p> <ul> <li>Limit the number of privileged accounts.</li> <li>Implement just-in-time access, where access is granted only for the duration of a task.</li> <li>Use session recording and monitoring for privileged access.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra ID Conditional Access</strong> to enforce controls on the access to apps in your environment based on specific conditions.</li> <li>Implement <strong>Microsoft Entra Privileged Identity Management</strong> for just-in-time access.</li> </ul> <h3 id=phase-5-least-privilege><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-5-least-privilege><strong>Phase 5: Least Privilege</strong></a></h3> <p>The principle of least privilege involves giving users the minimum levels of access — or permissions — they need to complete their job functions. By limiting the access rights of users, the risk of a security breach is reduced. For example:</p> <ul> <li>Implement role-based access control (RBAC) in Azure to grant the minimum necessary access to users.</li> <li>Regularly review user roles and access rights.</li> <li>Implement a process for revoking access when it's no longer needed.</li> </ul> <p>How to implement this:</p> <ul> <li>Implement <strong>Role-Based Access Control (RBAC)</strong> in Azure to grant the minimum necessary access to users.</li> <li>Use <strong>Microsoft Entra ID Access Reviews</strong> to efficiently manage group memberships, access to enterprise applications, and role assignments.</li> </ul> <h3 id=phase-6-control-all-applications><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-6-control-all-applications><strong>Phase 6: Control All Applications</strong></a></h3> <p>In this phase, we ensure that all applications, whether on-premises or in the cloud, are controlled and monitored. This includes implementing application control policies and monitoring application usage. For example:</p> <ul> <li>Implement application control policies that dictate what applications can be run on systems.</li> <li>Monitor application usage and block unauthorized applications.</li> <li>Regularly update and patch all applications to reduce vulnerabilities.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra Application Proxy</strong> to control and secure access to on-premises and cloud apps.</li> <li>Enable Change Tracking and Inventory in <strong>Azure Automation</strong> to track changes to your Azure VMs. Use desired state configuration to ensure that your VMs are configured correctly.</li> <li>Implement <strong>Microsoft Intune</strong> to manage and secure your devices and applications.</li> </ul> <h3 id=phase-7-detect-and-respond><a class=toclink href=2024/04/04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-7-detect-and-respond><strong>Phase 7: Detect and Respond</strong></a></h3> <p>The final phase involves setting up systems to detect and respond to any suspicious activity. This could involve setting up alerts for unusual activity, regularly auditing access logs, and having a response plan in place for when a breach occurs. For example:</p> <ul> <li>Set up alerts for unusual activity.</li> <li>Regularly audit access logs.</li> <li>Have a response plan in place for when a breach occurs, including steps for containment, eradication, and recovery.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Defender for Cloud</strong> for increased visibility into your security state and to detect and respond to threats.</li> <li>Implement <strong>Azure Sentinel</strong>, Microsoft's cloud-native SIEM solution, for intelligent security analytics.</li> </ul> <p>By following these seven phases, you can create a robust PAM strategy that protects your organization from security breaches and helps you maintain compliance with various regulations.</p> <p>Remember, a good PAM strategy is not a one-time effort but an ongoing process that needs to be regularly reviewed and updated. Microsoft and Azure services provide a robust set of tools to help you implement and manage your PAM strategy effectively.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-03-02 00:00:00">March 2, 2024</time></li> <li class=md-meta__item> in <a href=category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=azure-policy-management-best-practices><a href=2024/03/02/azure-policy-management-best-practices/ class=toclink>Azure Policy Management Best Practices</a></h2> <ol> <li> <p><strong>Version Control</strong>: Store your policy definitions in a version-controlled repository. This practice ensures that you can track changes, collaborate effectively, and roll back to previous versions if needed.</p> </li> <li> <p><strong>Automated Testing</strong>: Incorporate policy testing into your CI/CD pipelines. Automated tests can help you catch policy violations early in the development process, reducing the risk of non-compliance.</p> </li> <li> <p><strong>Policy Documentation</strong>: Document your policies clearly, including their purpose, scope, and expected behavior. This documentation helps stakeholders understand the policies and their impact on Azure resources.</p> </li> <li> <p><strong>Policy Assignment</strong>: Assign policies at the appropriate scope (e.g., Management Group, Subscription, Resource Group) based on your organizational requirements. Avoid assigning policies at a broader scope than necessary to prevent unintended consequences.</p> </li> <li> <p><strong>Policy Exemptions</strong>: Use policy exemptions judiciously. Document the reasons for exemptions and periodically review them to ensure they are still valid.</p> </li> <li> <p><strong>Policy Enforcement</strong>: Monitor policy compliance regularly and take corrective action for non-compliant resources. Use Azure Policy's built-in compliance reports and alerts to track policy violations.</p> </li> <li> <p><strong>Policy Remediation</strong>: Implement automated remediation tasks for policy violations where possible. Azure Policy's remediation tasks can help bring non-compliant resources back into compliance automatically.</p> </li> <li> <p><strong>Policy Monitoring</strong>: Continuously monitor policy effectiveness and adjust policies as needed. Regularly review policy violations, exemptions, and compliance trends to refine your policy implementation.</p> </li> <li> <p><strong>Policy Governance</strong>: Establish a governance framework for Azure Policy that includes policy creation, assignment, monitoring, and enforcement processes. Define roles and responsibilities for policy management to ensure accountability.</p> </li> <li> <p><strong>Policy Lifecycle Management</strong>: Define a policy lifecycle management process that covers policy creation, testing, deployment, monitoring, and retirement. Regularly review and update policies to align with changing organizational requirements.</p> </li> <li> <p><strong>Unique source of truth</strong>: Use EPAC, terraform, ARM,.... but use an unique source of truth for your policies.</p> </li> </ol> <p>By following these best practices, you can effectively manage Azure policies and ensure compliance with organizational standards across your Azure environment. Azure Policy plays a crucial role in maintaining governance, security, and compliance, and adopting these practices can help you maximize its benefits.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-29 00:00:00">February 29, 2024</time></li> <li class=md-meta__item> in <a href=category/tools/ class=md-meta__link>Tools</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=enterprise-azure-policy-as-code-epac><a href=2024/02/29/enterprise-azure-policy-as-code-epac/ class=toclink>Enterprise Azure Policy as Code (EPAC)</a></h2> <p>Enterprise Azure Policy as Code (EPAC) is a powerful tool that allows organizations to manage Azure Policies as code in a git repository². It's designed for medium and large organizations with a larger number of Policies, Policy Sets, and Assignments, and/or complex deployment scenarios¹.</p> <h3 id=key-features-of-epac><a class=toclink href=2024/02/29/enterprise-azure-policy-as-code-epac/#key-features-of-epac>Key Features of EPAC</a></h3> <ul> <li><strong>Single and multi-tenant policy deployment</strong>: EPAC supports both single and multi-tenant policy deployments, making it versatile for different organizational structures¹.</li> <li><strong>Easy CI/CD Integration</strong>: EPAC can be easily integrated with any CI/CD tool, which makes it a great fit for DevOps environments¹.</li> <li><strong>Operational scripts</strong>: EPAC includes operational scripts to simplify operational tasks¹.</li> <li><strong>Integration with Azure Landing Zones</strong>: EPAC provides a mature integration with Azure Landing Zones. Utilizing Azure Landing Zones together with EPAC is highly recommended¹.</li> </ul> <h3 id=who-should-use-epac><a class=toclink href=2024/02/29/enterprise-azure-policy-as-code-epac/#who-should-use-epac>Who Should Use EPAC?</a></h3> <p>EPAC is designed for medium and large organizations with a larger number of Policies, Policy Sets, and Assignments, and/or complex deployment scenarios¹. However, smaller organizations implementing fully-automated DevOps deployments of every Azure resource (known as Infrastructure as Code) can also benefit from EPAC¹.</p> <h3 id=how-does-epac-work><a class=toclink href=2024/02/29/enterprise-azure-policy-as-code-epac/#how-does-epac-work>How Does EPAC Work?</a></h3> <p>EPAC works by deploying all policies and policy assignments defined in the EPAC repository to the deploymentRootScope and its children. It takes possession of all Policy Resources at the deploymentRootScope and its children.</p> <p><img alt="Alt text" src=2024/image-2.png></p> <p>The process depicted in the image involves three key scripts that manage a deployment sequence. Here's a breakdown of the process:</p> <ol> <li> <p><strong>Definition Files</strong>: The process begins with various definition files in JSON, CSV, or XLSX formats. These files contain policy definitions, policy set (initiative) definitions, assignments, exemptions, and global settings.</p> </li> <li> <p><strong>Planning Script</strong>: The <code>Build-DeploymentPlans.ps1</code> script uses these definition files to create a deployment plan. This script requires Resource Policy Reader privileges.</p> </li> <li> <p><strong>Deployment Scripts</strong>: The deployment plan is then used by two deployment scripts:</p> </li> <li><code>Deploy-PolicyPlan.ps1</code>: This script deploys Policy resources using the <code>policy-plan.json</code> file from the deployment plan. It requires Resource Policy Contributor privileges.</li> <li><code>Deploy-RolesPlan.ps1</code>: This script deploys Role Assignments using the <code>roles-plan.json</code> file from the deployment plan. It requires User Access Administrator privileges.</li> </ol> <p>The process includes optional approval gates after each deployment step. These are typically used in production environments to ensure each deployment step is reviewed and approved before moving to the next.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>EPAC is a true desired state deployment technology. It takes possession of all Policy Resources at the deploymentRootScope and its children. It will delete any Policy resources not defined in the EPAC repo.</p> </div> <h3 id=conclusion><a class=toclink href=2024/02/29/enterprise-azure-policy-as-code-epac/#conclusion>Conclusion</a></h3> <p>EPAC is a robust solution for managing Azure Policies as code. It offers a high level of assurance in highly controlled and sensitive environments, and a means for the development, deployment, management, and reporting of Azure policy at scale. </p> <h3 id=references><a class=toclink href=2024/02/29/enterprise-azure-policy-as-code-epac/#references>References</a></h3> <ul> <li><a href=https://github.com/Azure/enterprise-azure-policy-as-code>EPAC Documentation</a></li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-28 00:00:00">February 28, 2024</time></li> <li class=md-meta__item> in <a href=category/tools/ class=md-meta__link>Tools</a></li> <li class=md-meta__item> 5 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=manage-azure-policy-github-action><a href=2024/02/28/manage-azure-policy-github-action/ class=toclink>Manage Azure Policy GitHub Action</a></h2> <p>It's recommended to review:</p> <ul> <li><a href=2024/02/24/azure-policy/ >Azure Policy</a></li> <li><a href=2024/02/26/writing-your-first-policy-in-azure-with-portal/ >Writing Your First Policy in Azure with Portal</a></li> <li><a href=2024/02/25/writing-your-first-initiative-with-portal/ >Writing Your First Initiative in Azure with Portal</a></li> </ul> <h3 id=overview><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#overview>Overview</a></h3> <p>The <strong>Manage Azure Policy</strong> GitHub Action empowers you to enforce organizational standards and assess compliance at scale using Azure policies. With this action, you can seamlessly integrate policy management into your CI/CD pipelines, ensuring that your Azure resources adhere to the desired policies.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>This project does not have received any updates since some time, but it is still a simple option to develop your Azure Policies. As everything cannot be good to say that this deployment method has a major drawback, deletions must be done by hand :S</p> </div> <h3 id=key-features><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#key-features>Key Features</a></h3> <ol> <li> <p><strong>Customizable Workflows</strong>: GitHub workflows are highly customizable. You have complete control over the sequence in which Azure policies are rolled out. This flexibility enables you to follow safe deployment practices and catch regressions or bugs well before policies are applied to critical resources.</p> </li> <li> <p><strong>Azure Login Integration</strong>: The action assumes that you've already authenticated using the <strong>Azure Login</strong> action. Make sure you've logged in using an Azure service principal with sufficient permissions to write policies on selected scopes. Refer to the <a href=https://github.com/MicrosoftDocs/azure-docs/blob/main/articles/cost-management-billing/manage/ea-azure-marketplace.md>full documentation of Azure Login Action</a> for details on permissions.</p> </li> <li> <p><strong>Policy File Structure</strong>: Your policy files should be organized in a specific directory structure within your GitHub repository. Here's how it should look:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>|- policies/
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a>   |- &lt;policy1_name&gt;/
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a>      |- policy.json
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a>      |- assign.&lt;name1&gt;.json
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a>      |- assign.&lt;name2&gt;.json
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a>      ...
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a>   |- &lt;policy2_name&gt;/
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a>      |- policy.json
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a>      |- assign.&lt;name1&gt;.json
</span><span id=__span-0-10><a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a>      |- assign.&lt;name2&gt;.json
</span><span id=__span-0-11><a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a>      ...
</span></code></pre></div> <ul> <li>Each policy resides in a subfolder under the <code>policies/</code> directory.</li> <li>The <code>policy.json</code> file contains the policy definition.</li> <li>Assignment files (e.g., <code>assign.&lt;name1&gt;.json</code>) specify how the policy is applied.</li> </ul> </li> <li> <p><strong>Inputs for the Action</strong>:</p> <ul> <li><strong>Paths</strong>: Specify the mandatory path(s) to the directory containing your Azure policy files.</li> </ul> </li> </ol> <h3 id=sample-workflow><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#sample-workflow>Sample Workflow</a></h3> <p>Here's an example of how you can apply policies at the Management Group scope using the <strong>Manage Azure Policy</strong> action:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>'Test</span><span class=nv> </span><span class=s>Policy'</span>
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span>
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"*"</span><span class=w> </span>
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w> </span>
</span><span id=__span-1-7><a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>     </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'policies/**'</span>
</span><span id=__span-1-8><a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>     </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'initiatives/**'</span>
</span><span id=__span-1-9><a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span>
</span><span id=__span-1-10><a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a>
</span><span id=__span-1-11><a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-1-12><a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>  </span><span class=nt>apply-azure-policy</span><span class=p>:</span><span class=w>    </span>
</span><span id=__span-1-13><a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-1-14><a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-1-15><a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>    </span><span class=c1># Azure Login</span>
</span><span id=__span-1-16><a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Login to Azure</span>
</span><span id=__span-1-17><a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure/login@v1</span>
</span><span id=__span-1-18><a href=#__codelineno-1-18 id=__codelineno-1-18 name=__codelineno-1-18></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-1-19><a href=#__codelineno-1-19 id=__codelineno-1-19 name=__codelineno-1-19></a><span class=w>        </span><span class=nt>creds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AZURE_CREDENTIALS }}</span>
</span><span id=__span-1-20><a href=#__codelineno-1-20 id=__codelineno-1-20 name=__codelineno-1-20></a><span class=w>        </span><span class=nt>allow-no-subscriptions</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-21><a href=#__codelineno-1-21 id=__codelineno-1-21 name=__codelineno-1-21></a>
</span><span id=__span-1-22><a href=#__codelineno-1-22 id=__codelineno-1-22 name=__codelineno-1-22></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
</span><span id=__span-1-23><a href=#__codelineno-1-23 id=__codelineno-1-23 name=__codelineno-1-23></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class=w> </span>
</span><span id=__span-1-24><a href=#__codelineno-1-24 id=__codelineno-1-24 name=__codelineno-1-24></a>
</span><span id=__span-1-25><a href=#__codelineno-1-25 id=__codelineno-1-25 name=__codelineno-1-25></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Create or Update Azure Policies</span>
</span><span id=__span-1-26><a href=#__codelineno-1-26 id=__codelineno-1-26 name=__codelineno-1-26></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure/manage-azure-policy@v0</span>
</span><span id=__span-1-27><a href=#__codelineno-1-27 id=__codelineno-1-27 name=__codelineno-1-27></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>      </span>
</span><span id=__span-1-28><a href=#__codelineno-1-28 id=__codelineno-1-28 name=__codelineno-1-28></a><span class=w>        </span><span class=nt>paths</span><span class=p>:</span><span class=w>  </span><span class="p p-Indicator">|</span><span class=w>                </span>
</span><span id=__span-1-29><a href=#__codelineno-1-29 id=__codelineno-1-29 name=__codelineno-1-29></a><span class=w>          </span><span class=no>policies/**</span>
</span><span id=__span-1-30><a href=#__codelineno-1-30 id=__codelineno-1-30 name=__codelineno-1-30></a><span class=w>          </span><span class=no>initiatives/**</span>
</span><span id=__span-1-31><a href=#__codelineno-1-31 id=__codelineno-1-31 name=__codelineno-1-31></a><span class=w>        </span><span class=nt>assignments</span><span class=p>:</span><span class=w>  </span><span class="p p-Indicator">|</span>
</span><span id=__span-1-32><a href=#__codelineno-1-32 id=__codelineno-1-32 name=__codelineno-1-32></a><span class=w>          </span><span class=no>assign.*_testRG_*.json</span>
</span></code></pre></div> <p>Remember to replace the placeholder values (such as <code>secrets.AZURE_CREDENTIALS</code>) with your actual configuration.</p> <h3 id=example-of-use-for-policy><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#example-of-use-for-policy>Example of use for Policy</a></h3> <p>In this example we define all our policies and initiatives at root management group level and assign to resource group, and we have a policy that requires a specific tag and its value.</p> <p>You need to create a folder structure like this:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>|- policies/
</span><span id=__span-2-2><a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>   |- require-tag-and-its-value/
</span><span id=__span-2-3><a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>      |- policy.json
</span><span id=__span-2-4><a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a>      |- assign.testRG_testazurepolicy.json
</span><span id=__span-2-5><a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a>|- initiatives/
</span><span id=__span-2-6><a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>   |- initiative1/
</span><span id=__span-2-7><a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>      |- policyset.json
</span><span id=__span-2-8><a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a>      |- assign.testRG_testazurepolicy.json
</span></code></pre></div> <h4 id=policies><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#policies>policies</a></h4> <div class="admonition info"> <p class=admonition-title>Info</p> <ul> <li>The <code>policy.json</code> file contains the policy definition, and the <code>assign.&lt;name&gt;.json</code> file specifies how the policy is applied. </li> </ul> </div> <h5 id=policyjson><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#policyjson>policy.json</a></h5> <div class="admonition info"> <p class=admonition-title>Info</p> <ul> <li>The <code>id</code> value specifies where you are going to define the policy.</li> </ul> </div> <div class="language-json highlight"><span class=filename>policy.json</span><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=p>{</span>
</span><span id=__span-3-2><a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"/providers/Microsoft.Management/managementGroups/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/requite-tag-and-its-value"</span><span class=p>,</span>
</span><span id=__span-3-3><a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"Microsoft.Authorization/policyDefinitions"</span><span class=p>,</span>
</span><span id=__span-3-4><a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>    </span><span class=nt>"name"</span><span class=p>:</span><span class=w> </span><span class=s2>"requite-tag-and-its-value"</span><span class=p>,</span>
</span><span id=__span-3-5><a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-6><a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Require a tag and its value"</span><span class=p>,</span>
</span><span id=__span-3-7><a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>        </span><span class=nt>"policyType"</span><span class=p>:</span><span class=w> </span><span class=s2>"Custom"</span><span class=p>,</span>
</span><span id=__span-3-8><a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Indexed"</span><span class=p>,</span>
</span><span id=__span-3-9><a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This policy requires a specific tag and its value."</span><span class=p>,</span>
</span><span id=__span-3-10><a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>        </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-11><a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>            </span><span class=nt>"category"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tags"</span>
</span><span id=__span-3-12><a href=#__codelineno-3-12 id=__codelineno-3-12 name=__codelineno-3-12></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-13><a href=#__codelineno-3-13 id=__codelineno-3-13 name=__codelineno-3-13></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-14><a href=#__codelineno-3-14 id=__codelineno-3-14 name=__codelineno-3-14></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-15><a href=#__codelineno-3-15 id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-3-16><a href=#__codelineno-3-16 id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-17><a href=#__codelineno-3-17 id=__codelineno-3-17 name=__codelineno-3-17></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Name"</span><span class=p>,</span>
</span><span id=__span-3-18><a href=#__codelineno-3-18 id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Name of the tag, such as 'environment'"</span>
</span><span id=__span-3-19><a href=#__codelineno-3-19 id=__codelineno-3-19 name=__codelineno-3-19></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-3-20><a href=#__codelineno-3-20 id=__codelineno-3-20 name=__codelineno-3-20></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-3-21><a href=#__codelineno-3-21 id=__codelineno-3-21 name=__codelineno-3-21></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-22><a href=#__codelineno-3-22 id=__codelineno-3-22 name=__codelineno-3-22></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-3-23><a href=#__codelineno-3-23 id=__codelineno-3-23 name=__codelineno-3-23></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-24><a href=#__codelineno-3-24 id=__codelineno-3-24 name=__codelineno-3-24></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Value"</span><span class=p>,</span>
</span><span id=__span-3-25><a href=#__codelineno-3-25 id=__codelineno-3-25 name=__codelineno-3-25></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Value of the tag, such as 'production'"</span>
</span><span id=__span-3-26><a href=#__codelineno-3-26 id=__codelineno-3-26 name=__codelineno-3-26></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-3-27><a href=#__codelineno-3-27 id=__codelineno-3-27 name=__codelineno-3-27></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-3-28><a href=#__codelineno-3-28 id=__codelineno-3-28 name=__codelineno-3-28></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-29><a href=#__codelineno-3-29 id=__codelineno-3-29 name=__codelineno-3-29></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-30><a href=#__codelineno-3-30 id=__codelineno-3-30 name=__codelineno-3-30></a><span class=w>        </span><span class=nt>"policyRule"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-31><a href=#__codelineno-3-31 id=__codelineno-3-31 name=__codelineno-3-31></a><span class=w>            </span><span class=nt>"if"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-32><a href=#__codelineno-3-32 id=__codelineno-3-32 name=__codelineno-3-32></a><span class=w>                </span><span class=nt>"not"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-33><a href=#__codelineno-3-33 id=__codelineno-3-33 name=__codelineno-3-33></a><span class=w>                    </span><span class=nt>"field"</span><span class=p>:</span><span class=w> </span><span class=s2>"[concat('tags[', parameters('tagName'), ']')]"</span><span class=p>,</span>
</span><span id=__span-3-34><a href=#__codelineno-3-34 id=__codelineno-3-34 name=__codelineno-3-34></a><span class=w>                    </span><span class=nt>"equals"</span><span class=p>:</span><span class=w> </span><span class=s2>"[parameters('tagValue')]"</span>
</span><span id=__span-3-35><a href=#__codelineno-3-35 id=__codelineno-3-35 name=__codelineno-3-35></a><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-3-36><a href=#__codelineno-3-36 id=__codelineno-3-36 name=__codelineno-3-36></a><span class=w>                </span><span class=p>},</span>
</span><span id=__span-3-37><a href=#__codelineno-3-37 id=__codelineno-3-37 name=__codelineno-3-37></a><span class=w>            </span><span class=nt>"then"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-38><a href=#__codelineno-3-38 id=__codelineno-3-38 name=__codelineno-3-38></a><span class=w>                </span><span class=nt>"effect"</span><span class=p>:</span><span class=w> </span><span class=s2>"deny"</span>
</span><span id=__span-3-39><a href=#__codelineno-3-39 id=__codelineno-3-39 name=__codelineno-3-39></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-3-40><a href=#__codelineno-3-40 id=__codelineno-3-40 name=__codelineno-3-40></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-41><a href=#__codelineno-3-41 id=__codelineno-3-41 name=__codelineno-3-41></a><span class=w>    </span><span class=p>}</span>
</span></code></pre></div> <h5 id=assigntestrg_testazurepolicyjson><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#assigntestrg_testazurepolicyjson>assign.testRG_testazurepolicy.json</a></h5> <div class="admonition info"> <p class=admonition-title>Info</p> <ul> <li>Change the <code>id</code> and <code>scope</code> values in the <code>assign.&lt;name&gt;.json</code> file to match your Azure subscription and resource group.</li> <li>id specifies where you are going to deploy the assignment.</li> <li>id and name are related, name can not be any value, it should be the same as the last part of the id. You can generete a new GUID and use it as name with (1..24 | %{ '{0:x}' -f (Get-Random -Max 16) }) -join ''</li> <li>name and id are related.</li> <li>The <code>policyDefinitionId</code> value should match the <code>id</code> value in the <code>policy.json</code> file.</li> </ul> </div> <div class="language-json highlight"><span class=filename>assign.testRG_testazurepolicy.json</span><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=p>{</span>
</span><span id=__span-4-2><a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg-testazurepolicy/providers/Microsoft.Authorization/policyAssignments/599a2c3a1a3b1f8b8e547b3e"</span><span class=p>,</span>
</span><span id=__span-4-3><a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=w>    </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"Microsoft.Authorization/policyAssignments"</span><span class=p>,</span>
</span><span id=__span-4-4><a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>    </span><span class=nt>"name"</span><span class=p>:</span><span class=w> </span><span class=s2>"599a2c3a1a3b1f8b8e547b3e"</span><span class=p>,</span><span class=w>     </span>
</span><span id=__span-4-5><a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-6><a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This policy audits the presence of a specific tag and its value."</span><span class=p>,</span>
</span><span id=__span-4-7><a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Require a tag and its value"</span><span class=p>,</span>
</span><span id=__span-4-8><a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-9><a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-10><a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>              </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"environment"</span>
</span><span id=__span-4-11><a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-4-12><a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-13><a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>              </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"production"</span>
</span><span id=__span-4-14><a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-4-15><a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a><span class=w>          </span><span class=p>},</span>
</span><span id=__span-4-16><a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=w>          </span><span class=nt>"nonComplianceMessages"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-4-17><a href=#__codelineno-4-17 id=__codelineno-4-17 name=__codelineno-4-17></a><span class=w>            </span><span class=p>{</span>
</span><span id=__span-4-18><a href=#__codelineno-4-18 id=__codelineno-4-18 name=__codelineno-4-18></a><span class=w>              </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=s2>"This resource is not compliant with the policy. Please apply the required tag and its value."</span>
</span><span id=__span-4-19><a href=#__codelineno-4-19 id=__codelineno-4-19 name=__codelineno-4-19></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-4-20><a href=#__codelineno-4-20 id=__codelineno-4-20 name=__codelineno-4-20></a><span class=w>          </span><span class=p>],</span>
</span><span id=__span-4-21><a href=#__codelineno-4-21 id=__codelineno-4-21 name=__codelineno-4-21></a><span class=w>          </span><span class=nt>"enforcementMode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Default"</span><span class=p>,</span>
</span><span id=__span-4-22><a href=#__codelineno-4-22 id=__codelineno-4-22 name=__codelineno-4-22></a><span class=w>          </span><span class=nt>"policyDefinitionId"</span><span class=p>:</span><span class=w> </span><span class=s2>"/providers/Microsoft.Management/managementGroups/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/requite-tag-and-its-value"</span><span class=p>,</span>
</span><span id=__span-4-23><a href=#__codelineno-4-23 id=__codelineno-4-23 name=__codelineno-4-23></a><span class=w>          </span><span class=nt>"scope"</span><span class=p>:</span><span class=w> </span><span class=s2>"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg-testazurepolicy"</span>
</span><span id=__span-4-24><a href=#__codelineno-4-24 id=__codelineno-4-24 name=__codelineno-4-24></a><span class=w>    </span><span class=p>}</span><span class=w>    </span>
</span><span id=__span-4-25><a href=#__codelineno-4-25 id=__codelineno-4-25 name=__codelineno-4-25></a><span class=p>}</span>
</span></code></pre></div> <h4 id=initiatives><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#initiatives>initiatives</a></h4> <div class="admonition info"> <p class=admonition-title>Info</p> <ul> <li>The <code>policyset.json</code> file contains the policy definition, and the <code>assign.&lt;name&gt;.json</code> file specifies how the initiative is applied.</li> </ul> </div> <h5 id=policysetjson><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#policysetjson>policyset.json</a></h5> <div class="admonition info"> <p class=admonition-title>Info</p> <ul> <li>The <code>id</code> value specifies where you are going to define the initiative.</li> <li>The <code>policyDefinitions</code> array contains the policy definitions that are part of the initiative.</li> <li>The <code>parameters</code> object defines the parameters that can be passed to the policies within the initiative.</li> <li>The <code>policyDefinitionId</code> value should match the <code>id</code> value in the <code>policy.json</code> file of the policy.</li> </ul> </div> <div class="language-json highlight"><span class=filename>policyset.json</span><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=p>{</span>
</span><span id=__span-5-2><a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"/providers/Microsoft.Management/managementGroups/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policySetDefinitions/initiative1"</span><span class=p>,</span>
</span><span id=__span-5-3><a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>    </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"Microsoft.Authorization/policySetDefinitions"</span><span class=p>,</span>
</span><span id=__span-5-4><a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>    </span><span class=nt>"name"</span><span class=p>:</span><span class=w> </span><span class=s2>"initiative1"</span><span class=p>,</span>
</span><span id=__span-5-5><a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-6><a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Initiative 1"</span><span class=p>,</span>
</span><span id=__span-5-7><a href=#__codelineno-5-7 id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This initiative contains a set of policies for testing."</span><span class=p>,</span>
</span><span id=__span-5-8><a href=#__codelineno-5-8 id=__codelineno-5-8 name=__codelineno-5-8></a><span class=w>        </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-9><a href=#__codelineno-5-9 id=__codelineno-5-9 name=__codelineno-5-9></a><span class=w>            </span><span class=nt>"category"</span><span class=p>:</span><span class=w> </span><span class=s2>"Test"</span>
</span><span id=__span-5-10><a href=#__codelineno-5-10 id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-5-11><a href=#__codelineno-5-11 id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-12><a href=#__codelineno-5-12 id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-13><a href=#__codelineno-5-13 id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-5-14><a href=#__codelineno-5-14 id=__codelineno-5-14 name=__codelineno-5-14></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-15><a href=#__codelineno-5-15 id=__codelineno-5-15 name=__codelineno-5-15></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Name"</span><span class=p>,</span>
</span><span id=__span-5-16><a href=#__codelineno-5-16 id=__codelineno-5-16 name=__codelineno-5-16></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Name of the tag, such as 'environment'"</span>
</span><span id=__span-5-17><a href=#__codelineno-5-17 id=__codelineno-5-17 name=__codelineno-5-17></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-5-18><a href=#__codelineno-5-18 id=__codelineno-5-18 name=__codelineno-5-18></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-5-19><a href=#__codelineno-5-19 id=__codelineno-5-19 name=__codelineno-5-19></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-20><a href=#__codelineno-5-20 id=__codelineno-5-20 name=__codelineno-5-20></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-5-21><a href=#__codelineno-5-21 id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-22><a href=#__codelineno-5-22 id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Value"</span><span class=p>,</span>
</span><span id=__span-5-23><a href=#__codelineno-5-23 id=__codelineno-5-23 name=__codelineno-5-23></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Value of the tag, such as 'production'"</span>
</span><span id=__span-5-24><a href=#__codelineno-5-24 id=__codelineno-5-24 name=__codelineno-5-24></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-5-25><a href=#__codelineno-5-25 id=__codelineno-5-25 name=__codelineno-5-25></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-5-26><a href=#__codelineno-5-26 id=__codelineno-5-26 name=__codelineno-5-26></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-5-27><a href=#__codelineno-5-27 id=__codelineno-5-27 name=__codelineno-5-27></a><span class=w>        </span><span class=nt>"policyDefinitions"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-5-28><a href=#__codelineno-5-28 id=__codelineno-5-28 name=__codelineno-5-28></a><span class=w>            </span><span class=p>{</span>
</span><span id=__span-5-29><a href=#__codelineno-5-29 id=__codelineno-5-29 name=__codelineno-5-29></a><span class=w>                </span><span class=nt>"policyDefinitionId"</span><span class=p>:</span><span class=w> </span><span class=s2>"/providers/Microsoft.Management/managementGroups/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/requite-tag-and-its-value"</span><span class=p>,</span>
</span><span id=__span-5-30><a href=#__codelineno-5-30 id=__codelineno-5-30 name=__codelineno-5-30></a><span class=w>                </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-31><a href=#__codelineno-5-31 id=__codelineno-5-31 name=__codelineno-5-31></a><span class=w>                    </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-32><a href=#__codelineno-5-32 id=__codelineno-5-32 name=__codelineno-5-32></a><span class=w>                        </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"[parameters('tagName')]"</span>
</span><span id=__span-5-33><a href=#__codelineno-5-33 id=__codelineno-5-33 name=__codelineno-5-33></a><span class=w>                    </span><span class=p>},</span>
</span><span id=__span-5-34><a href=#__codelineno-5-34 id=__codelineno-5-34 name=__codelineno-5-34></a><span class=w>                    </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-35><a href=#__codelineno-5-35 id=__codelineno-5-35 name=__codelineno-5-35></a><span class=w>                        </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"[parameters('tagValue')]"</span>
</span><span id=__span-5-36><a href=#__codelineno-5-36 id=__codelineno-5-36 name=__codelineno-5-36></a><span class=w>                    </span><span class=p>},</span>
</span><span id=__span-5-37><a href=#__codelineno-5-37 id=__codelineno-5-37 name=__codelineno-5-37></a><span class=w>                    </span><span class=nt>"effect"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-38><a href=#__codelineno-5-38 id=__codelineno-5-38 name=__codelineno-5-38></a><span class=w>                        </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"Deny"</span>
</span><span id=__span-5-39><a href=#__codelineno-5-39 id=__codelineno-5-39 name=__codelineno-5-39></a><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-5-40><a href=#__codelineno-5-40 id=__codelineno-5-40 name=__codelineno-5-40></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-5-41><a href=#__codelineno-5-41 id=__codelineno-5-41 name=__codelineno-5-41></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-5-42><a href=#__codelineno-5-42 id=__codelineno-5-42 name=__codelineno-5-42></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-5-43><a href=#__codelineno-5-43 id=__codelineno-5-43 name=__codelineno-5-43></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-44><a href=#__codelineno-5-44 id=__codelineno-5-44 name=__codelineno-5-44></a><span class=p>}</span>
</span></code></pre></div> <h5 id=assigntestrg_testazurepolicysetjson><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#assigntestrg_testazurepolicysetjson>assign.testRG_testazurepolicyset.json</a></h5> <div class="language-json highlight"><span class=filename>assign.testRG_testazurepolicyset.json</span><pre><span></span><code><span id=__span-6-1><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=p>{</span>
</span><span id=__span-6-2><a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg-testazurepolicy/providers/Microsoft.Authorization/policyAssignments/ada0f4a34b09cf6ad704cc62"</span><span class=p>,</span>
</span><span id=__span-6-3><a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=w>    </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"Microsoft.Authorization/policyAssignments"</span><span class=p>,</span>
</span><span id=__span-6-4><a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a><span class=w>    </span><span class=nt>"name"</span><span class=p>:</span><span class=w> </span><span class=s2>"ada0f4a34b09cf6ad704cc62"</span><span class=p>,</span><span class=w>     </span>
</span><span id=__span-6-5><a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-6><a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This initiative audits the presence of a specific tag and its value."</span><span class=p>,</span>
</span><span id=__span-6-7><a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Require a tag and its value"</span><span class=p>,</span>
</span><span id=__span-6-8><a href=#__codelineno-6-8 id=__codelineno-6-8 name=__codelineno-6-8></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-9><a href=#__codelineno-6-9 id=__codelineno-6-9 name=__codelineno-6-9></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-10><a href=#__codelineno-6-10 id=__codelineno-6-10 name=__codelineno-6-10></a><span class=w>              </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"environment"</span>
</span><span id=__span-6-11><a href=#__codelineno-6-11 id=__codelineno-6-11 name=__codelineno-6-11></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-6-12><a href=#__codelineno-6-12 id=__codelineno-6-12 name=__codelineno-6-12></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><a href=#__codelineno-6-13 id=__codelineno-6-13 name=__codelineno-6-13></a><span class=w>              </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"production"</span>
</span><span id=__span-6-14><a href=#__codelineno-6-14 id=__codelineno-6-14 name=__codelineno-6-14></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-6-15><a href=#__codelineno-6-15 id=__codelineno-6-15 name=__codelineno-6-15></a><span class=w>          </span><span class=p>},</span>
</span><span id=__span-6-16><a href=#__codelineno-6-16 id=__codelineno-6-16 name=__codelineno-6-16></a><span class=w>          </span><span class=nt>"nonComplianceMessages"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-6-17><a href=#__codelineno-6-17 id=__codelineno-6-17 name=__codelineno-6-17></a><span class=w>            </span><span class=p>{</span>
</span><span id=__span-6-18><a href=#__codelineno-6-18 id=__codelineno-6-18 name=__codelineno-6-18></a><span class=w>              </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=s2>"This resource is not compliant with the policy. Please apply the required tag and its value."</span>
</span><span id=__span-6-19><a href=#__codelineno-6-19 id=__codelineno-6-19 name=__codelineno-6-19></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-6-20><a href=#__codelineno-6-20 id=__codelineno-6-20 name=__codelineno-6-20></a><span class=w>          </span><span class=p>],</span>
</span><span id=__span-6-21><a href=#__codelineno-6-21 id=__codelineno-6-21 name=__codelineno-6-21></a><span class=w>          </span><span class=nt>"enforcementMode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Default"</span><span class=p>,</span>
</span><span id=__span-6-22><a href=#__codelineno-6-22 id=__codelineno-6-22 name=__codelineno-6-22></a><span class=w>          </span><span class=nt>"policyDefinitionId"</span><span class=p>:</span><span class=w> </span><span class=s2>"/providers/Microsoft.Management/managementGroups/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policySetDefinitions/requite-tag-and-its-value"</span><span class=p>,</span>
</span><span id=__span-6-23><a href=#__codelineno-6-23 id=__codelineno-6-23 name=__codelineno-6-23></a><span class=w>          </span><span class=nt>"scope"</span><span class=p>:</span><span class=w> </span><span class=s2>"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg-testazurepolicy"</span>
</span><span id=__span-6-24><a href=#__codelineno-6-24 id=__codelineno-6-24 name=__codelineno-6-24></a><span class=w>    </span><span class=p>}</span><span class=w>    </span>
</span><span id=__span-6-25><a href=#__codelineno-6-25 id=__codelineno-6-25 name=__codelineno-6-25></a><span class=p>}</span>
</span></code></pre></div> <h3 id=conclusion><a class=toclink href=2024/02/28/manage-azure-policy-github-action/#conclusion>Conclusion</a></h3> <p>By incorporating the <strong>Manage Azure Policy</strong> action into your GitHub workflows, you can seamlessly enforce policies, maintain compliance, and ensure the robustness of your Azure resources, although it has its drawbacks, it is one more step compared to a portal. Later we will see the deployment with a more robust tool: EPAC</p> <p>Learn more about <a href=https://docs.microsoft.com/en-us/azure/governance/policy/overview>Azure Policies</a> and explore the action on the <a href=https://github.com/marketplace/actions/manage-azure-policy>GitHub Marketplace</a>.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-26 00:00:00">February 26, 2024</time></li> <li class=md-meta__item> in <a href=category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 3 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=writing-your-first-policy-in-azure-with-portal><a href=2024/02/26/writing-your-first-policy-in-azure-with-portal/ class=toclink>Writing Your First Policy in Azure with Portal</a></h2> <p>Azure Policy is a service in Azure that you use to create, assign and manage policies. These policies enforce different rules and effects over your resources, so those resources stay compliant with your corporate standards and service level agreements.</p> <p>In this post, we'll walk through the steps of creating your first policy in Azure.</p> <h3 id=prerequisites><a class=toclink href=2024/02/26/writing-your-first-policy-in-azure-with-portal/#prerequisites>Prerequisites</a></h3> <ol> <li>An active Azure subscription.</li> <li>Access to Azure portal.</li> </ol> <h3 id=step-1-open-azure-policy><a class=toclink href=2024/02/26/writing-your-first-policy-in-azure-with-portal/#step-1-open-azure-policy>Step 1: Open Azure Policy</a></h3> <ul> <li>Login to the <a href=https://portal.azure.com/ >Azure Portal</a>.</li> <li>In the left-hand menu, click on <code>All services</code>.</li> <li>In the <code>All services</code> blade, search for <code>Policy</code>.</li> </ul> <h3 id=step-2-create-a-new-policy-definition><a class=toclink href=2024/02/26/writing-your-first-policy-in-azure-with-portal/#step-2-create-a-new-policy-definition>Step 2: Create a New Policy Definition</a></h3> <ul> <li>Click on <code>Definitions</code> under the <code>Authoring</code> section.</li> <li>Click on <code>+ Policy definition</code>.</li> </ul> <h3 id=step-3-fill-out-the-policy-definition><a class=toclink href=2024/02/26/writing-your-first-policy-in-azure-with-portal/#step-3-fill-out-the-policy-definition>Step 3: Fill Out the Policy Definition</a></h3> <p>You will need to fill out several fields:</p> <ul> <li><strong>Definition location</strong>: The location where the policy is stored.</li> <li><strong>Name</strong>: This is a unique name for your policy.</li> <li><strong>Description</strong>: A detailed description of what the policy does.</li> <li><strong>Category</strong>: You can categorize your policy for easier searching and filtering.</li> </ul> <p>The most important part of the policy definition is the policy rule itself. The policy rule is where you describe the logic that enforces the policy. </p> <p>Here's an example of a simple policy rule that ensures all indexed resources have tags and deny creation or update if they do not.</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=p>{</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Require a tag and its value"</span><span class=p>,</span>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>        </span><span class=nt>"policyType"</span><span class=p>:</span><span class=w> </span><span class=s2>"Custom"</span><span class=p>,</span>
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Indexed"</span><span class=p>,</span>
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This policy requires a specific tag and its value."</span><span class=p>,</span>
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>        </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>            </span><span class=nt>"category"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tags"</span>
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-10><a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-11><a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-12><a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-0-13><a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-14><a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Name"</span><span class=p>,</span>
</span><span id=__span-0-15><a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Name of the tag, such as 'environment'"</span>
</span><span id=__span-0-16><a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-0-17><a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-0-18><a href=#__codelineno-0-18 id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-19><a href=#__codelineno-0-19 id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-0-20><a href=#__codelineno-0-20 id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-21><a href=#__codelineno-0-21 id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Value"</span><span class=p>,</span>
</span><span id=__span-0-22><a href=#__codelineno-0-22 id=__codelineno-0-22 name=__codelineno-0-22></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Value of the tag, such as 'production'"</span>
</span><span id=__span-0-23><a href=#__codelineno-0-23 id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-0-24><a href=#__codelineno-0-24 id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-0-25><a href=#__codelineno-0-25 id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-26><a href=#__codelineno-0-26 id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-27><a href=#__codelineno-0-27 id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>        </span><span class=nt>"policyRule"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-28><a href=#__codelineno-0-28 id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>            </span><span class=nt>"if"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-29><a href=#__codelineno-0-29 id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>                </span><span class=nt>"not"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-30><a href=#__codelineno-0-30 id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>                    </span><span class=nt>"field"</span><span class=p>:</span><span class=w> </span><span class=s2>"[concat('tags[', parameters('tagName'), ']')]"</span><span class=p>,</span>
</span><span id=__span-0-31><a href=#__codelineno-0-31 id=__codelineno-0-31 name=__codelineno-0-31></a><span class=w>                    </span><span class=nt>"equals"</span><span class=p>:</span><span class=w> </span><span class=s2>"[parameters('tagValue')]"</span>
</span><span id=__span-0-32><a href=#__codelineno-0-32 id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-0-33><a href=#__codelineno-0-33 id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>                </span><span class=p>},</span>
</span><span id=__span-0-34><a href=#__codelineno-0-34 id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>            </span><span class=nt>"then"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-35><a href=#__codelineno-0-35 id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>                </span><span class=nt>"effect"</span><span class=p>:</span><span class=w> </span><span class=s2>"deny"</span>
</span><span id=__span-0-36><a href=#__codelineno-0-36 id=__codelineno-0-36 name=__codelineno-0-36></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-0-37><a href=#__codelineno-0-37 id=__codelineno-0-37 name=__codelineno-0-37></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-0-38><a href=#__codelineno-0-38 id=__codelineno-0-38 name=__codelineno-0-38></a><span class=w>    </span><span class=p>}</span>
</span></code></pre></div> <p>But, in portal, you can add properties directly in the form but you can't add displayName, policyType and metadata because they are added by portal itself, so you can add only mode,parameters and policyRule, Policy definition could be like this:</p> <ul> <li>Definition location: <code>Tenant Root Group</code></li> <li>Name: <code>Require a tag and its value</code></li> <li>Description: <code>This policy requires a specific tag and its value.</code></li> <li>Category: <code>Tags</code></li> <li>POLICY RULE:</li> </ul> <div class="language-json highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=p>{</span>
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Indexed"</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-1-7><a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-8><a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Name"</span><span class=p>,</span>
</span><span id=__span-1-9><a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Name of the tag, such as 'environment'"</span>
</span><span id=__span-1-10><a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-1-11><a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-1-12><a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-13><a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-1-14><a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-15><a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Value"</span><span class=p>,</span>
</span><span id=__span-1-16><a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Value of the tag, such as 'production'"</span>
</span><span id=__span-1-17><a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-1-18><a href=#__codelineno-1-18 id=__codelineno-1-18 name=__codelineno-1-18></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-1-19><a href=#__codelineno-1-19 id=__codelineno-1-19 name=__codelineno-1-19></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-1-20><a href=#__codelineno-1-20 id=__codelineno-1-20 name=__codelineno-1-20></a><span class=w>        </span><span class=nt>"policyRule"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-21><a href=#__codelineno-1-21 id=__codelineno-1-21 name=__codelineno-1-21></a><span class=w>            </span><span class=nt>"if"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-22><a href=#__codelineno-1-22 id=__codelineno-1-22 name=__codelineno-1-22></a><span class=w>                </span><span class=nt>"not"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-23><a href=#__codelineno-1-23 id=__codelineno-1-23 name=__codelineno-1-23></a><span class=w>                    </span><span class=nt>"field"</span><span class=p>:</span><span class=w> </span><span class=s2>"[concat('tags[', parameters('tagName'), ']')]"</span><span class=p>,</span>
</span><span id=__span-1-24><a href=#__codelineno-1-24 id=__codelineno-1-24 name=__codelineno-1-24></a><span class=w>                    </span><span class=nt>"equals"</span><span class=p>:</span><span class=w> </span><span class=s2>"[parameters('tagValue')]"</span>
</span><span id=__span-1-25><a href=#__codelineno-1-25 id=__codelineno-1-25 name=__codelineno-1-25></a><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-1-26><a href=#__codelineno-1-26 id=__codelineno-1-26 name=__codelineno-1-26></a><span class=w>                </span><span class=p>},</span>
</span><span id=__span-1-27><a href=#__codelineno-1-27 id=__codelineno-1-27 name=__codelineno-1-27></a><span class=w>            </span><span class=nt>"then"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-28><a href=#__codelineno-1-28 id=__codelineno-1-28 name=__codelineno-1-28></a><span class=w>                </span><span class=nt>"effect"</span><span class=p>:</span><span class=w> </span><span class=s2>"deny"</span>
</span><span id=__span-1-29><a href=#__codelineno-1-29 id=__codelineno-1-29 name=__codelineno-1-29></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-1-30><a href=#__codelineno-1-30 id=__codelineno-1-30 name=__codelineno-1-30></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-31><a href=#__codelineno-1-31 id=__codelineno-1-31 name=__codelineno-1-31></a><span class=p>}</span>
</span></code></pre></div> <p>Once you've filled out all the fields and written your policy rule, click on <code>Save</code>.</p> <h3 id=step-4-assign-the-policy><a class=toclink href=2024/02/26/writing-your-first-policy-in-azure-with-portal/#step-4-assign-the-policy>Step 4: Assign the Policy</a></h3> <ul> <li>Go back to the <code>Policy</code> service in the Azure portal.</li> <li>Click on <code>Assignments</code> under the <code>Authoring</code> section.</li> <li>Click on <code>+ Assign Policy</code>.</li> <li>In <strong>Basics</strong>, fill out the following fields:<ul> <li><strong>Scope</strong><ul> <li><strong>Scope</strong>: Select the scope where you want to assign the policy.</li> <li><strong>Exclusions</strong>: Add any exclusions if needed.</li> </ul> </li> <li><strong>Basics</strong><ul> <li><strong>Policy definition</strong>: Select the policy you created.</li> <li><strong>Assignment name</strong>: A unique name for the assignment.</li> <li><strong>Description</strong>: A detailed description of the assignment.</li> <li><strong>Policy enforcement</strong>: <code>Enabled</code>.</li> </ul> </li> </ul> </li> <li>In <strong>Parameters</strong>: Fill out any parameters needed for the policy.</li> <li>In <strong>Non-compliance message</strong>: A message to display when a resource is non-compliant.</li> <li>Click on <code>Review + create</code>: Review the assignment and click on <code>Create</code>.</li> </ul> <p>Congratulations! You've just created and assigned your first policy in Azure. It will now evaluate any new or existing resources within its scope.</p> <p>Remember, Azure Policy is a powerful tool for maintaining compliance and managing your resources at scale. Happy coding!</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-25 00:00:00">February 25, 2024</time></li> <li class=md-meta__item> in <a href=category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=azure-policy-defintion-schema><a href=2024/02/25/azure-policy-defintion-schema/ class=toclink>Azure Policy, defintion schema</a></h2> <p>This is the schema for the Azure Policy definition:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=p>{</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"string"</span><span class=p>,</span>
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The display name of the policy definition."</span>
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>        </span><span class=nt>"policyType"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"string"</span><span class=p>,</span>
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The policy type of the policy definition."</span>
</span><span id=__span-0-10><a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-11><a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-12><a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"string"</span><span class=p>,</span>
</span><span id=__span-0-13><a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The mode of the policy definition."</span>
</span><span id=__span-0-14><a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-15><a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-16><a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"string"</span><span class=p>,</span>
</span><span id=__span-0-17><a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The description of the policy definition."</span>
</span><span id=__span-0-18><a href=#__codelineno-0-18 id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-19><a href=#__codelineno-0-19 id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-20><a href=#__codelineno-0-20 id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"string"</span><span class=p>,</span>
</span><span id=__span-0-21><a href=#__codelineno-0-21 id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The mode of the policy definition."</span>
</span><span id=__span-0-22><a href=#__codelineno-0-22 id=__codelineno-0-22 name=__codelineno-0-22></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-23><a href=#__codelineno-0-23 id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>        </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-24><a href=#__codelineno-0-24 id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"object"</span><span class=p>,</span>
</span><span id=__span-0-25><a href=#__codelineno-0-25 id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The metadata of the policy definition."</span>
</span><span id=__span-0-26><a href=#__codelineno-0-26 id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-27><a href=#__codelineno-0-27 id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-28><a href=#__codelineno-0-28 id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"object"</span><span class=p>,</span>
</span><span id=__span-0-29><a href=#__codelineno-0-29 id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The parameters of the policy definition."</span>
</span><span id=__span-0-30><a href=#__codelineno-0-30 id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-0-31><a href=#__codelineno-0-31 id=__codelineno-0-31 name=__codelineno-0-31></a><span class=w>        </span><span class=nt>"policyRule"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-32><a href=#__codelineno-0-32 id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>            </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"object"</span><span class=p>,</span>
</span><span id=__span-0-33><a href=#__codelineno-0-33 id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>            </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"The policy rule of the policy definition. If/then rule."</span>
</span><span id=__span-0-34><a href=#__codelineno-0-34 id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>        </span><span class=p>}</span><span class=w>       </span>
</span><span id=__span-0-35><a href=#__codelineno-0-35 id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a href=#__codelineno-0-36 id=__codelineno-0-36 name=__codelineno-0-36></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-0-37><a href=#__codelineno-0-37 id=__codelineno-0-37 name=__codelineno-0-37></a><span class=p>}</span>
</span></code></pre></div> <p>You can see other elements in the schema like id, type, and name, It's depens of how you want to deploy the policy definition.</p> <p>Full schema is in <a href=https://schema.management.azure.com/schemas/2020-10-01/policyDefinition.json>Azure Policy definition schema</a>.</p> <h3 id=example><a class=toclink href=2024/02/25/azure-policy-defintion-schema/#example>Example</a></h3> <p>Here is an example of a policy definition:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=p>{</span>
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=nt>"properties"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>        </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Require a tag and its value"</span><span class=p>,</span>
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>        </span><span class=nt>"policyType"</span><span class=p>:</span><span class=w> </span><span class=s2>"Custom"</span><span class=p>,</span>
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>        </span><span class=nt>"mode"</span><span class=p>:</span><span class=w> </span><span class=s2>"Indexed"</span><span class=p>,</span>
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>        </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"This policy requires a specific tag and its value."</span><span class=p>,</span>
</span><span id=__span-1-7><a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>        </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-8><a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>            </span><span class=nt>"category"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tags"</span>
</span><span id=__span-1-9><a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-1-10><a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>        </span><span class=nt>"parameters"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-11><a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>            </span><span class=nt>"tagName"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-12><a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-1-13><a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-14><a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Name"</span><span class=p>,</span>
</span><span id=__span-1-15><a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Name of the tag, such as 'environment'"</span>
</span><span id=__span-1-16><a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-1-17><a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-1-18><a href=#__codelineno-1-18 id=__codelineno-1-18 name=__codelineno-1-18></a><span class=w>            </span><span class=nt>"tagValue"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-19><a href=#__codelineno-1-19 id=__codelineno-1-19 name=__codelineno-1-19></a><span class=w>                </span><span class=nt>"type"</span><span class=p>:</span><span class=w> </span><span class=s2>"String"</span><span class=p>,</span>
</span><span id=__span-1-20><a href=#__codelineno-1-20 id=__codelineno-1-20 name=__codelineno-1-20></a><span class=w>                </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-21><a href=#__codelineno-1-21 id=__codelineno-1-21 name=__codelineno-1-21></a><span class=w>                    </span><span class=nt>"displayName"</span><span class=p>:</span><span class=w> </span><span class=s2>"Tag Value"</span><span class=p>,</span>
</span><span id=__span-1-22><a href=#__codelineno-1-22 id=__codelineno-1-22 name=__codelineno-1-22></a><span class=w>                    </span><span class=nt>"description"</span><span class=p>:</span><span class=w> </span><span class=s2>"Value of the tag, such as 'production'"</span>
</span><span id=__span-1-23><a href=#__codelineno-1-23 id=__codelineno-1-23 name=__codelineno-1-23></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-1-24><a href=#__codelineno-1-24 id=__codelineno-1-24 name=__codelineno-1-24></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-1-25><a href=#__codelineno-1-25 id=__codelineno-1-25 name=__codelineno-1-25></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-1-26><a href=#__codelineno-1-26 id=__codelineno-1-26 name=__codelineno-1-26></a><span class=w>        </span><span class=nt>"policyRule"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-27><a href=#__codelineno-1-27 id=__codelineno-1-27 name=__codelineno-1-27></a><span class=w>            </span><span class=nt>"if"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-28><a href=#__codelineno-1-28 id=__codelineno-1-28 name=__codelineno-1-28></a><span class=w>                </span><span class=nt>"field"</span><span class=p>:</span><span class=w> </span><span class=s2>"[concat('tags[', parameters('tagName'), ']')]"</span><span class=p>,</span>
</span><span id=__span-1-29><a href=#__codelineno-1-29 id=__codelineno-1-29 name=__codelineno-1-29></a><span class=w>                </span><span class=nt>"exists"</span><span class=p>:</span><span class=w> </span><span class=s2>"false"</span>
</span><span id=__span-1-30><a href=#__codelineno-1-30 id=__codelineno-1-30 name=__codelineno-1-30></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-1-31><a href=#__codelineno-1-31 id=__codelineno-1-31 name=__codelineno-1-31></a><span class=w>            </span><span class=nt>"then"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-32><a href=#__codelineno-1-32 id=__codelineno-1-32 name=__codelineno-1-32></a><span class=w>                </span><span class=nt>"effect"</span><span class=p>:</span><span class=w> </span><span class=s2>"deny"</span>
</span><span id=__span-1-33><a href=#__codelineno-1-33 id=__codelineno-1-33 name=__codelineno-1-33></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-1-34><a href=#__codelineno-1-34 id=__codelineno-1-34 name=__codelineno-1-34></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-35><a href=#__codelineno-1-35 id=__codelineno-1-35 name=__codelineno-1-35></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-36><a href=#__codelineno-1-36 id=__codelineno-1-36 name=__codelineno-1-36></a><span class=p>}</span>
</span></code></pre></div> <p>This policy definition requires a specific tag and its value. If the tag does not exist, the policy denies the action.</p> <p>How you can see, the most important part of the policy definition is the policy rule. </p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The policy rule is where you describe the logic that enforces the policy.</p> </div> <h3 id=conclusion><a class=toclink href=2024/02/25/azure-policy-defintion-schema/#conclusion>Conclusion</a></h3> <p>Understanding the schema for Azure Policy definitions is essential for creating and managing policies effectively. By defining the necessary attributes and rules, you can enforce compliance, security, and operational standards across your Azure environment. Leveraging the Azure Policy definition schema allows you to tailor policies to your organization's specific requirements and ensure consistent governance practices.</p> <h3 id=references><a class=toclink href=2024/02/25/azure-policy-defintion-schema/#references>References</a></h3> <ul> <li><a href=https://schema.management.azure.com/schemas/2020-10-01/policyDefinition.json>Azure Policy definition schema</a></li> <li><a href=https://learn.microsoft.com/en-us/azure/governance/policy/overview>Azure Policy</a></li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-25 00:00:00">February 25, 2024</time></li> <li class=md-meta__item> in <a href=category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 3 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=writing-your-first-initiative-with-portal><a href=2024/02/25/writing-your-first-initiative-with-portal/ class=toclink>Writing Your First Initiative with Portal</a></h2> <p>Azure Policy is a service in Azure that you use to create, assign and manage policies. These policies enforce different rules and effects over your resources, so those resources stay compliant with your corporate standards and service level agreements.</p> <p>In this post, we'll walk through the steps of creating your first initiative in Azure.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>You need to have a good understanding of Azure Policy before creating an initiative. If you're new to Azure Policy, check out our post on <a href=2024/02/24/azure-policy/ >Azure Policy</a> and <a href=2024/02/26/writing-your-first-policy-in-azure-with-portal/ >Writing Your First Policy in Azure with Portal</a>.</p> </div> <h3 id=prerequisites><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#prerequisites>Prerequisites</a></h3> <ol> <li>An active Azure subscription.</li> <li>Access to Azure portal.</li> <li>Azure Policy defined in your subscription, if you don't have one, you can follow the steps in <a href=2024/02/26/writing-your-first-policy-in-azure-with-portal/ >Writing Your First Policy in Azure with Portal</a>.</li> </ol> <h3 id=step-1-open-azure-policy><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#step-1-open-azure-policy>Step 1: Open Azure Policy</a></h3> <ul> <li>Login to the <a href=https://portal.azure.com/ >Azure Portal</a>.</li> <li>In the left-hand menu, click on <code>All services</code>.</li> <li>In the <code>All services</code> blade, search for <code>Policy</code>.</li> </ul> <h3 id=step-2-create-a-new-initiative-definition><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#step-2-create-a-new-initiative-definition>Step 2: Create a New Initiative Definition</a></h3> <ul> <li>Click on <code>Defitinions</code> under the <code>Authoring</code> section.</li> <li>Click on <code>+ Initiative definition</code>.</li> </ul> <h3 id=step-3-fill-out-the-initiative-definition><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#step-3-fill-out-the-initiative-definition>Step 3: Fill Out the Initiative Definition</a></h3> <p>You will need to fill out several fields:</p> <ul> <li><strong>Basics</strong>:</li> <li><strong>Initiative location</strong>: The location where the initiative is stored.</li> <li><strong>Name</strong>: This is a unique name for your initiative.</li> <li><strong>Description</strong>: A detailed description of what the initiative does.</li> <li><strong>Category</strong>: You can categorize your initiative for easier searching and filtering.</li> <li><strong>Policies</strong>:</li> <li><strong>Add policy definition(s)</strong>: Here you can add the policies that will be part of the initiative.</li> <li><strong>Initiative parameters</strong>:</li> <li><strong>Add parameter</strong>: Here you can add parameters that will be used in the initiative. <img alt="Initiative parameters" src=2024/image.png></li> <li><strong>Policy parameters</strong>:</li> <li> <p><strong>Add policy parameter</strong>: Here you can add parameters that will be used in the policies that are part of the initiative. You can use the parameters defined in the initiative as value for different policies. <img alt="Policy parameters" src=2024/image-1.png></p> </li> <li> <p>Click on <code>Review + create</code>: Review the assignment and click on <code>Create</code>.</p> </li> </ul> <h3 id=step-4-assign-the-initiative><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#step-4-assign-the-initiative>Step 4: Assign the Initiative</a></h3> <ul> <li>Go to <code>Policy</code> again.</li> <li>Go to <code>Assignments</code> under the <code>Authoring</code> section.</li> <li>Click on <code>+ Assign initiative</code>.</li> </ul> <p>You will need to fill out several fields: - <strong>Basics</strong>: - <strong>Scope</strong>: Select the scope where you want to assign the initiative. - <strong>Basics</strong>: - <strong>Initiative definition</strong>: Select the initiative you just created. - <strong>Assignment name</strong>: A unique name for the assignment. - <strong>Description</strong>: A detailed description of what the assignment does. - <strong>Policy enforcement</strong>: Choose the enforcement mode for the assignment. - <strong>Parameters</strong>: - <strong>Add parameter</strong>: Initialize parameters that will be used in the initiative. - <strong>Remediation</strong>: - <strong>Auto-remediation</strong>: Enable or disable auto-remediation. That means that if a resource is not compliant, it will be remediated automatically. In other post it will be explained how to create a remediation task. - <strong>Non-compliance messages</strong>: - <strong>Non-compliance message</strong>: Define a message that will be shown when a resource is not compliant.</p> <ul> <li>Click on <code>Review + create</code>: Review the assignment and click on <code>Create</code>.</li> </ul> <h3 id=conclusion><a class=toclink href=2024/02/25/writing-your-first-initiative-with-portal/#conclusion>Conclusion</a></h3> <p>Creating an initiative in Azure Policy is a powerful way to group policies together and enforce them across your Azure environment. By defining initiatives, you can streamline governance, simplify compliance management, and ensure consistent application of policies to your resources. Start creating initiatives today to enhance the security, compliance, and operational efficiency of your Azure environment.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-02-24 00:00:00">February 24, 2024</time></li> <li class=md-meta__item> in <a href=category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 4 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=azure-policy><a href=2024/02/24/azure-policy/ class=toclink>Azure Policy</a></h2> <p>Azure Policy serves as a powerful tool for implementing governance across your Azure environment. It helps ensure resource consistency, regulatory compliance, security, cost management, and efficient operations</p> <p>As organizations leverage the power of Azure for their cloud infrastructure, ensuring governance, compliance, and security becomes paramount. Azure Policy, along with policies and initiatives, provides a robust framework to enforce and assess compliance with organizational standards and regulatory requirements. Let's delve into these concepts to understand how they work together.</p> <h3 id=azure-policy-overview><a class=toclink href=2024/02/24/azure-policy/#azure-policy-overview>Azure Policy Overview</a></h3> <p><strong>Azure Policy</strong> is a service in Azure that allows you to create, assign, and manage policies. These policies enforce different rules and effects over resources, so those resources stay compliant with corporate standards and service-level agreements.</p> <p>Azure Policy helps to address questions like:</p> <ul> <li>Are all virtual machines encrypted using Azure Disk Encryption?</li> <li>Are resources deployed only in certain Azure regions?</li> <li>Are specific tags applied to resources for tracking and organization?</li> </ul> <p>Policies in Azure Policy are defined using JSON-based policy definitions. These definitions can be simple or complex, depending on the requirements. Once a policy is created, it can be assigned to specific scopes within Azure, such as subscriptions, resource groups, or even individual resources.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>It's important to recognize that with the introduction of Azure Arc, you can extend your policy-based governance across different cloud providers and even to your local datacenters.</p> </div> <h3 id=policies><a class=toclink href=2024/02/24/azure-policy/#policies>Policies</a></h3> <p><strong>Policies</strong> in Azure Policy are rules that enforce different requirements and effects on resources. These policies can be related to security, compliance, or management. For instance, you can have a policy that ensures all publicly accessible storage accounts are secured with a firewall or a policy that enforces a specific naming convention for virtual machines.</p> <p>Key attributes of policies include: - <strong>Effect</strong>: Determines what happens when the condition in the policy is met (e.g., deny the action, audit the action, append a tag). - <strong>Condition</strong>: Defines when the policy is enforced based on properties of the resource being evaluated. - <strong>Action</strong>: Specifies what happens when a resource violates the policy (e.g., deny deployment, apply audit).</p> <p>Policies can be built-in (provided by Azure) or custom (defined by the organization). They play a vital role in maintaining compliance and security standards across Azure environments.</p> <h3 id=initiatives><a class=toclink href=2024/02/24/azure-policy/#initiatives>Initiatives</a></h3> <p><strong>Initiatives</strong> in Azure Policy are collections of policies that are grouped together as a single unit. This simplifies the process of assigning multiple policies to different scopes simultaneously. Initiatives help in enforcing complex requirements and compliance standards by grouping related policies together.</p> <pre class=mermaid><code>graph TD;
    A[Azure Policy] --&gt;|Contains| B1[Policy 1]
    A[Azure Policy] --&gt;|Contains| B2[Policy 2]
    A[Azure Policy] --&gt;|Contains| B3[Policy 3]
    A[Azure Policy] --&gt;|Contains| B4[Policy 4]
    B1[Policy 1] --&gt;|Belongs to| C[Initiative 1]
    B2[Policy 2] --&gt;|Belongs to| C[Initiative 1]
    B3[Policy 3] --&gt;|Belongs to| D[Initiative 2]


    classDef azurePolicy fill:#f9f,stroke:#333,stroke-width:2px;
    classDef policy fill:#fc9,stroke:#333,stroke-width:2px;
    classDef initiative fill:#9cf,stroke:#333,stroke-width:2px;

    class A,B1,B2,B3,B4 azurePolicy;
    class C,D initiative;
    class D1,D2,E1,E2 policy;</code></pre> <p>Initiatives allow you to:</p> <ul> <li>Apply multiple policies at once to a scope (like a subscription or management group).</li> <li>Monitor compliance against a set of defined standards or regulations.</li> <li>Streamline governance by organizing policies logically.</li> </ul> <p>By using initiatives, you can efficiently manage and enforce compliance with regulatory standards (e.g., CIS benchmarks, PCI DSS) or organizational best practices.</p> <h3 id=assignments><a class=toclink href=2024/02/24/azure-policy/#assignments>Assignments</a></h3> <p><strong>Assignments</strong> in Azure Policy are the mechanism to apply policies or initiatives to specific scopes within Azure. You can assign policies to subscriptions, resource groups, or even individual resources. Assignments help in enforcing governance and compliance standards across your Azure environment.</p> <pre class=mermaid><code>graph TD;
    A[Azure Policy] --&gt;|Contains| B1[Policy 1]
    A[Azure Policy] --&gt;|Contains| B2[Policy 2]
    A[Azure Policy] --&gt;|Contains| B3[Policy 3]
    A[Azure Policy] --&gt;|Contains| B4[Policy 4]
    B1[Policy 1] --&gt;|Belongs to| C[Initiative 1]
    B2[Policy 2] --&gt;|Belongs to| C[Initiative 1]
    B3[Policy 3] --&gt;|Belongs to| D[Initiative 2]
    C[Initiative 1] --&gt;|Assigned to| E[Subscription 1]
    D[Initiative 2] --&gt;|Assigned to| F[Resource Group 1]
    B4[Policy 4] --&gt;|Assigned to| G[Management Group 1]

    classDef azurePolicy fill:#f9f,stroke:#333,stroke-width:2px;
    classDef policy fill:#fc9,stroke:#333,stroke-width:2px;
    classDef initiative fill:#9cf,stroke:#333,stroke-width:2px;
    classDef assignment fill:#9f9,stroke:#333,stroke-width:2px;

    class A,B1,B2,B3,B4 azurePolicy;
    class C,D initiative;
    class E,F,G assignment;
    class D1,D2,E1,E2 policy;
</code></pre> <h3 id=conclusion><a class=toclink href=2024/02/24/azure-policy/#conclusion>Conclusion</a></h3> <p>In conclusion, Azure Policy, policies, and initiatives are fundamental components of Azure's governance framework. They enable organizations to define and enforce rules for Azure resources, ensuring adherence to compliance standards, security protocols, and operational guidelines. By leveraging these capabilities, Azure users can maintain control over their cloud environment while promoting consistency and security across deployments. If you're looking to enhance governance and compliance within Azure, exploring Azure Policy, policies, and initiatives is a crucial step forward.</p> <h3 id=references><a class=toclink href=2024/02/24/azure-policy/#references>References</a></h3> <ul> <li><a href=https://docs.microsoft.com/en-us/azure/governance/policy/overview>Azure Policy overview</a></li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-12-05 00:00:00">December 5, 2023</time></li> <li class=md-meta__item> in <a href=category/microsoft-365/ class=md-meta__link>Microsoft 365</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizacion><a href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/ class=toclink>Depurar logs de OneDrive para detectar problemas de sincronización</a></h2> <div class="admonition info"> <p class=admonition-title>Necesitas WSL2</p> <p>Para poder seguir este tutorial necesitas tener instalado WSL2 en tu equipo, si no lo tienes, puedes seguir este tutorial <a href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/ >Instalar WSL2 en Windows 11 con chocolatey</a></p> </div> <h3 id=introduccion><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#introduccion>Introducción</a></h3> <p>Llevo unos días con sync pending en algunos ficheros en mi OneDrive for Business sin ninguna razón aparente, por lo que he decidido investigar un poco y compartir como he resuelto el problema.</p> <p>Lo primero es seguir la siguiente documentación de Microsoft que puede ser útil para alguien que tenga problemas de sincronización con OneDrive:</p> <p><a href=https://support.microsoft.com/en-au/office/fix-onedrive-sync-problems-0899b115-05f7-45ec-95b2-e4cc8c4670b2>Fix OneDrive sync problems</a></p> <p>Pero si no funciona, se puede obtener más información de los logs de OneDrive.</p> <h3 id=pasos-a-seguir><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#pasos-a-seguir>Pasos a seguir</a></h3> <h4 id=1-acceder-a-los-logs-de-onedrive><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#1-acceder-a-los-logs-de-onedrive>1. Acceder a los logs de OneDrive</a></h4> <p>Para acceder a los logs de OneDrive, se debe seguir los siguientes pasos:</p> <ol> <li>Abrir el Explorador de archivos.</li> <li>Hacer clic en la flecha hacia arriba en la barra de direcciones.</li> <li>Pegar la siguiente ruta en la barra de direcciones y presionar Enter:</li> </ol> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Business</label><label for=__tabbed_1_2>Personal</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>%localappdata%\Microsoft\OneDrive\logs\Business1
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>%localappdata%\Microsoft\OneDrive\logs\Personal
</span></code></pre></div> </div> </div> </div> <p>Ahora es necesario seleccionar los archivos de log más recientes y copiarlos a un directorio, los archivos pueden tener extensión .odl,.odlgz, .odlsent o .aold, también se debe incluir el fichero ObfuscationStringMap.txt o general.keystore.</p> <h4 id=2-instalar-el-visor-de-logs-de-onedrive><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#2-instalar-el-visor-de-logs-de-onedrive>2. Instalar el visor de logs de OneDrive</a></h4> <p>Para instalar el visor de logs de OneDrive, se debe seguir los siguientes pasos:</p> <p>Descarga https://raw.githubusercontent.com/ydkhatri/OneDrive/main/odl.py y ejecuta el siguiente comando:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>pip3<span class=w> </span>install<span class=w> </span>pycryptodome
</span><span id=__span-2-2><a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>pip3<span class=w> </span>install<span class=w> </span>construct
</span><span id=__span-2-3><a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>python<span class=w> </span>odl.py<span class=w> </span>-o<span class=w> </span>&lt;ruta<span class=w> </span>de<span class=w> </span>salida&gt;/fichero.csv<span class=w> </span>&lt;ruta<span class=w> </span>de<span class=w> </span>los<span class=w> </span>logs&gt;
</span></code></pre></div> <p>Por ejemplo:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>python3<span class=w> </span>odl.py<span class=w> </span>-o<span class=w> </span>output/fichero.csv<span class=w> </span>input/
</span><span id=__span-3-2><a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a>WARNING:<span class=w> </span>Multiple<span class=w> </span>instances<span class=w> </span>of<span class=w> </span>some<span class=w> </span>keys<span class=w> </span>were<span class=w> </span>found<span class=w> </span><span class=k>in</span><span class=w> </span>the<span class=w> </span>ObfuscationMap.
</span><span id=__span-3-3><a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a>Read<span class=w> </span><span class=m>40493</span><span class=w> </span>items<span class=w> </span>from<span class=w> </span>map
</span><span id=__span-3-4><a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a>Recovered<span class=w> </span>Unobfuscation<span class=w> </span>key<span class=w> </span>Churreradenumneros,<span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=m>1</span>,<span class=w> </span><span class=nv>utf_type</span><span class=o>=</span>utf16
</span><span id=__span-3-5><a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a>Searching<span class=w>  </span>/mnt/c/Users/userdemo/Escritorio/input/SyncEngine-2023-09-04.0637.32.2.odl
</span><span id=__span-3-6><a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a>Wrote<span class=w> </span><span class=m>821</span><span class=w> </span>rows
</span><span id=__span-3-7><a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a>Searching<span class=w>  </span>/mnt/c/Users/userdemo/Escritorio/input/FileCoAuth-2023-09-03.0804.13536.1.odlgz
</span><span id=__span-3-8><a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a>Wrote<span class=w> </span><span class=m>203</span><span class=w> </span>rows
</span><span id=__span-3-9><a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a>Searching<span class=w>  </span>/mnt/c/Users/userdemo/Escritorio/input/FileCoAuth-2023-09-03.0804.14112.1.odlgz
</span><span id=__span-3-10><a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a>.......
</span><span id=__span-3-11><a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a>............
</span><span id=__span-3-12><a href=#__codelineno-3-12 id=__codelineno-3-12 name=__codelineno-3-12></a>...............
</span><span id=__span-3-13><a href=#__codelineno-3-13 id=__codelineno-3-13 name=__codelineno-3-13></a>Wrote<span class=w> </span><span class=m>872</span><span class=w> </span>rows
</span><span id=__span-3-14><a href=#__codelineno-3-14 id=__codelineno-3-14 name=__codelineno-3-14></a>Finished<span class=w> </span>processing<span class=w> </span>files,<span class=w> </span>output<span class=w> </span>is<span class=w> </span>at<span class=w> </span>output/fichero.csv
</span><span id=__span-3-15><a href=#__codelineno-3-15 id=__codelineno-3-15 name=__codelineno-3-15></a>userdemo@DESKTOP:/mnt/c/Users/userdemo/Escritorio$
</span></code></pre></div> <h4 id=3-analizar-los-logs><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#3-analizar-los-logs>3. Analizar los logs</a></h4> <p>Una vez que se ha generado el fichero CSV, se puede abrir con Excel o cualquier editor de texto para analizar los logs y detectar problemas de sincronización, busca error o warn para averiguar que puede estar provocando el problema.</p> <h4 id=solucion><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#solucion>Solución</a></h4> <p>En mi caso, tras poder leer los logs de OneDrive, he descubierto que OneDrive no podía escribir varios ficheros en disco, luego recordé que el otro día mi equipo no se apagó bien.</p> <p>Tras un chkdsk c: /F /R, fin de la historia, ahora todo funciona, espero que le resulte útil a alguien.</p> <h3 id=referencias><a class=toclink href=2023/12/05/depurar-logs-de-onedrive-para-detectar-problemas-de-sincronizaci%C3%B3n/#referencias>Referencias</a></h3> <ul> <li>https://github.com/ydkhatri/OneDrive/tree/main</li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-12-04 00:00:00">December 4, 2023</time></li> <li class=md-meta__item> in <a href=category/windows/ class=md-meta__link>Windows</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=instalar-wsl2-en-windows-11-con-chocolatey><a href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/ class=toclink>Instalar WSL2 en Windows 11 con chocolatey</a></h2> <h3 id=introduccion><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#introduccion>Introducción</a></h3> <p>Windows Subsystem for Linux (WSL) es una característica de Windows 11 que permite ejecutar un entorno de Linux en Windows. WSL2 es la segunda versión de WSL que ofrece un kernel de Linux completo y un mejor rendimiento en comparación con WSL1. Este análisis proporciona una guía paso a paso para instalar WSL2 en Windows 11.</p> <h3 id=pasos-a-seguir><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#pasos-a-seguir>Pasos a seguir</a></h3> <h4 id=1-instalar-chocolatey><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#1-instalar-chocolatey>1. Instalar Chocolatey</a></h4> <p>Chocolatey es un administrador de paquetes para Windows que facilita la instalación y gestión de software. Para instalar Chocolatey, siga los siguientes pasos:</p> <ol> <li> <p>Abra PowerShell como administrador.</p> </li> <li> <p>Ejecute el siguiente comando para instalar Chocolatey:</p> </li> </ol> <div class="language-pwsh highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nb>Set-ExecutionPolicy</span> <span class=n>Bypass</span> <span class=n>-Scope</span> <span class=k>Process</span> <span class=n>-Force</span><span class=p>;</span> <span class=no>[System.Net.ServicePointManager]</span><span class=p>::</span><span class=n>SecurityProtocol</span> <span class=p>=</span> <span class=no>[System.Net.ServicePointManager]</span><span class=p>::</span><span class=n>SecurityProtocol</span> <span class=o>-bor</span> <span class=n>3072</span><span class=p>;</span> <span class=nb>iex </span><span class=p>((</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadString</span><span class=p>(</span><span class=s1>'https://chocolatey.org/install.ps1'</span><span class=p>))</span>
</span></code></pre></div> <ol> <li>Espere a que se complete la instalación de Chocolatey.</li> </ol> <h4 id=2-instalar-wsl2><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#2-instalar-wsl2>2. Instalar WSL2</a></h4> <p>Para instalar WSL2 en Windows 11, siga los siguientes pasos:</p> <ol> <li> <p>Abra PowerShell como administrador.</p> </li> <li> <p>Ejecute el siguiente comando para instalar WSL2:</p> </li> </ol> <p><div class="language-pwsh highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=n>choco</span> <span class=n>install</span> <span class=n>wsl2</span>
</span></code></pre></div> 3. Espere a que se complete la instalación de WSL2.</p> <h4 id=3-configurar-wsl2><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#3-configurar-wsl2>3. Configurar WSL2</a></h4> <p>Para configurar WSL2 en Windows 11, siga los siguientes pasos:</p> <ol> <li> <p>Abra PowerShell como administrador.</p> </li> <li> <p>Ejecute el siguiente comando para configurar WSL2 como la versión predeterminada:</p> </li> </ol> <div class="language-pwsh highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=n>wsl</span> <span class=p>-</span><span class=n>-set-default-version</span> <span class=n>2</span>
</span></code></pre></div> <ol> <li>Reinicie su computadora para aplicar los cambios.</li> </ol> <h4 id=4-instalar-una-distribucion-de-linux><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#4-instalar-una-distribucion-de-linux>4. Instalar una distribución de Linux</a></h4> <p>Para instalar una distribución de Linux en WSL2, siga los siguientes pasos:</p> <ol> <li> <p>Abra PowerShell.</p> </li> <li> <p>Busque la distribución de Linux que desea instalar (por ejemplo, Ubuntu, Debian, Fedora)</p> </li> </ol> <div class="language-pwsh highlight"><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=n>wsl</span> <span class=p>-</span><span class=n>-list</span> <span class=p>-</span><span class=n>-online</span>
</span></code></pre></div> <ol> <li>Ejecute el siguiente comando para instalar la distribución de Linux seleccionada:</li> </ol> <div class="language-pwsh highlight"><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=n>wsl</span> <span class=p>-</span><span class=n>-install</span> <span class=n>-d</span> <span class=p>&lt;</span><span class=n>nombre</span> <span class=n>de</span> <span class=n>la</span> <span class=n>distribución</span><span class=p>&gt;</span>
</span></code></pre></div> <ol> <li>Espere a que se complete la instalación de la distribución de Linux.</li> </ol> <h4 id=5-iniciar-wsl2><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#5-iniciar-wsl2>5. Iniciar WSL2</a></h4> <p>Para iniciar WSL2 en Windows 11, siga los siguientes pasos:</p> <ol> <li> <p>Abra PowerShell.</p> </li> <li> <p>Ejecute el siguiente comando para iniciar la distribución de Linux instalada:</p> </li> </ol> <div class="language-pwsh highlight"><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=n>wsl</span>
</span></code></pre></div> <h3 id=referencias><a class=toclink href=2023/12/04/instalar-wsl2-en-windows-11-con-chocolatey/#referencias>Referencias</a></h3> <ul> <li><a href=https://chocolatey.org/ >Chocolatey</a></li> <li><a href=https://learn.microsoft.com/en-us/windows/wsl/about>What is the Windows Subsystem for Linux?</a></li> </ul> </div> </article> <nav class=md-pagination> <span class=md-pagination__current>1</span> <a href=page/2/ class=md-pagination__link>2</a> <a href=page/3/ class=md-pagination__link>3</a> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button class="md-top md-icon" data-md-component=top hidden type=button> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2023-now Rafael Fernández </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://www.linkedin.com/in/rafaelfernandezd/ rel=noopener target=_blank title=LinkedIn> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> </a> <a class=md-social__link href=https://github.com/rfernandezdo rel=noopener target=_blank title=GitHub> <svg viewbox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </a> <a class=md-social__link href=https://rfernandezdo.github.io/feed_rss_created.xml rel=noopener target=_blank title="RSS feed"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.1e8ae164.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../javascripts/tablesort.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>