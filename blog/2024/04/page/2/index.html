<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="A blog about Azure, DevOps and other stuff" name=description><meta content="Rafael Fernández" name=author><link href=https://rfernandezdo.github.io/blog/2024/04/page/2/ rel=canonical><link href=../../../../category/windows/ rel=prev><link href=../../../03/ rel=next><link href=../../../../../feed_rss_created.xml rel=alternate title="RSS feed" type=application/rss+xml><link href=../../../../../feed_rss_updated.xml rel=alternate title="RSS feed of updated content" type=application/rss+xml><link href=../../../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.6.0, mkdocs-material-9.5.20" name=generator><title>2024/04 - Un Rinconcito donde contar lo que quiera</title><link href=../../../../../assets/stylesheets/main.66ac8b77.min.css rel=stylesheet><link href=../../../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta content=website property=og:type><meta content="2024/04 - Un Rinconcito donde contar lo que quiera" property=og:title><meta content="A blog about Azure, DevOps and other stuff" property=og:description><meta content=https://rfernandezdo.github.io/assets/images/social/blog/2024/04/page/2.png property=og:image><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=https://rfernandezdo.github.io/blog/2024/04/page/2/ property=og:url><meta content=summary_large_image name=twitter:card><meta content="2024/04 - Un Rinconcito donde contar lo que quiera" name=twitter:title><meta content="A blog about Azure, DevOps and other stuff" name=twitter:description><meta content=https://rfernandezdo.github.io/assets/images/social/blog/2024/04/page/2.png name=twitter:image> <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head> <body data-md-color-accent=blue data-md-color-primary=blue data-md-color-scheme=default dir=ltr> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#202404> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component=logo href=../../../../.. title="Un Rinconcito donde contar lo que quiera"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Un Rinconcito donde contar lo que quiera </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2024/04 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=blue data-md-color-media data-md-color-primary=blue data-md-color-scheme=default id=__palette_0 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=blue data-md-color-media data-md-color-primary=black data-md-color-scheme=slate id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_0 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button aria-label="Select language" class="md-header__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"></path></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a class=md-select__link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&_x_tr_tl=es&_x_tr_hl=es&_x_tr_pto=wapp" hreflang=en> English </a> </li> <li class=md-select__item> <a class=md-select__link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=en&_x_tr_pto=wapp" hreflang=es> Spanish </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../../..> About </a> </li> <li class=md-tabs__item> <a href=../../../../../contributions/ class=md-tabs__link> Contributions </a> </li> <li class=md-tabs__item> <a href=../../../../../Azure/Security/MCSB/Readme/ class=md-tabs__link> Azure </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component=logo href=../../../../.. title="Un Rinconcito donde contar lo que quiera"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> Un Rinconcito donde contar lo que quiera </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_1_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=../../../../tags/ class=md-nav__link> <span class=md-ellipsis> Posts by Tags </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_1_3 type=checkbox> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_1_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 2024/04 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=../../ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 2024/04 </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud> <span class=md-ellipsis> Cambio de nombres de los niveles de servicio de Microsoft Defender para Cloud </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#azure-policy-useful-queries> <span class=md-ellipsis> Azure Policy useful queries </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#kusto-query-language-kql-for-azure-resource-graph> <span class=md-ellipsis> Kusto Query Language (KQL) for Azure Resource Graph </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account> <span class=md-ellipsis> How to use Azue ARC-enabled servers with managed identity to access to Azure Storage Account </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#azure-arc> <span class=md-ellipsis> Azure ARC </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#microsoft-azure-certifications> <span class=md-ellipsis> Microsoft Azure Certifications </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services> <span class=md-ellipsis> Privileged Access Management (PAM) Strategy with Microsoft Entra ID and some Azure Services </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../03/ class=md-nav__link> <span class=md-ellipsis> 2024/03 </span> </a> </li> <li class=md-nav__item> <a href=../../../02/ class=md-nav__link> <span class=md-ellipsis> 2024/02 </span> </a> </li> <li class=md-nav__item> <a href=../../../../2023/12/ class=md-nav__link> <span class=md-ellipsis> 2023/12 </span> </a> </li> <li class=md-nav__item> <a href=../../../../2023/11/ class=md-nav__link> <span class=md-ellipsis> 2023/11 </span> </a> </li> <li class=md-nav__item> <a href=../../../../2023/10/ class=md-nav__link> <span class=md-ellipsis> 2023/10 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_1_4 type=checkbox> <label class=md-nav__link for=__nav_1_4 id=__nav_1_4_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_1_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../category/azure/ class=md-nav__link> <span class=md-ellipsis> Azure </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/azure-frameworks/ class=md-nav__link> <span class=md-ellipsis> Azure Frameworks </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/azure-services/ class=md-nav__link> <span class=md-ellipsis> Azure Services </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/azure-updates/ class=md-nav__link> <span class=md-ellipsis> Azure Updates </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/devops/ class=md-nav__link> <span class=md-ellipsis> DevOps </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/english/ class=md-nav__link> <span class=md-ellipsis> English </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/hello_world/ class=md-nav__link> <span class=md-ellipsis> Hello_World </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/learning/ class=md-nav__link> <span class=md-ellipsis> Learning </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/microsoft-365/ class=md-nav__link> <span class=md-ellipsis> Microsoft 365 </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../../..> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../../../contributions/ class=md-nav__link> <span class=md-ellipsis> Contributions </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4_1 type=checkbox> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_1_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_4_1_1 type=checkbox> <label class=md-nav__link for=__nav_4_1_1 id=__nav_4_1_1_label tabindex=0> <span class=md-ellipsis> MCSB </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_1_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> MCSB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Readme/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Readme </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Asset%20Management/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Asset Management </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Backup%20and%20Recovery/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Backup and Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Data%20Protection/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Data Protection </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/DevOps%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - DevOps Security </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Endpoint%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Endpoint Security </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Governance%20and%20Strategy/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Governance and Strategy </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Identity%20Management/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Identity Management </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Incident%20Response/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Incident Response </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Logging and Threat Detection </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Network%20Security/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Network Security </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Posture and Vulnerability Mgmt </span> </a> </li> <li class=md-nav__item> <a href=../../../../../Azure/Security/MCSB/Privileged%20Access/ class=md-nav__link> <span class=md-ellipsis> MCSB_v1 - Privileged Access </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=202404>2024/04</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-17 00:00:00">April 17, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 1 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud><a href=../../17/cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud/ class=toclink>Cambio de nombres de los niveles de servicio de Microsoft Defender para Cloud</a></h2> <p>No es nuevo pero me gustaría recordar que Microsoft ha cambiado los nombres de los niveles de servicio de Microsoft Defender para Cloud. A continuación, se muestra una tabla con los nombres anteriores y los nuevos nombres de los niveles de servicio de Microsoft Defender para Cloud:</p> <table> <thead> <tr> <th>Nombre ANTERIOR del nivel de servicio 2</th> <th>Nombre NUEVO del nivel de servicio 2</th> <th>Nivel de servicio: nivel de servicio 4 (sin cambios)</th> </tr> </thead> <tbody> <tr> <td>Advanced Data Security</td> <td>Microsoft Defender for Cloud</td> <td>Defender para SQL</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para registros de contenedor</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para DNS</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para Key Vault</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para Kubernetes</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para MySQL</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para PostgreSQL</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para Resource Manager</td> </tr> <tr> <td>Advanced Threat Protection</td> <td>Microsoft Defender for Cloud</td> <td>Defender para Storage</td> </tr> <tr> <td>Azure Defender</td> <td>Microsoft Defender for Cloud</td> <td>Administración de superficie expuesta a ataques externos de Defender</td> </tr> <tr> <td>Azure Defender</td> <td>Microsoft Defender for Cloud</td> <td>Defender para Azure Cosmos DB</td> </tr> <tr> <td>Azure Defender</td> <td>Microsoft Defender for Cloud</td> <td>Defender para contenedores</td> </tr> <tr> <td>Azure Defender</td> <td>Microsoft Defender for Cloud</td> <td>Defender for MariaDB</td> </tr> <tr> <td>Security Center</td> <td>Microsoft Defender for Cloud</td> <td>Defender para App Service</td> </tr> <tr> <td>Security Center</td> <td>Microsoft Defender for Cloud</td> <td>Defender para servidores</td> </tr> <tr> <td>Security Center</td> <td>Microsoft Defender for Cloud</td> <td>Administración de la posición de seguridad en la nube de Defender</td> </tr> </tbody> </table> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-17 00:00:00">April 17, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 2 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=azure-policy-useful-queries><a href=../../17/azure-policy-useful-queries/ class=toclink>Azure Policy useful queries</a></h2> <h3 id=policy-assignments-and-information-about-each-of-its-respective-definitions><a class=toclink href=../../17/azure-policy-useful-queries/#policy-assignments-and-information-about-each-of-its-respective-definitions>Policy assignments and information about each of its respective definitions</a></h3> <div class="language-kusto highlight"><pre><span></span><code><span id=__span-8-1><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a><span class=c>// Policy assignments and information about each of its respective definitions</span>
</span><span id=__span-8-2><a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a><span class=c>// Gets policy assignments in your environment with the respective assignment name,definition associated, category of definition (if applicable), as well as whether the definition type is an initiative or a single policy.</span>
</span><span id=__span-8-3><a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>
</span><span id=__span-8-4><a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a><span class=n>policyResources</span>
</span><span id=__span-8-5><a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicyAssignments'</span>
</span><span id=__span-8-6><a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>policyAssignmentId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>tostring</span><span class=p>(</span><span class=n>id</span><span class=p>)),</span><span class=w> </span><span class=n>policyAssignmentDisplayName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tostring</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>displayName</span><span class=p>),</span><span class=w> </span><span class=n>policyAssignmentDefinitionId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>policyDefinitionId</span><span class=p>)</span>
</span><span id=__span-8-7><a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a><span class=p>|</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>kind</span><span class=p>=</span><span class=n>leftouter</span><span class=p>(</span>
</span><span id=__span-8-8><a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a><span class=w> </span><span class=n>policyResources</span>
</span><span id=__span-8-9><a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a><span class=w> </span><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicySetDefinitions'</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicyDefinitions'</span>
</span><span id=__span-8-10><a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a><span class=w> </span><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>definitionId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>id</span><span class=p>),</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tostring</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>metadata</span><span class=err>.</span><span class=n>category</span><span class=p>),</span><span class=w> </span><span class=n>definitionType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'Microsoft.Authorization/PolicysetDefinitions'</span><span class=p>,</span><span class=w> </span><span class=s>'initiative'</span><span class=p>,</span><span class=w> </span><span class=s>'policy'</span><span class=p>)</span>
</span><span id=__span-8-11><a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>$</span><span class=n>left</span><span class=err>.</span><span class=n>policyAssignmentDefinitionId</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=err>$</span><span class=n>right</span><span class=err>.</span><span class=n>definitionId</span>
</span></code></pre></div> <ul> <li><a href=https://https://gist.github.com/timothywarner/8e5b6dea296f506871223883eb33059e>Original Gist</a></li> </ul> <h3 id=list-subscriptionid-and-subscriptionname><a class=toclink href=../../17/azure-policy-useful-queries/#list-subscriptionid-and-subscriptionname>List SubscriptionId and SubscriptionName</a></h3> <div class="language-kusto highlight"><pre><span></span><code><span id=__span-9-1><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=n>ResourceContainers</span>
</span><span id=__span-9-2><a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'microsoft.resources/subscriptions'</span>
</span><span id=__span-9-3><a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>subscriptionId</span><span class=p>,</span><span class=w> </span><span class=n>subscriptionName</span><span class=p>=</span><span class=n>name</span>
</span></code></pre></div> <h3 id=list-managementgroupid-and-managementgroupname><a class=toclink href=../../17/azure-policy-useful-queries/#list-managementgroupid-and-managementgroupname>List ManagementGroupId and ManagementGroupName</a></h3> <div class="language-kusto highlight"><pre><span></span><code><span id=__span-10-1><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=n>ResourceContainers</span>
</span><span id=__span-10-2><a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'microsoft.management/managementgroups'</span>
</span><span id=__span-10-3><a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>mgname</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>displayName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>properties</span><span class=err>.</span><span class=n>displayName</span>
</span></code></pre></div> <h3 id=policy-assignments-and-information-about-each-of-its-respective-definitions-displaying-the-scope-of-the-assignment-the-subscription-display-name-the-management-group-id-the-resource-group-name-the-definition-type-the-assignment-name-the-category-of-the-definition-and-the-policy-assignment-id><a class=toclink href=../../17/azure-policy-useful-queries/#policy-assignments-and-information-about-each-of-its-respective-definitions-displaying-the-scope-of-the-assignment-the-subscription-display-name-the-management-group-id-the-resource-group-name-the-definition-type-the-assignment-name-the-category-of-the-definition-and-the-policy-assignment-id>Policy assignments and information about each of its respective definitions displaying the scope of the assignment, the subscription display name, the management group id, the resource group name, the definition type, the assignment name, the category of the definition, and the policy assignment ID.</a></h3> <div class="language-kusto highlight"><pre><span></span><code><span id=__span-11-1><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=n>policyResources</span>
</span><span id=__span-11-2><a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicyAssignments'</span>
</span><span id=__span-11-3><a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>policyAssignmentId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>tostring</span><span class=p>(</span><span class=n>id</span><span class=p>)),</span><span class=w> </span><span class=n>policyAssignmentDisplayName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tostring</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>displayName</span><span class=p>),</span><span class=w> </span><span class=n>policyAssignmentDefinitionId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>policyDefinitionId</span><span class=p>),</span><span class=w> </span><span class=n>subscriptionId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tostring</span><span class=p>(</span><span class=n>subscriptionId</span><span class=p>),</span><span class=n>resourceGroup</span><span class=p>=</span><span class=n>tostring</span><span class=p>(</span><span class=n>resourceGroup</span><span class=p>),</span><span class=w> </span><span class=n>AssignmentDefinition</span><span class=p>=</span><span class=n>properties</span>
</span><span id=__span-11-4><a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=p>|</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>kind</span><span class=p>=</span><span class=n>leftouter</span><span class=p>(</span>
</span><span id=__span-11-5><a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a><span class=w>    </span><span class=n>policyResources</span>
</span><span id=__span-11-6><a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a><span class=w>    </span><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicySetDefinitions'</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=s>'Microsoft.Authorization/PolicyDefinitions'</span>
</span><span id=__span-11-7><a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a><span class=w>    </span><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>definitionId</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tolower</span><span class=p>(</span><span class=n>id</span><span class=p>),</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>tostring</span><span class=p>(</span><span class=n>properties</span><span class=err>.</span><span class=n>metadata</span><span class=err>.</span><span class=n>category</span><span class=p>),</span><span class=w> </span><span class=n>definitionType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'Microsoft.Authorization/PolicysetDefinitions'</span><span class=p>,</span><span class=w> </span><span class=s>'initiative'</span><span class=p>,</span><span class=w> </span><span class=s>'policy'</span><span class=p>),</span><span class=n>PolicyDefinition</span><span class=p>=</span><span class=n>properties</span>
</span><span id=__span-11-8><a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>$</span><span class=n>left</span><span class=err>.</span><span class=n>policyAssignmentDefinitionId</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=err>$</span><span class=n>right</span><span class=err>.</span><span class=n>definitionId</span>
</span><span id=__span-11-9><a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a><span class=p>|</span><span class=w> </span><span class=k>extend</span><span class=w> </span><span class=n>scope</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>policyAssignmentId</span><span class=w> </span><span class=k>contains</span><span class=w> </span><span class=s>'/subscriptions/'</span><span class=p>,</span><span class=w> </span><span class=s>'Subscription'</span><span class=p>,</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>policyAssignmentId</span><span class=w> </span><span class=k>contains</span><span class=w> </span><span class=s>'/providers/microsoft.management/managementgroups'</span><span class=p>,</span><span class=w> </span><span class=s>'Management Group'</span><span class=p>,</span><span class=w> </span><span class=s>'Resource Group'</span><span class=p>))</span>
</span><span id=__span-11-10><a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a><span class=p>|</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>kind</span><span class=p>=</span><span class=n>leftouter</span><span class=w> </span><span class=p>(</span><span class=n>ResourceContainers</span>
</span><span id=__span-11-11><a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'microsoft.resources/subscriptions'</span>
</span><span id=__span-11-12><a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>subscriptionId</span><span class=p>,</span><span class=w> </span><span class=n>subscriptionName</span><span class=p>=</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>$</span><span class=n>left</span><span class=err>.</span><span class=n>subscriptionId</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=err>$</span><span class=n>right</span><span class=err>.</span><span class=n>subscriptionId</span>
</span><span id=__span-11-13><a href=#__codelineno-11-13 id=__codelineno-11-13 name=__codelineno-11-13></a><span class=p>|</span><span class=w> </span><span class=k>extend</span><span class=w> </span><span class=n>SubscriptionDisplayName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>isnotempty</span><span class=p>(</span><span class=n>subscriptionId</span><span class=p>),</span><span class=w> </span><span class=n>subscriptionName</span><span class=p>,</span><span class=w> </span><span class=s>''</span><span class=p>)</span>
</span><span id=__span-11-14><a href=#__codelineno-11-14 id=__codelineno-11-14 name=__codelineno-11-14></a><span class=p>|</span><span class=w> </span><span class=k>extend</span><span class=w> </span><span class=n>ManagementGroupName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>policyAssignmentId</span><span class=w> </span><span class=k>contains</span><span class=w> </span><span class=s>'/providers/microsoft.management/'</span><span class=p>,</span><span class=w> </span><span class=n>split</span><span class=p>(</span><span class=n>policyAssignmentId</span><span class=p>,</span><span class=w> </span><span class=s>'/'</span><span class=p>)[</span><span class=mi>4</span><span class=p>],</span><span class=s>''</span><span class=p>)</span>
</span><span id=__span-11-15><a href=#__codelineno-11-15 id=__codelineno-11-15 name=__codelineno-11-15></a><span class=p>|</span><span class=w> </span><span class=k>extend</span><span class=w> </span><span class=n>resourceGroupDisplayName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=n>iff</span><span class=p>(</span><span class=n>isnotempty</span><span class=p>(</span><span class=n>resourceGroup</span><span class=p>),</span><span class=w> </span><span class=n>resourceGroup</span><span class=p>,</span><span class=w> </span><span class=s>''</span><span class=p>)</span>
</span><span id=__span-11-16><a href=#__codelineno-11-16 id=__codelineno-11-16 name=__codelineno-11-16></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>ManagementGroupName</span><span class=p>,</span><span class=n>SubscriptionDisplayName</span><span class=p>,</span><span class=n>resourceGroupDisplayName</span><span class=p>,</span><span class=w> </span><span class=n>scope</span><span class=p>,</span><span class=n>definitionType</span><span class=p>,</span><span class=n>policyAssignmentDisplayName</span><span class=p>,</span><span class=w> </span><span class=n>category</span><span class=p>,</span><span class=n>policyAssignmentId</span><span class=p>,</span><span class=w> </span><span class=n>AssignmentDefinition</span><span class=p>,</span><span class=w> </span><span class=n>PolicyDefinition</span>
</span></code></pre></div> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Add Management Group Display Name</li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-17 00:00:00">April 17, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 3 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=kusto-query-language-kql-for-azure-resource-graph><a href=../../17/kusto-query-language-kql-for-azure-resource-graph/ class=toclink>Kusto Query Language (KQL) for Azure Resource Graph</a></h2> <p>Azure Graph is a powerful tool provided by Microsoft to query data across all your Azure resources. It uses the Kusto Query Language (KQL), a read-only language similar to SQL, designed to query vast amounts of data in Azure services.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Only a subset of KQL is supported in Azure Resource Graph. For more information, see the <a href=https://learn.microsoft.com/en-us/azure/governance/resource-graph/concepts/query-language#supported-kql-language-elements>Azure Resource Graph Supported KQL Language Elements</a>.</p> </div> <h3 id=what-is-kql><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#what-is-kql><strong>What is KQL?</strong></a></h3> <p>KQL stands for Kusto Query Language. It's a request to process data and return results. The syntax is easy to read and author, making it ideal for data exploration and ad-hoc data mining tasks.</p> <h3 id=using-kql-with-azure-graph><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#using-kql-with-azure-graph><strong>Using KQL with Azure Graph</strong></a></h3> <p>Azure Graph allows you to use KQL to create complex queries that fetch information from your Azure resources. You can filter, sort, aggregate, and join data from different resources using KQL.</p> <p>Here's an example of how you might use KQL to query Azure Graph:</p> <div class="language-kql highlight"><pre><span></span><code><span id=__span-12-1><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a><span class=n>Resources</span>
</span><span id=__span-12-2><a href=#__codelineno-12-2 id=__codelineno-12-2 name=__codelineno-12-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'microsoft.web/sites'</span>
</span><span id=__span-12-3><a href=#__codelineno-12-3 id=__codelineno-12-3 name=__codelineno-12-3></a><span class=p>|</span><span class=w> </span><span class=k>project</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>location</span><span class=p>,</span><span class=w> </span><span class=n>resourceGroup</span>
</span></code></pre></div> <p>This query retrieves all Azure Web Apps (websites) and projects their <code>name</code>, <code>location</code>, and <code>resourceGroup</code>.</p> <h3 id=key-characteristics-of-kql><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#key-characteristics-of-kql><strong>Key Characteristics of KQL</strong></a></h3> <ol> <li><strong>Case Sensitivity</strong>: Unlike SQL, KQL is case-sensitive. So 'Name' and 'name' would be considered different identifiers.</li> <li><strong>Schema-Free</strong>: Kusto (Azure Data Explorer) doesn't require a fixed schema, allowing storage of diverse types of data.</li> <li><strong>Extensibility</strong>: While KQL has a wide array of functions, you can also create custom functions as per your needs.</li> </ol> <h3 id=common-operators-in-kql><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#common-operators-in-kql><strong>Common Operators in KQL</strong></a></h3> <ul> <li><code>|</code> : This operator creates a pipeline where the output of one command becomes the input of another.</li> <li><code>where</code> : Filters rows based on specified conditions.</li> <li><code>summarize</code> : Groups rows and calculates aggregate expressions.</li> <li><code>join</code> : Combines rows from two tables based on a common column.</li> <li><code>project</code> : Selects specific columns from the input.</li> <li><code>extend</code> : Adds new columns to the input.</li> <li><code>order by</code> : Sorts rows based on specified columns.</li> </ul> <h3 id=kql-query-examples><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#kql-query-examples><strong>KQL Query Examples</strong></a></h3> <h4 id=1-list-all-azure-resources-in-a-subscription><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#1-list-all-azure-resources-in-a-subscription><strong>1. List all Azure resources in a subscription</strong></a></h4> <div class="language-kql highlight"><pre><span></span><code><span id=__span-13-1><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=n>Resources</span>
</span></code></pre></div> <h4 id=2-list-all-azure-resources-in-a-resource-group><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#2-list-all-azure-resources-in-a-resource-group><strong>2. List all Azure resources in a resource group</strong></a></h4> <div class="language-kql highlight"><pre><span></span><code><span id=__span-14-1><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=n>Resources</span>
</span><span id=__span-14-2><a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>resourceGroup</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s>'myResourceGroup'</span>
</span></code></pre></div> <h4 id=3-list-all-azure-resources-of-a-specific-type><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#3-list-all-azure-resources-of-a-specific-type><strong>3. List all Azure resources of a specific type</strong></a></h4> <div class="language-kql highlight"><pre><span></span><code><span id=__span-15-1><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a><span class=n>Resources</span>
</span><span id=__span-15-2><a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a><span class=p>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>=~</span><span class=w> </span><span class=s>'Microsoft.Compute/virtualMachines'</span>
</span></code></pre></div> <h3 id=pagination-in-kql><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#pagination-in-kql><strong>Pagination in KQL</strong></a></h3> <p>KQL supports pagination using the <code>limit</code> and <code>offset</code> operators. You can use these operators to control the number of rows returned and skip a certain number of rows.</p> <div class="language-kql highlight"><pre><span></span><code><span id=__span-16-1><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a><span class=n>Resources</span>
</span><span id=__span-16-2><a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a><span class=p>|</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>10</span>
</span><span id=__span-16-3><a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a><span class=p>|</span><span class=w> </span><span class=n>offset</span><span class=w> </span><span class=mi>5</span>
</span></code></pre></div> <p>If you exceed payload limits, you can paginate Azure Resource Graph query results with powershell:</p> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-17-1><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a><span class=nv>$kqlQuery</span> <span class=p>=</span> <span class=s2>"policyResources | where type =~'Microsoft.Authorization/PolicySetDefinitions' or type =~'Microsoft.Authorization/PolicyDefinitions' | project definitionId = tolower(id), category = tostring(properties.metadata.category), definitionType = iff(type =~ 'Microsoft.Authorization/PolicysetDefinitions', 'initiative', 'policy'),PolicyDefinition=properties"</span>
</span><span id=__span-17-2><a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a>
</span><span id=__span-17-3><a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a><span class=nv>$batchSize</span> <span class=p>=</span> <span class=n>5</span>
</span><span id=__span-17-4><a href=#__codelineno-17-4 id=__codelineno-17-4 name=__codelineno-17-4></a><span class=nv>$skipResult</span> <span class=p>=</span> <span class=n>0</span>
</span><span id=__span-17-5><a href=#__codelineno-17-5 id=__codelineno-17-5 name=__codelineno-17-5></a>
</span><span id=__span-17-6><a href=#__codelineno-17-6 id=__codelineno-17-6 name=__codelineno-17-6></a><span class=no>[System.Collections.Generic.List[string]]</span><span class=nv>$kqlResult</span>
</span><span id=__span-17-7><a href=#__codelineno-17-7 id=__codelineno-17-7 name=__codelineno-17-7></a>
</span><span id=__span-17-8><a href=#__codelineno-17-8 id=__codelineno-17-8 name=__codelineno-17-8></a><span class=k>while</span> <span class=p>(</span><span class=nv>$true</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-17-9><a href=#__codelineno-17-9 id=__codelineno-17-9 name=__codelineno-17-9></a>
</span><span id=__span-17-10><a href=#__codelineno-17-10 id=__codelineno-17-10 name=__codelineno-17-10></a>  <span class=k>if</span> <span class=p>(</span><span class=nv>$skipResult</span> <span class=o>-gt</span> <span class=n>0</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-17-11><a href=#__codelineno-17-11 id=__codelineno-17-11 name=__codelineno-17-11></a>    <span class=nv>$graphResult</span> <span class=p>=</span> <span class=nb>Search-AzGraph</span> <span class=n>-Query</span> <span class=nv>$kqlQuery</span> <span class=n>-First</span> <span class=nv>$batchSize</span> <span class=n>-SkipToken</span> <span class=nv>$graphResult</span><span class=p>.</span><span class=n>SkipToken</span>
</span><span id=__span-17-12><a href=#__codelineno-17-12 id=__codelineno-17-12 name=__codelineno-17-12></a>  <span class=p>}</span>
</span><span id=__span-17-13><a href=#__codelineno-17-13 id=__codelineno-17-13 name=__codelineno-17-13></a>  <span class=k>else</span> <span class=p>{</span>
</span><span id=__span-17-14><a href=#__codelineno-17-14 id=__codelineno-17-14 name=__codelineno-17-14></a>    <span class=nv>$graphResult</span> <span class=p>=</span> <span class=nb>Search-AzGraph</span> <span class=n>-Query</span> <span class=nv>$kqlQuery</span> <span class=n>-First</span> <span class=nv>$batchSize</span>
</span><span id=__span-17-15><a href=#__codelineno-17-15 id=__codelineno-17-15 name=__codelineno-17-15></a>  <span class=p>}</span>
</span><span id=__span-17-16><a href=#__codelineno-17-16 id=__codelineno-17-16 name=__codelineno-17-16></a>
</span><span id=__span-17-17><a href=#__codelineno-17-17 id=__codelineno-17-17 name=__codelineno-17-17></a>  <span class=nv>$kqlResult</span> <span class=p>+=</span> <span class=nv>$graphResult</span><span class=p>.</span><span class=n>data</span>
</span><span id=__span-17-18><a href=#__codelineno-17-18 id=__codelineno-17-18 name=__codelineno-17-18></a>
</span><span id=__span-17-19><a href=#__codelineno-17-19 id=__codelineno-17-19 name=__codelineno-17-19></a>  <span class=k>if</span> <span class=p>(</span><span class=nv>$graphResult</span><span class=p>.</span><span class=n>data</span><span class=p>.</span><span class=n>Count</span> <span class=o>-lt</span> <span class=nv>$batchSize</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-17-20><a href=#__codelineno-17-20 id=__codelineno-17-20 name=__codelineno-17-20></a>    <span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-21><a href=#__codelineno-17-21 id=__codelineno-17-21 name=__codelineno-17-21></a>  <span class=p>}</span>
</span><span id=__span-17-22><a href=#__codelineno-17-22 id=__codelineno-17-22 name=__codelineno-17-22></a>  <span class=nv>$skipResult</span> <span class=p>+=</span> <span class=nv>$skipResult</span> <span class=p>+</span> <span class=nv>$batchSize</span>
</span><span id=__span-17-23><a href=#__codelineno-17-23 id=__codelineno-17-23 name=__codelineno-17-23></a><span class=p>}</span>
</span></code></pre></div> <h3 id=best-practices-for-writing-kql-queries><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#best-practices-for-writing-kql-queries><strong>Best Practices for Writing KQL Queries</strong></a></h3> <ol> <li><strong>Use <code>project</code> to Select Columns</strong>: Only select the columns you need to reduce the amount of data returned.</li> <li><strong>Use <code>where</code> to Filter Rows</strong>: Apply filters to reduce the number of rows processed.</li> <li><strong>Use <code>summarize</code> to Aggregate Data</strong>: Aggregate data to reduce the number of rows returned.</li> <li><strong>Use <code>join</code> to Combine Data</strong>: Combine data from different tables using the <code>join</code> operator.</li> <li><strong>Use <code>order by</code> to Sort Data</strong>: Sort data based on specific columns to make it easier to read.</li> </ol> <h3 id=limitations-of-kql><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#limitations-of-kql><strong>Limitations of KQL</strong></a></h3> <ol> <li><strong>No DDL Operations</strong>: KQL doesn't support Data Definition Language (DDL) operations like creating tables or indexes.</li> <li><strong>No DML Operations</strong>: KQL doesn't support Data Manipulation Language (DML) operations like inserting, updating, or deleting data.</li> <li><strong>Limited Data Types</strong>: KQL has a limited set of data types compared to SQL.</li> <li><strong>No Transactions</strong>: KQL doesn't support transactions, so you can't group multiple operations into a single transaction.</li> </ol> <h3 id=conclusion><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#conclusion><strong>Conclusion</strong></a></h3> <p>KQL is a potent tool for querying large datasets in Azure. Its SQL-like syntax makes it accessible for anyone familiar with SQL, and its rich set of features makes it a flexible solution for a variety of data processing needs. Practice writing KQL queries to uncover valuable insights from your Azure resources!</p> <h3 id=references><a class=toclink href=../../17/kusto-query-language-kql-for-azure-resource-graph/#references>References</a></h3> <ul> <li><a href=https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/sqlcheatsheet>SQL to Kusto Query Language cheat sheet</a></li> <li><a href=https://portal.azure.com/#view/Microsoft_OperationsManagementSuite_Workspace/LogsDemo.ReactView>Demo for play</a></li> </ul> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-07 00:00:00">April 7, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 4 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account><a href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/ class=toclink>How to use Azue ARC-enabled servers with managed identity to access to Azure Storage Account</a></h2> <p>In this demo we will show how to use Azure ARC-enabled servers with managed identity to access to Azure Storage Account.</p> <h3 id=prerequisites><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#prerequisites>Prerequisites</a></h3> <ul> <li>An Azure subscription. If you don't have an Azure subscription, create a <a href=https://azure.microsoft.com/en-us/free/ >free account</a> before you begin.</li> </ul> <h3 id=required-permissions><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#required-permissions>Required permissions</a></h3> <p>You'll need the following Azure built-in roles for different aspects of managing connected machines:</p> <ul> <li>To onboard machines, you must have the <a href=https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-connected-machine-onboarding>Azure Connected Machine Onboarding</a> or <a href=https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#contributor>Contributor</a> role for the resource group where you're managing the servers.</li> <li>To read, modify, and delete a machine, you must have the <a href=https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-connected-machine-resource-administrator>Azure Connected Machine Resource Administrator</a> role for the resource group.</li> <li>To select a resource group from the drop-down list when using the <strong>Generate script</strong> method, you'll also need the <a href=https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#reader>Reader</a> role for that resource group (or another role that includes <strong>Reader</strong> access).</li> </ul> <h3 id=register-azure-resource-providers><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#register-azure-resource-providers>Register Azure resource providers</a></h3> <p>To use Azure Arc-enabled servers with managed identity, you need to register the following resource providers:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a>az<span class=w> </span>account<span class=w> </span><span class=nb>set</span><span class=w> </span>--subscription<span class=w> </span><span class=s2>"{Your Subscription Name}"</span>
</span><span id=__span-18-2><a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a>az<span class=w> </span>provider<span class=w> </span>register<span class=w> </span>--namespace<span class=w> </span><span class=s1>'Microsoft.HybridCompute'</span>
</span><span id=__span-18-3><a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a>az<span class=w> </span>provider<span class=w> </span>register<span class=w> </span>--namespace<span class=w> </span><span class=s1>'Microsoft.GuestConfiguration'</span>
</span><span id=__span-18-4><a href=#__codelineno-18-4 id=__codelineno-18-4 name=__codelineno-18-4></a>az<span class=w> </span>provider<span class=w> </span>register<span class=w> </span>--namespace<span class=w> </span><span class=s1>'Microsoft.HybridConnectivity'</span>
</span><span id=__span-18-5><a href=#__codelineno-18-5 id=__codelineno-18-5 name=__codelineno-18-5></a>az<span class=w> </span>provider<span class=w> </span>register<span class=w> </span>--namespace<span class=w> </span><span class=s1>'Microsoft.AzureArcData'</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Microsoft.AzureArcData (if you plan to Arc-enable SQL Servers) Microsoft.Compute (for Azure Update Manager and automatic extension upgrades)</p> </div> <h3 id=networking-requirements><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#networking-requirements>Networking requirements</a></h3> <p>The Azure Connected Machine agent for Linux and Windows communicates outbound securely to Azure Arc over TCP port 443. In this demo, we have use <a href=https://learn.microsoft.com/en-us/azure/azure-arc/servers/private-link-security#network-configuration>Azure Private Link</a>. </p> <h3 id=azure-arc-enabled-enabled-server><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#azure-arc-enabled-enabled-server>Azure ARC-enabled enabled server</a></h3> <p>We use <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_privatelink>Use Azure Private Link to securely connect networks to Azure Arc-enabled servers</a> to achieve this.</p> <p>Some tips:</p> <ul> <li> <p>If you have any issue registerin de VM: generate a script to register a machine with Azure Arc following that instructions <a href=https://learn.microsoft.com/en-us/azure/azure-arc/servers/learn/quick-enable-hybrid-vm#generate-installation-script>here</a></p> </li> <li> <p>If you have an error that says "Path C:\ProgramData\AzureConnectedMachineAgent\Log\himds.log is busy. Retrying..." you can use the following command to resolve it if you know that you are doing:</p> </li> </ul> <p><div class="language-powershell highlight"><pre><span></span><code><span id=__span-19-1><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a> <span class=p>(</span><span class=nb>get-wmiobject</span> <span class=n>-class</span> <span class=n>win32_product</span> <span class=p>|</span> <span class=nb>where </span><span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=n>name</span> <span class=o>-like</span> <span class=s2>"Azure *"</span><span class=p>}).</span><span class=n>uninstall</span><span class=p>()</span> 
</span></code></pre></div> - Review /etc/hosts file and add the following entries:</p> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-20-1><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a><span class=nv>$Env:PEname</span> <span class=p>=</span> <span class=s2>"myprivatelink"</span>
</span><span id=__span-20-2><a href=#__codelineno-20-2 id=__codelineno-20-2 name=__codelineno-20-2></a><span class=nv>$Env:resourceGroup</span> <span class=p>=</span> <span class=s2>"myResourceGroup"</span>
</span><span id=__span-20-3><a href=#__codelineno-20-3 id=__codelineno-20-3 name=__codelineno-20-3></a><span class=nv>$file</span> <span class=p>=</span> <span class=s2>"C:\Windows\System32\drivers\etc\hosts"</span>
</span><span id=__span-20-4><a href=#__codelineno-20-4 id=__codelineno-20-4 name=__codelineno-20-4></a>
</span><span id=__span-20-5><a href=#__codelineno-20-5 id=__codelineno-20-5 name=__codelineno-20-5></a><span class=nv>$gisfqdn</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=s1>'[0].privateDnsZoneConfigs[0].recordSets[0].fqdn'</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-6><a href=#__codelineno-20-6 id=__codelineno-20-6 name=__codelineno-20-6></a><span class=nv>$gisIP</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>ipAddresses</span><span class=p>[</span><span class=n>0</span><span class=p>]</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-7><a href=#__codelineno-20-7 id=__codelineno-20-7 name=__codelineno-20-7></a><span class=nv>$hisfqdn</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>fqdn</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-8><a href=#__codelineno-20-8 id=__codelineno-20-8 name=__codelineno-20-8></a><span class=nv>$hisIP</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>ipAddresses</span><span class=p>[</span><span class=n>0</span><span class=p>]</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-9><a href=#__codelineno-20-9 id=__codelineno-20-9 name=__codelineno-20-9></a><span class=nv>$agentfqdn</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>fqdn</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-10><a href=#__codelineno-20-10 id=__codelineno-20-10 name=__codelineno-20-10></a><span class=nv>$agentIp</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>ipAddresses</span><span class=p>[</span><span class=n>0</span><span class=p>]</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-11><a href=#__codelineno-20-11 id=__codelineno-20-11 name=__codelineno-20-11></a><span class=nv>$gasfqdn</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>fqdn</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-12><a href=#__codelineno-20-12 id=__codelineno-20-12 name=__codelineno-20-12></a><span class=nv>$gasIp</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>1</span><span class=p>].</span><span class=n>ipAddresses</span><span class=p>[</span><span class=n>0</span><span class=p>]</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-13><a href=#__codelineno-20-13 id=__codelineno-20-13 name=__codelineno-20-13></a><span class=nv>$dpfqdn</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>2</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>fqdn</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-14><a href=#__codelineno-20-14 id=__codelineno-20-14 name=__codelineno-20-14></a><span class=nv>$dpIp</span> <span class=p>=</span> <span class=p>(</span><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>dns-zone-group</span> <span class=n>list</span> <span class=p>-</span><span class=n>-endpoint-name</span> <span class=nv>$Env:PEname</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$Env:resourceGroup</span> <span class=n>-o</span> <span class=n>json</span> <span class=p>-</span><span class=n>-query</span> <span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>privateDnsZoneConfigs</span><span class=p>[</span><span class=n>2</span><span class=p>].</span><span class=n>recordSets</span><span class=p>[</span><span class=n>0</span><span class=p>].</span><span class=n>ipAddresses</span><span class=p>[</span><span class=n>0</span><span class=p>]</span> <span class=n>-o</span> <span class=n>json</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s1>'.privatelink'</span><span class=p>,</span><span class=s1>''</span><span class=p>).</span><span class=n>replace</span><span class=p>(</span><span class=s2>"</span><span class=se>`"</span><span class=s2>"</span><span class=p>,</span><span class=s2>""</span><span class=p>)</span>
</span><span id=__span-20-15><a href=#__codelineno-20-15 id=__codelineno-20-15 name=__codelineno-20-15></a>
</span><span id=__span-20-16><a href=#__codelineno-20-16 id=__codelineno-20-16 name=__codelineno-20-16></a><span class=nv>$hostfile</span> <span class=p>+=</span> <span class=s2>"$gisIP $gisfqdn"</span>
</span><span id=__span-20-17><a href=#__codelineno-20-17 id=__codelineno-20-17 name=__codelineno-20-17></a><span class=nv>$hostfile</span> <span class=p>+=</span> <span class=s2>"$hisIP $hisfqdn"</span>
</span><span id=__span-20-18><a href=#__codelineno-20-18 id=__codelineno-20-18 name=__codelineno-20-18></a><span class=nv>$hostfile</span> <span class=p>+=</span> <span class=s2>"$agentIP $agentfqdn"</span>
</span><span id=__span-20-19><a href=#__codelineno-20-19 id=__codelineno-20-19 name=__codelineno-20-19></a><span class=nv>$hostfile</span> <span class=p>+=</span> <span class=s2>"$gasIP $gasfqdn"</span>
</span><span id=__span-20-20><a href=#__codelineno-20-20 id=__codelineno-20-20 name=__codelineno-20-20></a><span class=nv>$hostfile</span> <span class=p>+=</span> <span class=s2>"$dpIP $dpfqdn"</span>
</span></code></pre></div> <h3 id=storage-account-configuration><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#storage-account-configuration>Storage Account configuration</a></h3> <h4 id=create-a-storage-account-with-static-website-enabled><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#create-a-storage-account-with-static-website-enabled>Create a Storage Account with static website enabled</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-21-1><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a><span class=nv>$resourceGroup</span> <span class=p>=</span> <span class=s2>"myResourceGroup"</span>
</span><span id=__span-21-2><a href=#__codelineno-21-2 id=__codelineno-21-2 name=__codelineno-21-2></a><span class=nv>$location</span> <span class=p>=</span> <span class=s2>"eastus"</span>
</span><span id=__span-21-3><a href=#__codelineno-21-3 id=__codelineno-21-3 name=__codelineno-21-3></a><span class=nv>$storageAccount</span> <span class=p>=</span> <span class=s2>"mystorageaccount"</span>
</span><span id=__span-21-4><a href=#__codelineno-21-4 id=__codelineno-21-4 name=__codelineno-21-4></a><span class=nv>$indexDocument</span> <span class=p>=</span> <span class=s2>"index.html"</span>
</span><span id=__span-21-5><a href=#__codelineno-21-5 id=__codelineno-21-5 name=__codelineno-21-5></a><span class=n>az</span> <span class=nb>group </span><span class=n>create</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-location</span> <span class=nv>$location</span>
</span><span id=__span-21-6><a href=#__codelineno-21-6 id=__codelineno-21-6 name=__codelineno-21-6></a><span class=n>az</span> <span class=n>storage</span> <span class=n>account</span> <span class=n>create</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$storageAccount</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-location</span> <span class=nv>$location</span> <span class=p>-</span><span class=n>-sku</span> <span class=n>Standard_LRS</span>
</span><span id=__span-21-7><a href=#__codelineno-21-7 id=__codelineno-21-7 name=__codelineno-21-7></a><span class=n>az</span> <span class=n>storage</span> <span class=n>blob</span> <span class=n>service-properties</span> <span class=n>update</span> <span class=p>-</span><span class=n>-account-name</span> <span class=nv>$storageAccount</span> <span class=p>-</span><span class=n>-static-website</span> <span class=p>-</span><span class=n>-index-document</span> <span class=nv>$indexDocument</span>
</span></code></pre></div> <h4 id=add-private-endpoints-to-the-storage-accoun-for-blob-and-static-website><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#add-private-endpoints-to-the-storage-accoun-for-blob-and-static-website>Add private endpoints to the storage accoun for blob and static website</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-22-1><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a><span class=nv>$resourceGroup</span> <span class=p>=</span> <span class=s2>"myResourceGroup"</span>
</span><span id=__span-22-2><a href=#__codelineno-22-2 id=__codelineno-22-2 name=__codelineno-22-2></a><span class=nv>$storageAccount</span> <span class=p>=</span> <span class=s2>"mystorageaccount"</span>
</span><span id=__span-22-3><a href=#__codelineno-22-3 id=__codelineno-22-3 name=__codelineno-22-3></a><span class=nv>$privateEndpointName</span> <span class=p>=</span> <span class=s2>"myprivatelink"</span>
</span><span id=__span-22-4><a href=#__codelineno-22-4 id=__codelineno-22-4 name=__codelineno-22-4></a><span class=nv>$location</span> <span class=p>=</span> <span class=s2>"eastus"</span>
</span><span id=__span-22-5><a href=#__codelineno-22-5 id=__codelineno-22-5 name=__codelineno-22-5></a><span class=nv>$vnetName</span> <span class=p>=</span> <span class=s2>"myVnet"</span>
</span><span id=__span-22-6><a href=#__codelineno-22-6 id=__codelineno-22-6 name=__codelineno-22-6></a><span class=nv>$subnetName</span> <span class=p>=</span> <span class=s2>"mySubnet"</span>
</span><span id=__span-22-7><a href=#__codelineno-22-7 id=__codelineno-22-7 name=__codelineno-22-7></a><span class=nv>$subscriptionId</span> <span class=p>=</span> <span class=s2>"{subscription-id}"</span>
</span><span id=__span-22-8><a href=#__codelineno-22-8 id=__codelineno-22-8 name=__codelineno-22-8></a><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>create</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$privateEndpointName</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-vnet-name</span> <span class=nv>$vnetName</span> <span class=p>-</span><span class=n>-subnet</span> <span class=nv>$subnetName</span> <span class=p>-</span><span class=n>-private-connection-resource-id</span> <span class=s2>"/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span> <span class=p>-</span><span class=n>-group-id</span> <span class=n>blob</span> <span class=p>-</span><span class=n>-connection-name</span> <span class=nv>$privateEndpointName</span> <span class=p>-</span><span class=n>-location</span> <span class=nv>$location</span>
</span><span id=__span-22-9><a href=#__codelineno-22-9 id=__codelineno-22-9 name=__codelineno-22-9></a><span class=n>az</span> <span class=n>network</span> <span class=n>private-endpoint</span> <span class=n>create</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$privateEndpointName</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-vnet-name</span> <span class=nv>$vnetName</span> <span class=p>-</span><span class=n>-subnet</span> <span class=nv>$subnetName</span> <span class=p>-</span><span class=n>-private-connection-resource-id</span> <span class=s2>"/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span> <span class=p>-</span><span class=n>-group-id</span> <span class=n>web</span> <span class=p>-</span><span class=n>-connection-name</span> <span class=nv>$privateEndpointName</span> <span class=p>-</span><span class=n>-location</span> <span class=nv>$location</span>
</span></code></pre></div> <h4 id=disable-public-access-to-the-storage-account-except-for-your-ip><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#disable-public-access-to-the-storage-account-except-for-your-ip>Disable public access to the storage account except for your ip</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-23-1><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a><span class=nv>$resourceGroup</span> <span class=p>=</span> <span class=s2>"myResourceGroup"</span>
</span><span id=__span-23-2><a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a><span class=nv>$storageAccount</span> <span class=p>=</span> <span class=s2>"mystorageaccount"</span>
</span><span id=__span-23-3><a href=#__codelineno-23-3 id=__codelineno-23-3 name=__codelineno-23-3></a><span class=nv>$ipAddress</span> <span class=p>=</span> <span class=s2>"myIpAddress"</span>
</span><span id=__span-23-4><a href=#__codelineno-23-4 id=__codelineno-23-4 name=__codelineno-23-4></a><span class=n>az</span> <span class=n>storage</span> <span class=n>account</span> <span class=n>update</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$storageAccount</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-bypass</span> <span class=s2>"AzureServices,Logging,Metrics"</span> <span class=p>-</span><span class=n>-default-action</span> <span class=n>Deny</span>
</span><span id=__span-23-5><a href=#__codelineno-23-5 id=__codelineno-23-5 name=__codelineno-23-5></a><span class=n>az</span> <span class=n>storage</span> <span class=n>account</span> <span class=n>network-rule</span> <span class=n>add</span> <span class=p>-</span><span class=n>-account-name</span> <span class=nv>$storageAccount</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-ip-address</span> <span class=nv>$ipAddress</span>
</span></code></pre></div> <h4 id=assign-the-storage-blob-data-contributor-role-to-the-managed-identity-of-the-azure-arc-enabled-server><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#assign-the-storage-blob-data-contributor-role-to-the-managed-identity-of-the-azure-arc-enabled-server>Assign the Storage Blob Data Contributor role to the managed identity of the Azure ARC-enabled server</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-24-1><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a><span class=nv>$resourceGroup</span> <span class=p>=</span> <span class=s2>"myResourceGroup"</span>
</span><span id=__span-24-2><a href=#__codelineno-24-2 id=__codelineno-24-2 name=__codelineno-24-2></a><span class=nv>$storageAccount</span> <span class=p>=</span> <span class=s2>"mystorageaccount"</span>
</span><span id=__span-24-3><a href=#__codelineno-24-3 id=__codelineno-24-3 name=__codelineno-24-3></a><span class=nv>$serverName</span> <span class=p>=</span> <span class=s2>"myserver"</span>
</span><span id=__span-24-4><a href=#__codelineno-24-4 id=__codelineno-24-4 name=__codelineno-24-4></a><span class=nv>$managedIdentity</span> <span class=p>=</span> <span class=n>az</span> <span class=n>resource</span> <span class=n>show</span> <span class=p>-</span><span class=n>-resource-group</span> <span class=nv>$resourceGroup</span> <span class=p>-</span><span class=n>-name</span> <span class=nv>$serverName</span> <span class=p>-</span><span class=n>-resource-type</span> <span class=s2>"Microsoft.HybridCompute/machines"</span> <span class=p>-</span><span class=n>-query</span> <span class=s2>"identity.principalId"</span> <span class=p>-</span><span class=n>-output</span> <span class=n>tsv</span>
</span><span id=__span-24-5><a href=#__codelineno-24-5 id=__codelineno-24-5 name=__codelineno-24-5></a><span class=n>az</span> <span class=n>role</span> <span class=n>assignment</span> <span class=n>create</span> <span class=p>-</span><span class=n>-role</span> <span class=s2>"Storage Blob Data Contributor"</span> <span class=p>-</span><span class=n>-assignee-object-id</span> <span class=nv>$managedIdentity</span> <span class=p>-</span><span class=n>-scope</span> <span class=s2>"/subscriptions/{subscription-id}/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span>
</span></code></pre></div> <h3 id=download-azcopy-install-it-and-copy-something-to-web-in-the-storage-account><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#download-azcopy-install-it-and-copy-something-to-web-in-the-storage-account>Download azcopy, install it and copy something to $web in the storage account</a></h3> <h4 id=download-azcopy-in-the-vm><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#download-azcopy-in-the-vm>Download azcopy in the vm</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-25-1><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a><span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=s2>"https://aka.ms/downloadazcopy-v10-windows"</span> <span class=n>-OutFile</span> <span class=n>AzCopy</span><span class=p>.</span><span class=n>zip</span>
</span><span id=__span-25-2><a href=#__codelineno-25-2 id=__codelineno-25-2 name=__codelineno-25-2></a>
</span><span id=__span-25-3><a href=#__codelineno-25-3 id=__codelineno-25-3 name=__codelineno-25-3></a><span class=nb>Expand-Archive</span> <span class=n>AzCopy</span><span class=p>.</span><span class=n>zip</span> <span class=n>-DestinationPath</span> <span class=nv>$env:ProgramFiles</span>
</span><span id=__span-25-4><a href=#__codelineno-25-4 id=__codelineno-25-4 name=__codelineno-25-4></a>
</span><span id=__span-25-5><a href=#__codelineno-25-5 id=__codelineno-25-5 name=__codelineno-25-5></a><span class=nv>$env:Path</span> <span class=p>+=</span> <span class=s2>";$env:ProgramFiles\azcopy"</span>
</span></code></pre></div> <h4 id=copy-something-to-web-in-the-storage-account><a class=toclink href=../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#copy-something-to-web-in-the-storage-account>Copy something to $web in the storage account</a></h4> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-26-1><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a><span class=nv>$storageAccount</span> <span class=p>=</span> <span class=s2>"mystorageaccount"</span>
</span><span id=__span-26-2><a href=#__codelineno-26-2 id=__codelineno-26-2 name=__codelineno-26-2></a><span class=nv>$source</span> <span class=p>=</span> <span class=s2>"C:\Users\Public\Documents\myFile.txt"</span>
</span><span id=__span-26-3><a href=#__codelineno-26-3 id=__codelineno-26-3 name=__codelineno-26-3></a><span class=nv>$destination</span> <span class=p>=</span> <span class=s2>"https://$storageAccount.blob.core.windows.net/\$web/myFile.txt"</span>
</span><span id=__span-26-4><a href=#__codelineno-26-4 id=__codelineno-26-4 name=__codelineno-26-4></a><span class=n>azcopy</span> <span class=n>login</span> <span class=p>-</span><span class=n>-identity</span>
</span><span id=__span-26-5><a href=#__codelineno-26-5 id=__codelineno-26-5 name=__codelineno-26-5></a><span class=n>azcopy</span> <span class=nb>copy </span><span class=nv>$source</span> <span class=nv>$destination</span>
</span></code></pre></div> <p>Now you can check the file in the static website of the storage account.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-06 00:00:00">April 6, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/azure-services/ class=md-meta__link>Azure Services</a></li> <li class=md-meta__item> 4 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=azure-arc><a href=../../06/azure-arc/ class=toclink>Azure ARC</a></h2> <p>Azure ARC is a service that extends Azure management capabilities to any infrastructure. It allows you to manage resources running on-premises, at the edge, or in multi-cloud environments using the same Azure management tools, security, and compliance policies that you use in Azure. Azure ARC enables you to manage and govern your resources consistently across all environments, providing a unified control plane for your hybrid cloud infrastructure. Let's explore how Azure ARC works and how you can leverage it to manage your resources effectively.</p> <h3 id=azure-arc-overview><a class=toclink href=../../06/azure-arc/#azure-arc-overview>Azure ARC Overview</a></h3> <p><strong>Azure ARC</strong> is a service that extends Azure management capabilities to any infrastructure. It allows you to manage resources running outside of Azure using the same Azure management tools, security, and compliance policies that you use in Azure. Azure ARC provides a unified control plane for managing resources across on-premises, multi-cloud, and edge environments, enabling you to govern your resources consistently.</p> <p>Azure ARC enables you to:</p> <ul> <li><strong>Manage resources</strong>: Azure ARC allows you to manage resources running on-premises, at the edge, or in multi-cloud environments using Azure management tools like Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li> <li><strong>Governance</strong>: Azure ARC provides a unified control plane for managing and governing resources across all environments, enabling you to enforce security and compliance policies consistently.</li> <li><strong>Security</strong>: Azure ARC extends Azure security capabilities to resources running outside of Azure, enabling you to protect your resources with Azure security features like Azure Security Center and Azure Defender.</li> <li><strong>Compliance</strong>: Azure ARC enables you to enforce compliance policies across all environments, ensuring that your resources meet regulatory requirements and organizational standards.</li> </ul> <h3 id=azure-arc-components><a class=toclink href=../../06/azure-arc/#azure-arc-components>Azure ARC Components</a></h3> <p>Azure ARC consists of the following components:</p> <ul> <li><strong>Azure ARC-enabled servers</strong>: Azure ARC-enabled servers allow you to manage and govern servers running on-premises or at the edge using Azure management tools. You can connect your servers to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li> <li><strong>Azure ARC-enabled Kubernetes clusters</strong>: Azure ARC-enabled Kubernetes clusters allow you to manage and govern Kubernetes clusters running on-premises or in other clouds using Azure management tools. You can connect your Kubernetes clusters to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li> <li><strong>Azure ARC-enabled data services</strong>: Azure ARC-enabled data services allow you to manage and govern data services running on-premises or in other clouds using Azure management tools. You can connect your data services to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li> <li><strong>SQL Server enabled by Azure Arc</strong>: SQL Server enabled by Azure Arc allows you to run SQL Server on any infrastructure using Azure management tools. You can connect your SQL Server instances to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li> <li><strong>Azure Arc-enabled private clouds</strong>: Azure Arc resource bridge hosts other components such as custom locations, cluster extensions, and other Azure Arc agents in order to deliver the level of functionality with the private cloud infrastructures it supports.</li> </ul> <h3 id=azure-arc-use-cases><a class=toclink href=../../06/azure-arc/#azure-arc-use-cases>Azure ARC Use Cases</a></h3> <p>Azure ARC can be used in a variety of scenarios to manage and govern resources across on-premises, multi-cloud, and edge environments. Some common use cases for Azure ARC include:</p> <ul> <li><strong>Hybrid cloud management</strong>: Azure ARC enables you to manage resources consistently across on-premises, multi-cloud, and edge environments using the same Azure management tools and policies.</li> <li><strong>Security and compliance</strong>: Azure ARC allows you to enforce security and compliance policies consistently across all environments, ensuring that your resources meet regulatory requirements and organizational standards.</li> <li><strong>Resource governance</strong>: Azure ARC provides a unified control plane for managing and governing resources across all environments, enabling you to enforce policies and monitor resource health and performance.</li> <li><strong>Application modernization</strong>: Azure ARC enables you to manage and govern Kubernetes clusters and data services running on-premises or in other clouds, allowing you to modernize your applications and infrastructure.</li> </ul> <h3 id=getting-started-with-azure-arc><a class=toclink href=../../06/azure-arc/#getting-started-with-azure-arc>Getting Started with Azure ARC</a></h3> <p>To get started with Azure ARC, you need to:</p> <ol> <li><strong>Connect your resources</strong>: Connect your servers, Kubernetes clusters, or data services to Azure ARC using the Azure ARC agent.</li> <li><strong>Manage your resources</strong>: Use Azure management tools like Azure Policy, Azure Monitor, and Microsoft Defender for Cloud to manage and govern your resources consistently across all environments.</li> <li><strong>Enforce security and compliance</strong>: Use Azure security features like Microsoft Defender for Cloud to protect your resources and enforce security and compliance policies.</li> </ol> <p>By leveraging Azure ARC, you can manage and govern your resources consistently across on-premises, multi-cloud, and edge environments, providing a unified control plane for your hybrid cloud infrastructure. Azure ARC enables you to enforce security and compliance policies consistently, ensuring that your resources meet regulatory requirements and organizational standards. </p> <h3 id=conclusion><a class=toclink href=../../06/azure-arc/#conclusion>Conclusion</a></h3> <p>Azure ARC is a powerful service that extends Azure management capabilities to any infrastructure, enabling you to manage and govern resources consistently across on-premises, multi-cloud, and edge environments. By leveraging Azure ARC, you can enforce security and compliance policies consistently, ensuring that your resources meet regulatory requirements and organizational standards. Azure ARC provides a unified control plane for managing and governing resources, enabling you to manage your hybrid cloud infrastructure effectively.</p> <p>For more information on Azure ARC, visit the <a href=https://docs.microsoft.com/en-us/azure/azure-arc/ >Azure ARC documentation</a>.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-05 00:00:00">April 5, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/learning/ class=md-meta__link>Learning</a></li> <li class=md-meta__item> 6 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=microsoft-azure-certifications><a href=../../05/microsoft-azure-certifications/ class=toclink>Microsoft Azure Certifications</a></h2> <p>Microsoft offers a wide range of certifications for IT professionals who want to demonstrate their expertise in Microsoft technologies. These certifications cover a variety of topics, including Azure, Office 365, Windows Server, and more.</p> <p>Microsoft divide this certifications into different categories, such as:</p> <ul> <li>Infrastructure</li> <li>Data and AI</li> <li>Digital app and innovation</li> <li>Modern work</li> <li>Business applications</li> <li>Security</li> </ul> <p>Inside of each category, you can find different certification levels:</p> <ul> <li>Fundamentals: This level is designed for individuals who are new to the technology and want to demonstrate their knowledge of the basics.</li> <li>Role-based: This level is designed for individuals who want to demonstrate their expertise in a specific role, such as Azure Administrator or Data Engineer.</li> <li>Specialty: This level is designed for individuals who want to demonstrate their expertise in a specific skill, such as Azure Virtual Desktop or Azure SAP.</li> </ul> <p>In the case of role-based certifications, Microsoft offers different levels of certification, such as:</p> <ul> <li>Associate: This level is designed for individuals who have some experience in the technology and want to demonstrate their expertise in a specific role.</li> <li>Expert: This level is designed for individuals who have extensive experience in the technology and want to demonstrate their expertise in a specific role.</li> </ul> <p>Allways is a good idea to start with the fundamentals certifications, and then move on to the role-based certifications that are relevant to your career goals.</p> <p>In the majority of cases, you need associate certifications to get expert certifications.</p> <h3 id=azure-certifications><a class=toclink href=../../05/microsoft-azure-certifications/#azure-certifications><strong>Azure Certifications</strong></a></h3> <p>Here's a table summarizing the Azure Certifications and their description:</p> <table> <thead> <tr> <th><strong>Certification</strong></th> <th><strong>Exam required</strong></th> <th><strong>Description</strong></th> <th><strong>url</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Azure Administrator Associate</strong></td> <td>AZ-104</td> <td>The Azure Administrator certification is designed for individuals who want to demonstrate their expertise in managing Azure resources. This certification is ideal for IT professionals who are responsible for implementing, monitoring, and maintaining Azure solutions.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-administrator</td> </tr> <tr> <td><strong>Azure Developer Associate</strong></td> <td>AZ-204</td> <td>The Azure Developer certification is designed for individuals who want to demonstrate their expertise in developing applications on Azure. This certification is ideal for software developers who want to build and deploy cloud-based applications using Azure services.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-developer</td> </tr> <tr> <td><strong>Azure Data Engineer Associate</strong></td> <td>DP-203</td> <td>The Azure Data Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing data solutions on Azure. This certification is ideal for data professionals who are responsible for building and maintaining data pipelines and data warehouses on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-data-engineer</td> </tr> <tr> <td><strong>Azure Database Administrator Associate</strong></td> <td>DP-300</td> <td>The Azure Database Administrator certification is designed for individuals who want to demonstrate their expertise in managing Azure databases. This certification is ideal for database administrators who are responsible for designing, implementing, and maintaining databases on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-database-administrator</td> </tr> <tr> <td><strong>DevOps Engineer Expert</strong></td> <td>AZ-400</td> <td>The Azure DevOps Engineer certification is designed for individuals who want to demonstrate their expertise in implementing DevOps practices on Azure. This certification is ideal for IT professionals who are responsible for building, testing, and deploying applications using Azure DevOps.</td> <td>https://learn.microsoft.com/en-us/certifications/devops-engineer</td> </tr> <tr> <td><strong>Azure Security Engineer Associate</strong></td> <td>AZ-500</td> <td>The Azure Security Engineer certification is designed for individuals who want to demonstrate their expertise in securing Azure resources. This certification is ideal for IT professionals who are responsible for implementing security controls and monitoring security events on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-security-engineer</td> </tr> <tr> <td><strong>Azure Network Engineer Associate</strong></td> <td>AZ-700</td> <td>The Azure Network Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing network solutions on Azure. This certification is ideal for network engineers who are responsible for building and maintaining network infrastructure on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-network-engineer</td> </tr> <tr> <td><strong>Windows Server Hybrid Administrator Associate</strong></td> <td>AZ-800 AZ-801</td> <td>The Windows Server Hybrid Administrator certification is designed for individuals who want to demonstrate their expertise in managing Windows Server resources on Azure. This certification is ideal for IT professionals who are responsible for implementing, monitoring, and maintaining Windows Server solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/windows-server-hybrid-administrator</td> </tr> <tr> <td><strong>Fabric Analytics Engineer Associate</strong></td> <td>DP-600</td> <td>The Fabric Analytics Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing analytics solutions on Azure. This certification is ideal for data professionals who are responsible for building and maintaining analytics solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/fabric-analytics-engineer</td> </tr> <tr> <td><strong>Azure AI Engineer Associate</strong></td> <td>AI-102</td> <td>The Azure AI Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing AI solutions on Azure. This certification is ideal for data scientists and AI developers who want to build and deploy AI models using Azure services.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-ai-engineer</td> </tr> <tr> <td><strong>Azure Data Scientist Associate</strong></td> <td>DP-100</td> <td>The Azure Data Scientist certification is designed for individuals who want to demonstrate their expertise in designing and implementing data science solutions on Azure. This certification is ideal for data scientists who are responsible for building and maintaining data science solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-data-scientist</td> </tr> <tr> <td><strong>Azure Enterprise Data Analyst Associate</strong></td> <td>DP-500</td> <td>The Azure Enterprise Data Analyst certification is designed for individuals who want to demonstrate their expertise in designing and implementing data analysis solutions on Azure. This certification is ideal for data analysts who are responsible for building and maintaining data analysis solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-enterprise-data-analyst</td> </tr> <tr> <td><strong>Azure Solutions Architect Expert</strong></td> <td>AZ-305</td> <td>The Azure Solutions Architect certification is designed for individuals who want to demonstrate their expertise in designing and implementing solutions on Azure. This certification is ideal for IT professionals who are responsible for designing and implementing cloud-based solutions using Azure services.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-solutions-architect</td> </tr> <tr> <td><strong>Azure for SAP Workloads Specialty</strong></td> <td>AZ-120</td> <td>The Azure for SAP Workloads certification is designed for individuals who want to demonstrate their expertise in deploying and managing SAP workloads on Azure. This certification is ideal for IT professionals who are responsible for implementing and maintaining SAP solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-for-sap-workloads</td> </tr> <tr> <td><strong>Azure Virtual Desktop Specialty</strong></td> <td>AZ-140</td> <td>The Azure Virtual Desktop certification is designed for individuals who want to demonstrate their expertise in deploying and managing virtual desktop solutions on Azure. This certification is ideal for IT professionals who are responsible for implementing and maintaining virtual desktop solutions on Azure.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-virtual-desktop</td> </tr> <tr> <td><strong>Azure Cosmos DB Developer Specialty</strong></td> <td>DP-420</td> <td>The Azure Cosmos DB Developer certification is designed for individuals who want to demonstrate their expertise in developing applications that use Azure Cosmos DB. This certification is ideal for software developers who want to build and deploy applications that use Azure Cosmos DB.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-cosmos-db-developer</td> </tr> <tr> <td><strong>Azure Fundamentals</strong></td> <td>AZ-900</td> <td>The Azure Fundamentals certification is designed for individuals who are new to Azure and want to demonstrate their knowledge of the platform. This certification is a great starting point for anyone who wants to learn more about Azure and how it can help them build and deploy applications in the cloud.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-fundamentals</td> </tr> <tr> <td><strong>Azure AI Fundamentals</strong></td> <td>AI-900</td> <td>The Azure AI Fundamentals certification is designed for individuals who want to demonstrate their knowledge of AI concepts and how they can be applied to Azure services. This certification is ideal for anyone who wants to learn more about AI and how it can be used to build intelligent applications.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-ai-fundamentals</td> </tr> <tr> <td><strong>Azure Data Fundamentals</strong></td> <td>DP-900</td> <td>The Azure Data Fundamentals certification is designed for individuals who want to demonstrate their knowledge of data concepts and how they can be applied to Azure services. This certification is ideal for anyone who wants to learn more about data and how it can be used to build data-driven applications.</td> <td>https://learn.microsoft.com/en-us/certifications/azure-data-fundamentals</td> </tr> </tbody> </table> <p>You can find more information about Microsoft certifications on the <a href=https://aka.ms/CertificationsPoster>Microsoft Certification Poster</a> and in the <a href=https://learn.microsoft.com/en-us/certifications/ >Microsoft Learning</a> website.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img alt="Rafael Fernández" src=https://avatars.githubusercontent.com/u/39990341> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-04-04 00:00:00">April 4, 2024</time></li> <li class=md-meta__item> in <a href=../../../../category/security/ class=md-meta__link>Security</a></li> <li class=md-meta__item> 4 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services><a href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/ class=toclink>Privileged Access Management (PAM) Strategy with Microsoft Entra ID and some Azure Services</a></h2> <p>Today, I'd like to share a brief of a recommended strategy for Privileged Access Management (PAM) of other vendors with Microsoft Entra ID and some Azure Services. This strategy is divided into seven phases:</p> <pre class=mermaid><code>
graph LR;
    A[Phase 1: Set Policy] 
    C[Phase 2: The Process of Discovery]
    E[Phase 3: Protect Credentials]
    G[Phase 4: Secure Privileged Access]
    I[Phase 5: Least Privilege]
    K[Phase 6: Control All Applications]
    M[Phase 7: Detect and Respond]

    A--&gt;C
    C--&gt;E
    E--&gt;G
    G--&gt;I
    I--&gt;K
    K--&gt;M
    M--&gt;A

    classDef phase fill:#f9f,stroke:#333,stroke-width:2px;
    class A,C,E,G,I,K,M phase;

</code></pre> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Be hybrid, be secure with a single control plane, use Azure ARC to inherit the same security and compliance policies across your on-premises, multi-cloud, and edge environments as in Azure.</p> </div> <h3 id=phase-1-set-policy><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-1-set-policy><strong>Phase 1: Set Policy</strong></a></h3> <p>The first step in any PAM strategy is to establish a clear policy. This policy should define who has access to what, when they have access, and what they can do with that access. It should also include guidelines for password management and multi-factor authentication. For example:</p> <ul> <li>Define clear access control policies.</li> <li>Establish guidelines for password management and multi-factor authentication.</li> <li>Regularly review and update the policy to reflect changes in the organization.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Azure Policy</strong> to define and manage policies for your Azure environment.</li> <li>Use <strong>Microsoft Entra multifactor authentication</strong> for implementing multi-factor authentication.</li> </ul> <h3 id=phase-2-the-process-of-discovery><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-2-the-process-of-discovery><strong>Phase 2: The Process of Discovery</strong></a></h3> <p>In this phase, we identify all the privileged accounts across the organization. This includes service accounts, local administrative accounts, domain administrative accounts, emergency accounts, and application accounts. For example:</p> <ul> <li>Use automated tools to identify all privileged accounts across the organization.</li> <li>Regularly update the inventory of privileged accounts.</li> <li>Identify any accounts that are no longer in use and deactivate them.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra Privileged Identity Management</strong> to discover, restrict and monitor administrators and their access to resources and provide just-in-time access when needed.</li> </ul> <h3 id=phase-3-protect-credentials><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-3-protect-credentials><strong>Phase 3: Protect Credentials</strong></a></h3> <p>Once we've identified all privileged accounts, we need to ensure that these credentials are stored securely. This could involve using a secure vault, regularly rotating passwords, and using unique passwords for each account. For example:</p> <ul> <li>Store credentials in a secure vault.</li> <li>Implement regular password rotation.</li> <li>Use unique passwords for each account.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Azure Key Vault</strong> to safeguard cryptographic keys and other secrets used by your apps and services and <a href="https://learn.microsoft.com/en-us/azure/key-vault/secrets/tutorial-rotation-dual?tabs=azure-cli">rotate secrets regularly</a>.</li> <li>Implement <strong>Microsoft Entra ID Password Protection</strong> to protect against weak passwords that can be easily guessed or cracked.</li> </ul> <h3 id=phase-4-secure-privileged-access><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-4-secure-privileged-access><strong>Phase 4: Secure Privileged Access</strong></a></h3> <p>Securing privileged access involves implementing controls to prevent unauthorized access. This could include limiting the number of privileged accounts, implementing least privilege, and using just-in-time access. For example:</p> <ul> <li>Limit the number of privileged accounts.</li> <li>Implement just-in-time access, where access is granted only for the duration of a task.</li> <li>Use session recording and monitoring for privileged access.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra ID Conditional Access</strong> to enforce controls on the access to apps in your environment based on specific conditions.</li> <li>Implement <strong>Microsoft Entra Privileged Identity Management</strong> for just-in-time access.</li> </ul> <h3 id=phase-5-least-privilege><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-5-least-privilege><strong>Phase 5: Least Privilege</strong></a></h3> <p>The principle of least privilege involves giving users the minimum levels of access — or permissions — they need to complete their job functions. By limiting the access rights of users, the risk of a security breach is reduced. For example:</p> <ul> <li>Implement role-based access control (RBAC) in Azure to grant the minimum necessary access to users.</li> <li>Regularly review user roles and access rights.</li> <li>Implement a process for revoking access when it's no longer needed.</li> </ul> <p>How to implement this:</p> <ul> <li>Implement <strong>Role-Based Access Control (RBAC)</strong> in Azure to grant the minimum necessary access to users.</li> <li>Use <strong>Microsoft Entra ID Access Reviews</strong> to efficiently manage group memberships, access to enterprise applications, and role assignments.</li> </ul> <h3 id=phase-6-control-all-applications><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-6-control-all-applications><strong>Phase 6: Control All Applications</strong></a></h3> <p>In this phase, we ensure that all applications, whether on-premises or in the cloud, are controlled and monitored. This includes implementing application control policies and monitoring application usage. For example:</p> <ul> <li>Implement application control policies that dictate what applications can be run on systems.</li> <li>Monitor application usage and block unauthorized applications.</li> <li>Regularly update and patch all applications to reduce vulnerabilities.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Entra Application Proxy</strong> to control and secure access to on-premises and cloud apps.</li> <li>Enable Change Tracking and Inventory in <strong>Azure Automation</strong> to track changes to your Azure VMs. Use desired state configuration to ensure that your VMs are configured correctly.</li> <li>Implement <strong>Microsoft Intune</strong> to manage and secure your devices and applications.</li> </ul> <h3 id=phase-7-detect-and-respond><a class=toclink href=../../04/privileged-access-management-pam-strategy-with-microsoft-entra-id-and-some-azure-services/#phase-7-detect-and-respond><strong>Phase 7: Detect and Respond</strong></a></h3> <p>The final phase involves setting up systems to detect and respond to any suspicious activity. This could involve setting up alerts for unusual activity, regularly auditing access logs, and having a response plan in place for when a breach occurs. For example:</p> <ul> <li>Set up alerts for unusual activity.</li> <li>Regularly audit access logs.</li> <li>Have a response plan in place for when a breach occurs, including steps for containment, eradication, and recovery.</li> </ul> <p>How to implement this:</p> <ul> <li>Use <strong>Microsoft Defender for Cloud</strong> for increased visibility into your security state and to detect and respond to threats.</li> <li>Implement <strong>Azure Sentinel</strong>, Microsoft's cloud-native SIEM solution, for intelligent security analytics.</li> </ul> <p>By following these seven phases, you can create a robust PAM strategy that protects your organization from security breaches and helps you maintain compliance with various regulations.</p> <p>Remember, a good PAM strategy is not a one-time effort but an ongoing process that needs to be regularly reviewed and updated. Microsoft and Azure services provide a robust set of tools to help you implement and manage your PAM strategy effectively.</p> </div> </article> <nav class=md-pagination> <a href=../../ class=md-pagination__link>1</a> <span class=md-pagination__current>2</span> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button class="md-top md-icon" data-md-component=top hidden type=button> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2023-now Rafael Fernández </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://www.linkedin.com/in/rafaelfernandezd/ rel=noopener target=_blank title=LinkedIn> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> </a> <a class=md-social__link href=https://github.com/rfernandezdo rel=noopener target=_blank title=GitHub> <svg viewbox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </a> <a class=md-social__link href=https://rfernandezdo.github.io/feed_rss_created.xml rel=noopener target=_blank title="RSS feed"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../../assets/javascripts/bundle.dd8806f2.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../../../../javascripts/tablesort.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>